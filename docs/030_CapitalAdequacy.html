<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Capital adequacy and sources of risk – Introduction to Capital Modeling and Portfolio Management</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./040_PricingAndAllocation.html" rel="next">
<link href="./020_BusinessOperations.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-01c78b5cd655e4cd89133cf59d535862.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-44a2bfbc4aea0d0866ad2a0ddca8a790.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<link rel="icon" href="./static/favicon.ico" type="image/x-icon">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="3&nbsp; Capital adequacy and sources of risk – Introduction to Capital Modeling and Portfolio Management">
<meta property="og:description" content="">
<meta property="og:site_name" content="Introduction to Capital Modeling and Portfolio Management">
<meta name="twitter:title" content="3&nbsp; Capital adequacy and sources of risk – Introduction to Capital Modeling and Portfolio Management">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./030_CapitalAdequacy.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Capital adequacy and sources of risk</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Capital Modeling and Portfolio Management</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dedication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dedication</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./010_Introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./020_BusinessOperations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Business operations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./030_CapitalAdequacy.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Capital adequacy and sources of risk</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./040_PricingAndAllocation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Pricing and allocation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./050_Applications.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Applications of pricing and allocation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./060_SelectingSRM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Selecting and calibrating an SRM</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./065_Evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Evaluating models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./070_AdvancedTopics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Advanced topics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./080_Calculations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Calculations with <code>Aggregate</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./090_EndMatter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Appendices</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bibliography</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">In this chapter:</h2>
   
  <ul>
  <li><a href="#capital-adequacy" id="toc-capital-adequacy" class="nav-link active" data-scroll-target="#capital-adequacy"><span class="header-section-number">3.1</span> Capital adequacy</a>
  <ul class="collapse">
  <li><a href="#value-at-risk-and-tail-value-at-risk" id="toc-value-at-risk-and-tail-value-at-risk" class="nav-link" data-scroll-target="#value-at-risk-and-tail-value-at-risk"><span class="header-section-number">3.1.1</span> <strong>Value at Risk</strong> and <strong>Tail</strong> <strong>Value at Risk</strong></a></li>
  </ul></li>
  <li><a href="#sec-Risk-Analysis" id="toc-sec-Risk-Analysis" class="nav-link" data-scroll-target="#sec-Risk-Analysis"><span class="header-section-number">3.2</span> Risk analysis</a></li>
  <li><a href="#algorithms" id="toc-algorithms" class="nav-link" data-scroll-target="#algorithms"><span class="header-section-number">3.3</span> Algorithms</a>
  <ul class="collapse">
  <li><a href="#algorithm-to-evaluate-expected-loss-for-discrete-random-variables" id="toc-algorithm-to-evaluate-expected-loss-for-discrete-random-variables" class="nav-link" data-scroll-target="#algorithm-to-evaluate-expected-loss-for-discrete-random-variables"><span class="header-section-number">3.3.1</span> Algorithm to evaluate expected loss for discrete random variables</a></li>
  <li><a href="#algorithm-to-evaluate-var-for-a-discrete-distribution" id="toc-algorithm-to-evaluate-var-for-a-discrete-distribution" class="nav-link" data-scroll-target="#algorithm-to-evaluate-var-for-a-discrete-distribution"><span class="header-section-number">3.3.2</span> Algorithm to evaluate VaR for a discrete distribution</a></li>
  <li><a href="#algorithm-to-evaluate-tvar-for-a-discrete-distribution" id="toc-algorithm-to-evaluate-tvar-for-a-discrete-distribution" class="nav-link" data-scroll-target="#algorithm-to-evaluate-tvar-for-a-discrete-distribution"><span class="header-section-number">3.3.3</span> Algorithm to evaluate TVaR for a discrete distribution</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-Capital-Adequacy" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Capital adequacy and sources of risk</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><em>Too much of everything is just enough.</em><br>
<em>—Grateful Dead, “I Need a Miracle”</em></p>
<section id="capital-adequacy" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="capital-adequacy"><span class="header-section-number">3.1</span> Capital adequacy</h2>
<p>What quantity of assets is needed to back the liabilities the firm is taking on? The answer depends on who you ask. Insureds want more protection, meaning lower probability of insolvency and therefore higher assets. Regulators, representing the public, are aligned with the insureds. Investors want to minimize their own risk, so they want to invest less capital (for a given expected profit). Rating agencies are concerned with the counterparty (bond) creditworthiness and claims-paying ability of the firm, so they want to see an adequate level of lower-priority (equity, reinsurance) capital. The firm’s own management must adjudicate these competing demands in their own minds: on the one hand, they don’t want the firm to go under, but on the other hand, they need to deliver an acceptable rate of return to investors. They will have their own view of the ideal level of assets.</p>
<p>Even 100% collateralization of liabilities only theoretically guarantees 100% probability of solvency. In practice, insolvency can be caused by nonmodeled or inadequately modeled operational risks, such as fraud, rogue actors within the organization, management missteps, or bad-faith claim judgments in excess of policy limits. Capital adequacy is all about pegging an amount of assets deemed to be safe enough.</p>
<p>In practice it works like this:</p>
<ol type="1">
<li>Local regulatory authorities prescribe a minimum amount of <em>assets</em> and set reserving and valuation standards, which together imply a minimum <em>capital</em> requirement.</li>
<li>Rating agencies specify amounts that correspond to different rating levels (effectively, grades) given to the firm. Their models are generally based on statutory valuations but with adjustments, for example, for discount in loss reserves. The implied capital levels are usually higher than the regulatory minimums.</li>
<li>Management decides a target rating level (or in the EU, a ratio of capital to Solvency II–required capital), balancing revenue and profit needs with what they believe their customers will tolerate. For example, personal lines markets are relatively insensitive to ratings, whereas large commercial markets require more highly rated insurers.</li>
<li>Management—with the help of the capital model—will look at the probabilities of adverse events causing the end-of-period assets to breach the above thresholds. They will then likely consider changing reinsurance, raising capital, or reducing exposure to keep these probabilities in control. In a startup situation, they might require an extra capital buffer, but a going concern rarely raises capital except for specific growth opportunities.</li>
</ol>
<p>While insurance regulations and laws in the US are created and enforced by the individual states, the National Association of Insurance Commissioners (NAIC) develops model laws, regulations, and standards which most states follow. The NAIC created and maintains the Risk-Based Capital (RBC) framework, which is the primary method regulators use to assess capital adequacy. It specifies minimal capital requirements lest an insurer be put under watch or, worse, taken over by the regulators. <span class="citation" data-cites="NAIC2024RBC">NAIC (<a href="references.html#ref-NAIC2024RBC" role="doc-biblioref">2024</a>)</span> provides background on RBC and links to related content.</p>
<p>Insurers in the European Union are bound by the Solvency II Directive <span class="citation" data-cites="EIOPA2009">(<a href="references.html#ref-EIOPA2009" role="doc-biblioref">EIOPA 2009</a>)</span>. This specifies a Solvency Capital Requirement to be calculated either by a standard model or by a firm’s internal model. See <span class="citation" data-cites="IAARiskMargins09">IAA Risk Margin Working Group (<a href="references.html#ref-IAARiskMargins09" role="doc-biblioref">2009</a>)</span>, <span class="citation" data-cites="Floreani2011">Floreani (<a href="references.html#ref-Floreani2011" role="doc-biblioref">2011</a>)</span>, and <span class="citation" data-cites="Meyers2019a">Meyers (<a href="references.html#ref-Meyers2019a" role="doc-biblioref">2019</a>)</span>.</p>
<p>Rating agencies include S&amp;P Global Ratings, AM Best, Moody’s, and Fitch. They are primarily concerned with credit risk, i.e., assigning bonds a letter grade, but they also concern themselves with insurer claims paying ability, so there are two distinct types of rating. Rating agencies have their own models, often factor-based models similar to NAIC’s RBC. <span class="citation" data-cites="Karakuyu2023RBC">Karakuyu et al. (<a href="references.html#ref-Karakuyu2023RBC" role="doc-biblioref">2023</a>)</span> describe “S&amp;P Global Ratings’ methodology and assumptions for analyzing the risk-based capital (RBC) adequacy of insurers and reinsurers.” <span class="citation" data-cites="Jakobsen2020">Jakobsen et al. (<a href="references.html#ref-Jakobsen2020" role="doc-biblioref">2020</a>)</span> explain AM Best’s Universal BCAR (Best’s Capital Adequacy Ratio) model. <span class="citation" data-cites="Fitch2024IRC">Chan et al. (<a href="references.html#ref-Fitch2024IRC" role="doc-biblioref">2024</a>)</span> “specifies Fitch Ratings’ criteria for assigning new and monitoring existing international scale insurer Financial Strength (IFS) ratings.” Readers should consult the agencies’ websites for the most recent models, as these frameworks are periodically revised.</p>
<p>Larger insurance firms, especially publicly traded firms, tend to be organized into multiple legal entities, groups, and subsidiaries. <span class="citation" data-cites="CASHBK">Szkoda et al. (<a href="references.html#ref-CASHBK" role="doc-biblioref">1995</a>)</span> state: “To properly analyze the financial condition of a company with subsidiaries, each subsidiary should be analyzed separately.” Also, “understand debt obligations of company and parent company, look through on debt structure to determine if subsidiaries, etc., have sufficient cash flows to meet parent’s obligations.” <span class="citation" data-cites="CASDFM">Emma et al. (<a href="references.html#ref-CASDFM" role="doc-biblioref">2000</a>)</span> say that either a consolidated model with internal cash flows between entities or entirely separate models (feeding each other) can be developed. Bear in mind that in stressed situations capital can become trapped.</p>
<p><span class="citation" data-cites="Brehm2007">Brehm et al. (<a href="references.html#ref-Brehm2007" role="doc-biblioref">2007</a>)</span> chapter 2.3 compares regulatory and rating agency capital adequacy models. <span class="citation" data-cites="Eling2008">Eling and Holzmüller (<a href="references.html#ref-Eling2008" role="doc-biblioref">2008</a>)</span> provide an overview and comparison of RBC requirements from the US, the EU, Switzerland, and New Zealand, although it is somewhat dated.</p>
<p>The firm’s management will likely attend to a hierarchy of event possibilities (not necessarily distinct or in order):</p>
<ul>
<li>Missed earnings</li>
<li>Spreads widen on bonds; stock price goes down</li>
<li>Market value less than book value</li>
<li>Bond ratings outlook change (watch)</li>
<li>Bond ratings downgrade</li>
<li>Claims paying ratings downgrade</li>
<li>Being placed on regulatory watch</li>
<li>Regulatory supervision, conservatorship or liquidation</li>
<li>Loss of significant shareholder equity</li>
<li>Loss of all shareholder equity</li>
<li>Failure to pay bond interest</li>
<li>Failure to fully redeem a bond</li>
<li>Bankruptcy and reorganization</li>
</ul>
<p>All these are highly correlated with the size of loss experienced in an accounting period, and all but missed earnings and market effects can be ameliorated by holding more capital. <!-- STEVE: spreads and stock prices are under the heading of "market effects."" --></p>
<p>Consider the InsCo example described in <a href="#tbl-CA-loss-levels" class="quarto-xref">Table&nbsp;<span>3.1</span></a>. If losses exceed 52.2 (premiums), then InsCo’s investors will not receive any gain on their investment. This event has a probability of 30%. If losses are 80 or more (<span class="math inline">\(52.2+27.8\)</span> capital), then shareholders will be wiped out (lose all their investment); the probability is 10%. Sixty cents more and bondholders will not receive their promised coupons, and the company defaults and is put to the debt holders. If losses reach 100 (also a 10% chance), then bondholders will be wiped out as well, suffering a 100% loss-given-default. Regulatory intervention thresholds might be defined by intermediate levels of loss and corresponding probabilities. Any of these might be used as VaR levels to define required assets. This is elaborated on in the next section.</p>
<div id="tbl-CA-loss-levels" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-CA-loss-levels-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.1: InsCo critical loss levels.
</figcaption>
<div aria-describedby="tbl-CA-loss-levels-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Event</strong></th>
<th style="text-align: right;"><strong>Loss Level</strong></th>
<th style="text-align: right;"><strong>Probability</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Zero profit</td>
<td style="text-align: right;">52.2</td>
<td style="text-align: right;">30%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Shareholders wiped out</td>
<td style="text-align: right;">80.0</td>
<td style="text-align: right;">10%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Failure to pay coupons</td>
<td style="text-align: right;">80.6</td>
<td style="text-align: right;">10%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Failure to redeem bonds</td>
<td style="text-align: right;">100.0</td>
<td style="text-align: right;">10%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">99% average loss (TVaR)</td>
<td style="text-align: right;">100.0</td>
<td style="text-align: right;">10%</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<section id="value-at-risk-and-tail-value-at-risk" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="value-at-risk-and-tail-value-at-risk"><span class="header-section-number">3.1.1</span> <strong>Value at Risk</strong> and <strong>Tail</strong> <strong>Value at Risk</strong></h3>
<p>Various different risk measures can be used to calculate required capital. For a thorough discussion, see section 3.6.3 of <span class="citation" data-cites="PIR">Mildenhall and Major (<a href="references.html#ref-PIR" role="doc-biblioref">2022</a>)</span>. Typically, the goal is to avoid a particular event with specified probability. An exceedance probability measure tells you the probability a firm becomes insolvent at a particular future time given an initial capital level. Inverting that relation determines the capital needed to attain the desired probability of safety. Thus there is a correspondence between risk measures and adequacy measures <span class="citation" data-cites="Cherny2009">(<a href="references.html#ref-Cherny2009" role="doc-biblioref">Cherny and Madan 2009</a>)</span>. Exceedance probability measures are common and lead to one or more <strong>Value at Risk (VaR)</strong> criteria: given a threshold probability, e.g., 99.5%, what size of loss will not be exceeded at that probability level?</p>
<p>VaR has a bit of a problem, however. It is not <em>subadditive</em>, which means there are situations where the VaR of the sum of two risks is greater than the sum of the two VaRs. Subadditivity is a good property for a risk measure because it means you manage risk from the bottom up: by managing the risk of each unit to be below its own threshold, you have managed the total risk to be below the sum of the thresholds. There are obvious implications for risk and capacity management. Theoretically, because VaR is not subadditive, it is not a good choice to manage risk at the unit level on up. However, this failure is more an academic quibble than a practical shortcoming. In many real-world situations VaR is subadditive, and it has the added benefits of being easy to understand, estimate, and back-test, and of always existing. In practice VaR is the risk measure of choice for insurance regulators around the world—with the exception of the Swiss.</p>
<p>Academics, the Swiss, and bankers in Basel 3 (also in Switzerland), posit a better alternative is <strong>Tail Value at Risk (TVaR)</strong>. TVaR asks, for a given probability level, what is the average loss in the worst events representing that accumulated probability? Defined in this way, TVaR is subadditive, a plus. On the downside, TVaR does not exist for thick-tailed distributions with no mean. It is also much harder to elicit and back-test than VaR. See <span class="citation" data-cites="PIR">Mildenhall and Major (<a href="references.html#ref-PIR" role="doc-biblioref">2022</a>)</span> for an elaboration on this.</p>
<p>Another issue with TVaR is its precise definition. Historically, TVaR was called Expected Shortfall (ES) and Conditional Value at Risk (CVaR) by some authors. In addition, there are two subtly different measures called Tail Conditional Expectation (TCE) and Worst Conditional Expectation (WCE). In many cases these are all the same, but in many other realistic (discrete) cases they are not. See chapter 4 of <span class="citation" data-cites="PIR">Mildenhall and Major (<a href="references.html#ref-PIR" role="doc-biblioref">2022</a>)</span> for a thorough analysis of VaR and TVaR.</p>
<p>In many older texts, TVaR is defined as the average of losses above a specified VaR loss value. This coincides with the TCE definition for continuous random variables but not for discrete or mixed variables, and, in those cases, the resulting measure is not subadditive! More recent literature, led by <span class="citation" data-cites="McNeil2006">McNeil et al. (<a href="references.html#ref-McNeil2006" role="doc-biblioref">2005</a>)</span>, uses the definition we give. Formally, <span class="math display">\[
\mathsf{TVaR}_p(X):=\dfrac{1}{1-p}\int_{p}^1 \mathsf{VaR}_s(X)\,ds=
\dfrac{1}{1-p}\int_{p}^1 F^-(s)\,ds
\]</span> where <span class="math inline">\(F^-(p)\)</span> is the least inverse of the cumulative distribution function. In particular <span class="math inline">\(\mathsf{TVaR}_0(X)=\mathsf E[X]\)</span> and <span class="math inline">\(\mathsf{TVaR}_1(X)\)</span> is defined to be <span class="math inline">\(\sup(X)\)</span>, the largest possible outcome.</p>
<p>Here are two simple examples to help demystify subadditivity.</p>
<ol type="1">
<li><strong>Discrete example.</strong> Consider a probability space with three outcomes, with probability 0.9, 0.05, and 0.05. Unit 1 has outcomes 0, 0, and 10, and unit 2 has 0, 10, and 0. The total outcomes are 0, 10, and 10. The <span class="math inline">\(p=0.9\)</span> VaRs are 0 for each unit, but it is 10 in total. The corresponding TVaRs are 5 for each unit and 10 in total.</li>
<li><strong>Continuous example.</strong> It is a curious fact that the sum of two standard exponential distributions fails to be subadditive at <span class="math inline">\(p=0.7\)</span> (and neighboring <span class="math inline">\(p\)</span>), so the failure can also apply for continuous variables. The unit VaRs are <span class="math inline">\(-\log(0.3)=1.204\)</span> and the sum (a gamma with shape 2) has VaR equal to <span class="math inline">\(2.439\)</span>, which is greater than <span class="math inline">\(2 \times 1.204 = 2.408\)</span>.</li>
</ol>
<p>Mirroring the broader VaR-TVaR debate, your authors split in favor of VaR and TVaR. Your capital model must, however, employ <em>some</em> risk measure criteria to determine the amount of assets necessary to protect the firm against adverse loss experience. It can, of course, also cheat and select a (T)VaR threshold equating to actual capital held.</p>
<p>Our InsCo example uses assets <span class="math inline">\(a=100\)</span>, which can be characterized in various ways. One way is to say there is a <span class="math inline">\(\mathsf{TVaR}_{0.99}\)</span> standard for the amount of assets needed. This is input “C” in <a href="010_Introduction.html#sec-System-Overview" class="quarto-xref"><span>Section 1.5</span></a>. The other way says it is <span class="math inline">\(\mathsf{VaR}_1\)</span>. Both result in <span class="math inline">\(a=100\)</span>, the maximum loss among the events, which is the asset value assumed previously. Notice two points. First, in practice the order of operations flows from accountants determining the amount of capital to modelers describing its adequacy (99% TVaR). Second, that <span class="math inline">\(a=100\)</span> corresponds to full collateralization, and so it means there is no possibility of default. Default is not driving any results in this example! Nor should it in the preponderance of realistic models for well-rated companies. We might have chosen any VaR or TVaR level beyond 90% and obtained the same arithmetical results. We use TVaR to illustrate the algebra involved with a nontrivial asset risk measure.</p>
<p>In addition to specifying the model capital amount, it would be helpful to have some analytical capabilities to explain what drives the results. This is discussed in the next section.</p>
</section>
</section>
<section id="sec-Risk-Analysis" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="sec-Risk-Analysis"><span class="header-section-number">3.2</span> Risk analysis</h2>
<p>A main output of the Capital Adequacy module is an assessment of how often there is sufficient capital to avoid various undesirable outcomes. Natural follow-up questions revolve around explaining those results. Having drill-down and diagnostic capabilities is helpful, especially for complex models. These may include:</p>
<ol type="1">
<li>Statistics of selected variables</li>
<li>Identification of extreme events</li>
<li>Explaining what variables drive outputs</li>
<li>Evaluation of decision rules (e.g., reinsurance)</li>
<li>Risk/reward analysis</li>
<li>A battery of what-if questions</li>
</ol>
<p>A systematic battery of what-if questions—what if trend is 3% higher than plan? What if hurricane frequency is actually 20% higher than the cat model assumptions?—can reveal where assumptions are particularly sensitive.</p>
<p>Even within the plan, there is an opportunity for sophisticated analysis. For example, machine learning could construct a decision tree to characterize simulation events with high losses.</p>
<p>At this point, there is a fork in the analytic road with two divergent paths that surprisingly rejoin to produce the same conclusion. The paths lead along a dynamic marginal impact analysis and a more static risk-adjusted probability analysis. Early work of <span class="citation" data-cites="Venter2006">Venter et al. (<a href="references.html#ref-Venter2006" role="doc-biblioref">2006</a>)</span> saw the two paths, and more technical work of <span class="citation" data-cites="Delbaen2000a">Delbaen (<a href="references.html#ref-Delbaen2000a" role="doc-biblioref">2000</a>)</span> actually knew the paths rejoined. Our work, <span class="citation" data-cites="PIR">Mildenhall and Major (<a href="references.html#ref-PIR" role="doc-biblioref">2022</a>)</span> connected the dots more explicitly in an actuarial context.</p>
<p>The first form of risk analysis looks at the marginal impact on required assets of changes in the underlying portfolio. While unrealistic, a linear scaling of the unit loss distributions is often used, i.e., assets <span class="math inline">\(a(X)\)</span> become <span class="math inline">\(a((1+\epsilon)X)\)</span>. This is unrealistic because, e.g., doubling one’s auto exposures homogeneously will not change <span class="math inline">\(X\)</span> into <span class="math inline">\(2X\)</span>. While it may approximately double the expected loss, the <em>shape</em> of the distribution will change: the standard deviation will less than double <span class="citation" data-cites="Mildenhall2017c">(<a href="references.html#ref-Mildenhall2017c" role="doc-biblioref">Mildenhall 2017</a>)</span>. Nonetheless, linear scaling is useful as a directional indicator. We will return to the issue of nonlinear scaling in <a href="050_Applications.html#sec-portfolio-optimization" class="quarto-xref"><span>Section 5.5</span></a>.</p>
<p>Specifically, the <strong>marginal approach</strong> looks at the <strong>gradient</strong> (slope) of the risk measure: the change resulting from a small change in exposure. If <span class="math inline">\(X=\sum_i X^i\)</span> and <span class="math inline">\(\phi(X)\)</span> is a risk measure, then define <span class="math display">\[
\nabla^i\phi(X) = \frac{\partial}{\partial\epsilon}\phi(X+\epsilon X^i)=\lim_{\epsilon \downarrow 0}\frac{\phi(X+\epsilon X^i)-\phi(X)}{\epsilon}.
\]</span> If <span class="math inline">\(\phi\)</span> is continuous and <em>homogeneous</em>, that is, <span class="math inline">\(\phi(tX)=t\phi(X)\)</span> for <span class="math inline">\(t&gt;0\)</span>, then Euler’s homogeneous function theorem tells us that <span class="math display">\[
\sum_i \nabla^i\phi(X) = \phi(X),
\]</span> i.e., the marginals consist of an allocation of the original measure <span class="citation" data-cites="Mildenhall2004">(<a href="references.html#ref-Mildenhall2004" role="doc-biblioref">Mildenhall 2004</a>)</span>.</p>
<p>In our example, the risk measure is <span class="math inline">\(\phi(X) = \mathsf{TVaR}_{0.99}(X)\)</span>. The gradient of this is <span class="math display">\[
\nabla^i(\phi(X)) = \dfrac{1}{1-p}\int_{p}^1 \mathsf E[X^i \mid X=\mathsf{VaR}_s(X)]\,ds,
\]</span> often called the <strong>coTVaR</strong>. Those measures on the three units in our example refer again to the worst of the 10 losses, so the answers are 16, 20, and 64, respectively, see the last event in <a href="#tbl-CA-loss-levels" class="quarto-xref">Table&nbsp;<span>3.1</span></a>.</p>
<p>So far, the discussion refers to required <em>assets</em>, not <em>capital</em>. To calculate capital, we have to subtract premiums (<a href="010_Introduction.html#eq-funding" class="quarto-xref">Equation&nbsp;<span>1.1</span></a>). This is detailed in <a href="#tbl-ca-marginal-analysis" class="quarto-xref">Table&nbsp;<span>3.2</span></a>. Ideally, <em>required</em> capital is calculated based on <em>required</em> premiums, but at this stage in our calculations we do not have those numbers.</p>
<div id="tbl-ca-marginal-analysis" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-ca-marginal-analysis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.2: InsCo marginal analysis.
</figcaption>
<div aria-describedby="tbl-ca-marginal-analysis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 36%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Item</strong></th>
<th style="text-align: right;"><strong>Unit A</strong></th>
<th style="text-align: right;"><strong>Unit B</strong></th>
<th style="text-align: right;"><strong>Unit C</strong></th>
<th style="text-align: right;"><strong>Portfolio</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Required assets coTVaR, <span class="math inline">\(a\)</span></td>
<td style="text-align: right;">16.0</td>
<td style="text-align: right;">20.0</td>
<td style="text-align: right;">64.0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Expected loss, <span class="math inline">\(L\)</span></td>
<td style="text-align: right;">13.4</td>
<td style="text-align: right;">18.3</td>
<td style="text-align: right;">14.9</td>
<td style="text-align: right;">46.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Plan premium</td>
<td style="text-align: right;">13.9</td>
<td style="text-align: right;">18.7</td>
<td style="text-align: right;">19.6</td>
<td style="text-align: right;">52.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Required capital (plan)</td>
<td style="text-align: right;">2.1</td>
<td style="text-align: right;">1.3</td>
<td style="text-align: right;">44.4</td>
<td style="text-align: right;">47.8</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<!-- |Co-XTVaR                   |        2.6|        1.7|       59.1|         53.4| -->
<p>Note that while TVaR submits to marginal analysis fairly well, VaR needs special handling. Say we were concerned with <span class="math inline">\(\mathsf{VaR}_{0.85}=65\)</span>. This occurs solidly in event 9 (<a href="020_BusinessOperations.html#tbl-dupe-x" class="quarto-xref">Table&nbsp;<span>2.1</span></a>). A straightforward marginal analysis breaks this down to:</p>
<div id="tbl-CA-marginal-VaR" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-CA-marginal-VaR-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.3: InsCo marginal analysis of <span class="math inline">\(\mathsf{VaR}_{0.85}\)</span>.
</figcaption>
<div aria-describedby="tbl-CA-marginal-VaR-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: right;"><strong>Unit A</strong></th>
<th style="text-align: right;"><strong>Unit B</strong></th>
<th style="text-align: right;"><strong>Unit C</strong></th>
<th style="text-align: right;"><strong>Portfolio</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">17.0</td>
<td style="text-align: right;">8.0</td>
<td style="text-align: right;">40.0</td>
<td style="text-align: right;">65.0</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Yet, for both the lower event 8 and higher event 10, line B’s contribution is higher. Imagine a more detailed simulation where each event is only worth 1/10,000 probability. Looking at just that specific event, defining the VaR is inviting a good deal of instability. Another run with different random numbers will likely produce materially different results.</p>
<p>There are two ways out of this problem. One is to estimate the conditional expected loss values described in <a href="040_PricingAndAllocation.html#sec-Complications" class="quarto-xref"><span>Section 4.3</span></a>. The other is to use a more robust replacement for VaR known as <strong>Range Value at Risk</strong> (RVaR) <span class="citation" data-cites="Cont2010">(<a href="references.html#ref-Cont2010" role="doc-biblioref">Cont et al. 2010</a>)</span>. This is the average loss occurring between two probability levels. For example, instead of using <span class="math inline">\(\mathsf{VaR}_{0.99}\)</span>, you might use <span class="math inline">\(\mathsf{RVaR}_{0.985,0.995}\)</span>.</p>
<p>A sign of problems of the marginal approach is the need to stipulate that epsilon <!--# Replace "epsilon" with symbol? --> decreases to zero. When there are ties in the outcome distribution, the risk measure is not actually differentiable! It has a cusp, and depending on whether you increase or decrease volume in a given line, you get different answers. The risk measure is analogous to the absolute value function at zero, where the left and right derivatives are different. (We will see this haunt us in <a href="050_Applications.html#sec-portfolio-optimization" class="quarto-xref"><span>Section 5.5</span></a>.) To ensure the risk measure is differentiable, and a marginal approach is really valid, it is enough to require that all outcomes of the total distribution be distinct. In that case, for a small enough change in any unit, there is no reordering of the total outcomes and the risk measure is differentiable. We will implement that requirement in the next chapter.</p>
<p>The second form of risk analysis, again following <span class="citation" data-cites="Venter2006">Venter et al. (<a href="references.html#ref-Venter2006" role="doc-biblioref">2006</a>)</span>, looks for a set of risk-adjusted probabilities that reproduce the results of the risk measure. With these adjusted probabilities in hand, it is natural to use the risk-adjusted expected value of each unit as an allocation <em>of risk</em>. This method is the basis of the <em>Natural Allocation</em> described in <span class="citation" data-cites="PIR">Mildenhall and Major (<a href="references.html#ref-PIR" role="doc-biblioref">2022</a>)</span> and picked up in <a href="040_PricingAndAllocation.html" class="quarto-xref"><span>Chapter 4</span></a> to allocate <em>premium</em>.</p>
<!--
Here's why it works. When total outcomes are distinct, a small enough change in a unit results in no reordering of total outcomes, and so
$$
\begin{aligned}
\rho(X+\epsilon X)
&=\mathsf E_q[X+\epsilon X^i] \\
&=\mathsf E_q[X]+\epsilon\mathsf E_q[X^i] \\
&=\rho(X) + \epsilon\mathsf E_q[X^i].
\end{aligned}
$$
Therefore $\nabla^i(\phi(X)) = \mathsf E_q[X^i]$!! The two apparently divergent paths have rejoined in a nirvana where these two eminently plausible allocation methodologies agree. But remember, this conclusion depends upon the outcome values of the total distribution being distinct. When the outcomes are not distinct the marginal approach is not defined because it tries to differentiate a non-differentiable function. Historically, this has been address via various unsatisfactory kludges such as insisting that $\epsilon\downarrow 0$, or specifying that volume in such-as-such unit increases or decreases. @PIR offers two alternative solutions: the linear and lifted Natural Allocations. In the former, events with equal total outcomes are collapsed to a single event, thus restoring nirvana. The latter applies when the equal outcomes are caused by a default state where all losses equal the asset level, but where unlimited losses are all distinct. It lifts a unique ordering of events from the distinct unlimited losses.
-->
</section>
<section id="algorithms" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="algorithms"><span class="header-section-number">3.3</span> Algorithms</h2>
<section id="algorithm-to-evaluate-expected-loss-for-discrete-random-variables" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="algorithm-to-evaluate-expected-loss-for-discrete-random-variables"><span class="header-section-number">3.3.1</span> Algorithm to evaluate expected loss for discrete random variables</h3>
<p>The algorithm in this subsection is very basic. We present it to establish an approach to working with discrete random variables that we generalize in subsequent chapters.</p>
<p>We present an algorithm to compute <span class="math inline">\(\mathsf E[X]\)</span> in two ways, based on <span class="math display">\[\begin{equation}\label{eq:ex-two-means}
\mathsf E[X]=\int_0^\infty xdF(x) = \int_0^\infty S(x)dx.
\end{equation}\]</span></p>
<p><strong>Algorithm Input:</strong> <span class="math inline">\(X\)</span> is a discrete random variable, taking finitely many values <span class="math inline">\(X_j\ge 0\)</span>, and <span class="math inline">\(p_j=\mathsf P(X=x_j)\)</span>. </p>
<p>Follow these steps to evaluate .</p>
<p><strong>Algorithm Steps</strong></p>
<ol type="1">
<li><strong>Pad</strong> the input by adding a zero outcome <span class="math inline">\(X=0\)</span> with probability 0.</li>
<li><strong>Group by</strong> <span class="math inline">\(X_j\)</span> and sum the corresponding <span class="math inline">\(p_j\)</span>.</li>
<li><strong>Sort</strong> events by outcome <span class="math inline">\(X_j\)</span> into ascending order. Relabel events <span class="math inline">\(X_0&lt; X_1 &lt; \dots &lt; X_m\)</span> and probabilities <span class="math inline">\(p_0,\dots, p_m\)</span>.</li>
<li><strong>Decumulate</strong> probabilities to compute the survival function <span class="math inline">\(S_j:=S(X_j)\)</span> using <span class="math inline">\(S_0=1-p_0\)</span> and <span class="math inline">\(S_j=S_{j-1}-p_j\)</span>, <span class="math inline">\(j &gt; 0\)</span>.</li>
<li><strong>Difference</strong> the outcomes to compute <span class="math inline">\(\Delta X_j=X_{j+1} - X_j\)</span>, <span class="math inline">\(j=0,\dots, m-1\)</span>.</li>
<li><strong>Outcome-probability sum-product:</strong> <span id="eq-ex-d-one"><span class="math display">\[
\mathsf E[X] =\int_0^\infty xdF(x)= \sum_{j=1}^m X_j p_j.
\tag{3.1}\]</span></span></li>
<li><strong>Survival function sum-product:</strong> <span id="eq-ex-d-three"><span class="math display">\[
\mathsf E[X] = \int_0^\infty S(x)dx = \sum_{j=0}^{m-1} S_{j}\Delta X_j.
\tag{3.2}\]</span></span></li>
</ol>
<p><strong>Comments</strong></p>
<ol type="a">
<li>Step (1) treats 0 as special because the second integral in starts at <span class="math inline">\(X=0\)</span>. Step (1) allows us to systematically deal with any discrete data. It adds a new outcome row only when the smallest observation is <span class="math inline">\(&gt;0\)</span>.</li>
<li>After Step (3), the <span class="math inline">\(X_j\)</span> are distinct; they are in ascending order, <span class="math inline">\(X_0=0\)</span>, and <span class="math inline">\(p_j=\mathsf P(X=X_j)\)</span>.</li>
<li>In Step (4), <span class="math inline">\(S_m=\mathsf P(X&gt;X_m)=0\)</span> since <span class="math inline">\(X_m\)</span> is the maximum value of <span class="math inline">\(X\)</span>.</li>
<li>The forward difference <span class="math inline">\(\Delta X\)</span> computed in Step (5) replaces <span class="math inline">\(dx\)</span> in various formulas. Since it is a forward difference <span class="math inline">\(\Delta X_m\)</span> is undefined. It is also unneeded.</li>
<li>In step (6), the sum starts at <span class="math inline">\(j=1\)</span> because <span class="math inline">\(X_0=0\)</span>. Notice that <span class="math inline">\(\mathsf P(X=X_j)=S_{j-1}-S_j\)</span> is the negative backward difference of <span class="math inline">\(S\)</span>. <!-- It is negative because $dS=-f(x)dx$. --></li>
<li>Note the index shift between <a href="#eq-ex-d-one" class="quarto-xref">Equation&nbsp;<span>3.1</span></a> and <a href="#eq-ex-d-three" class="quarto-xref">Equation&nbsp;<span>3.2</span></a>.</li>
<li>Both <a href="#eq-ex-d-one" class="quarto-xref">Equation&nbsp;<span>3.1</span></a> and <a href="#eq-ex-d-three" class="quarto-xref">Equation&nbsp;<span>3.2</span></a> are exact evaluations. The approximation occurs when the underlying distribution being modeled is replaced with the discrete sample given by <span class="math inline">\(X\)</span>.</li>
</ol>
</section>
<section id="algorithm-to-evaluate-var-for-a-discrete-distribution" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="algorithm-to-evaluate-var-for-a-discrete-distribution"><span class="header-section-number">3.3.2</span> Algorithm to evaluate VaR for a discrete distribution</h3>
<!-- JOHN: **Concur?** YES -->
<p><strong>Algorithm input:</strong> <span class="math inline">\(X\)</span> is a discrete random variable, taking <span class="math inline">\(N\)</span> equally likely values <span class="math inline">\(X_j \ge 0\)</span>, <span class="math inline">\(j = 0, \dots, N-1\)</span>. Probability level <span class="math inline">\(p\)</span>.</p>
<p>Follow these steps to determine <span class="math inline">\(\mathsf{VaR}_p(X)\)</span>.</p>
<p><strong>Algorithm steps</strong></p>
<ol type="1">
<li><p><strong>Sort</strong> outcomes into ascending order <span class="math inline">\(X_0 &lt; \dots &lt; X_{N-1}\)</span>.</p></li>
<li><p><strong>Calculate</strong> <span class="math inline">\(n=\lfloor pN\rfloor\)</span>, the greatest integer less than or equal to <span class="math inline">\(pN\)</span>.</p></li>
<li><p><strong>Return</strong> <span class="math inline">\(\mathsf{VaR}_p(X) := X_{n}\)</span> (since the indexing starts at <span class="math inline">\(0\)</span>).</p></li>
</ol>
<p>These steps compute the least quantile at level <span class="math inline">\(p\)</span>. A <span class="math inline">\(p\)</span> quantile is any value <span class="math inline">\(x\)</span> so that <span class="math inline">\(\mathsf P(X &lt; x) \le p \le \mathsf P(X\le x)\)</span> and <span class="math inline">\(\mathsf{VaR}_p\)</span> is the <em>smallest</em> such <span class="math inline">\(x\)</span>. If you draw a graph of the distribution function and allow the vertical lines joining jumps to be part of the graph, then this algorithm is just inverting the distribution function by finding the leftmost <span class="math inline">\(x\)</span> at which the graph reaches height <span class="math inline">\(p\)</span>, see chapter 4 of <span class="citation" data-cites="PIR">Mildenhall and Major (<a href="references.html#ref-PIR" role="doc-biblioref">2022</a>)</span>.</p>
</section>
<section id="algorithm-to-evaluate-tvar-for-a-discrete-distribution" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="algorithm-to-evaluate-tvar-for-a-discrete-distribution"><span class="header-section-number">3.3.3</span> Algorithm to evaluate TVaR for a discrete distribution</h3>
<p><strong>Algorithm input:</strong> <span class="math inline">\(X\)</span> is a discrete random variable, taking <span class="math inline">\(N\)</span> equally likely values <span class="math inline">\(X_j\ge 0\)</span>, <span class="math inline">\(j=0,\dots, N-1\)</span>. Probability level <span class="math inline">\(p\)</span>.</p>
<p>Follow these steps to determine <span class="math inline">\(\mathsf{TVaR}_p(X)\)</span>.</p>
<p><strong>Algorithm steps</strong></p>
<ol type="1">
<li><strong>Sort</strong> outcomes into ascending order <span class="math inline">\(X_0 &lt; \dots &lt; X_{N-1}\)</span>.</li>
<li><strong>Find</strong> <span class="math inline">\(n\)</span> so that <span class="math inline">\(n \le pN &lt; (n+1)\)</span>.</li>
<li><strong>If</strong> <span class="math inline">\(n+1=N\)</span>, <strong>then</strong> <span class="math inline">\(\mathsf{TVaR}_p(X) := X_{N-1}\)</span> is the largest observation, exit;</li>
<li><strong>Else</strong> <span class="math inline">\(n &lt; N-1\)</span> and continue.</li>
<li><strong>Compute</strong> <span class="math inline">\(T_1 := X_{n+1} + \cdots + X_{N-1}\)</span>.</li>
<li><strong>Compute</strong> <span class="math inline">\(T_2 := ((n+1)-pN)x_n\)</span>.</li>
<li><strong>Compute</strong> <span class="math inline">\(\mathsf{TVaR}_p(X) := (1-p)^{-1}(T_1+T_2)/N\)</span>.</li>
</ol>
<p>These steps compute the average of the largest <span class="math inline">\(N(1-p)\)</span> observations. Step (6) adds a pro-rata portion of the <span class="math inline">\(\lfloor N(1-p)\rfloor\)</span> largest observation when <span class="math inline">\(N(1-p)\)</span> is not an integer.</p>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-Brehm2007" class="csl-entry" role="listitem">
Brehm, Paul J, Spencer M Gluck, Kreps Rodney E, et al. 2007. <span>“Enterprise Risk Analysis for Property &amp; Liability Insurance Companies.”</span> <em>Guy Carpenter &amp; Company, LLC</em>.
</div>
<div id="ref-Fitch2024IRC" class="csl-entry" role="listitem">
Chan, Cynthia et al. 2024. <em>Insurance Rating Criteria</em>. Fitch Ratings.
</div>
<div id="ref-Cherny2009" class="csl-entry" role="listitem">
Cherny, Alexander, and Dilip Madan. 2009. <span>“<span class="nocase">New measures for performance evaluation</span>.”</span> <em>Review of Financial Studies</em> 22 (7): 2571–606. <a href="https://doi.org/10.1093/rfs/hhn081">https://doi.org/10.1093/rfs/hhn081</a>.
</div>
<div id="ref-Cont2010" class="csl-entry" role="listitem">
Cont, Rama, Romain Deguest, and Giacomo Scandolo. 2010. <span>“<span class="nocase">Robustness and sensitivity analysis of risk measurement procedures</span>.”</span> <em>Quantitative Finance</em> 10 (6): 593–606. <a href="https://doi.org/10.1080/14697681003685597">https://doi.org/10.1080/14697681003685597</a>.
</div>
<div id="ref-Delbaen2000a" class="csl-entry" role="listitem">
Delbaen, Freddy. 2000. <span>“<span>Coherent Risk Measusres</span>.”</span> <em>Bl<span>ä</span>tter Der DGVFM</em> 10 (24(4)): 733–39. <a href="https://doi.org/10.1007/BF02808276">https://doi.org/10.1007/BF02808276</a>.
</div>
<div id="ref-EIOPA2009" class="csl-entry" role="listitem">
EIOPA. 2009. <em><span>Directive 138/2009/EC (Solvency II Directive)</span></em>.
</div>
<div id="ref-Eling2008" class="csl-entry" role="listitem">
Eling, Martin, and David Holzmüller. 2008. <span>“<span class="nocase">An Overview and Comparison of Risk-Based Capital Standards</span>.”</span> <em>Journal of Insurance Regulation</em> 26 (4): 31–60.
</div>
<div id="ref-CASDFM" class="csl-entry" role="listitem">
Emma, Charles C et al. 2000. <em>Dynamic Financial Models of Property-Casualty Insurers</em>. Casualty Actuarial Society. <a href="https://www.casact.org/sites/default/files/database/forum_00wforum_00wf317.pdf">https://www.casact.org/sites/default/files/database/forum_00wforum_00wf317.pdf</a>.
</div>
<div id="ref-Floreani2011" class="csl-entry" role="listitem">
Floreani, Alberto. 2011. <span>“<span class="nocase">Risk margin estimation through the cost of capital approach: Some conceptual issues</span>.”</span> <em>Geneva Papers on Risk and Insurance: Issues and Practice</em> 36 (2): 226–53. <a href="https://doi.org/10.1057/gpp.2011.2">https://doi.org/10.1057/gpp.2011.2</a>.
</div>
<div id="ref-IAARiskMargins09" class="csl-entry" role="listitem">
IAA Risk Margin Working Group. 2009. <em><span class="nocase">Measurement of Liabilities for Insurance Contracts: Current Estimates and Risk Margins</span></em>. International Actuarial Assocation.
</div>
<div id="ref-Jakobsen2020" class="csl-entry" role="listitem">
Jakobsen, Mathilde, Timothy Prince, Brad Herman, and Mahesh Mistry. 2020. <em><span>Understanding Universal BCAR</span></em>.
</div>
<div id="ref-Karakuyu2023RBC" class="csl-entry" role="listitem">
Karakuyu, Ali, Mark Button, et al. 2023. <em>Criteria | Insurance | General: Insurer Risk-Based Capital Adequacy–Methodology and Assumptions</em>.
</div>
<div id="ref-McNeil2006" class="csl-entry" role="listitem">
McNeil, Alexander J., Paul Embrechts, and Rudiger Frey. 2005. <em><span class="nocase">Quantitative Risk Management: Concepts, Techniques, and Tools</span></em>. Princeton University Press. <a href="https://doi.org/10.1198/jasa.2006.s156">https://doi.org/10.1198/jasa.2006.s156</a>.
</div>
<div id="ref-Meyers2019a" class="csl-entry" role="listitem">
Meyers, Glenn G. 2019. <em><span>Stochastic Loss Reserving Using Bayesian MCMC Models</span></em>. CAS Monograph Series.
</div>
<div id="ref-Mildenhall2004" class="csl-entry" role="listitem">
Mildenhall, Stephen J. 2004. <span>“<span class="nocase">A Note on the Myers and Read Capital Allocation Formula</span>.”</span> <em>North American Actuarial Journal</em> 8 (2): 32–44. <a href="http://library.soa.org/library-pdf/naaj0402_3.pdf">http://library.soa.org/library-pdf/naaj0402_3.pdf</a>.
</div>
<div id="ref-Mildenhall2017c" class="csl-entry" role="listitem">
Mildenhall, Stephen J. 2017. <span>“<span class="nocase">In Praise of Value at Risk</span>.”</span> <em>Actuarial Review</em> 44(6): 48–50. <a href="https://ar.casact.org/in-praise-of-value-at-risk/">https://ar.casact.org/in-praise-of-value-at-risk/</a>.
</div>
<div id="ref-PIR" class="csl-entry" role="listitem">
Mildenhall, Stephen J, and John A Major. 2022. <em>Pricing Insurance Risk: Theory and Practice</em>. John Wiley &amp; Sons, Inc.
</div>
<div id="ref-NAIC2024RBC" class="csl-entry" role="listitem">
NAIC. 2024. <em>Risk-Based Capital</em>.
</div>
<div id="ref-CASHBK" class="csl-entry" role="listitem">
Szkoda, Susan T et al. 1995. <em>CAS Dynamic Financial Analysis Property/Casualty Insurance Companies Handbook</em>. Casualty Actuarial Society. <a href="https://www.casact.org/sites/default/files/database/forum_96wforum_96wf001.pdf">https://www.casact.org/sites/default/files/database/forum_96wforum_96wf001.pdf</a>.
</div>
<div id="ref-Venter2006" class="csl-entry" role="listitem">
Venter, Gary G., John A. Major, and Rodney E. Kreps. 2006. <span>“<span class="nocase">Marginal Decomposition of Risk Measures</span>.”</span> <em>ASTIN Bulletin</em> 36 (2): 375–413. <a href="https://doi.org/10.2143/AST.36.2.2017927">https://doi.org/10.2143/AST.36.2.2017927</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/cmm\.mynl\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./020_BusinessOperations.html" class="pagination-link" aria-label="Business operations">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Business operations</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./040_PricingAndAllocation.html" class="pagination-link" aria-label="Pricing and allocation">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Pricing and allocation</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb1" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu"># Capital adequacy and sources of risk {#sec-Capital-Adequacy}</span></span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a>*Too much of everything is just enough.*\</span>
<span id="cb1-4"><a href="#cb1-4"></a>*—Grateful Dead, "I Need a Miracle"*</span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">## Capital adequacy</span></span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a>What quantity of assets is needed to back the liabilities the firm is taking on? The answer depends on who you ask. Insureds want more protection, meaning lower probability of insolvency and therefore higher assets. Regulators, representing the public, are aligned with the insureds. Investors want to minimize their own risk, so they want to invest less capital (for a given expected profit). Rating agencies are concerned with the counterparty (bond) creditworthiness and claims-paying ability of the firm, so they want to see an adequate level of lower-priority (equity, reinsurance) capital. The firm's own management must adjudicate these competing demands in their own minds: on the one hand, they don't want the firm to go under, but on the other hand, they need to deliver an acceptable rate of return to investors. They will have their own view of the ideal level of assets.</span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a>Even 100% collateralization of liabilities only theoretically guarantees 100% probability of solvency. In practice, insolvency can be caused by nonmodeled or inadequately modeled operational risks, such as fraud, rogue actors within the organization, management missteps, or bad-faith claim judgments in excess of policy limits. Capital adequacy is all about pegging an amount of assets deemed to be safe enough.</span>
<span id="cb1-11"><a href="#cb1-11"></a></span>
<span id="cb1-12"><a href="#cb1-12"></a>In practice it works like this:</span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="ss">1.  </span>Local regulatory authorities prescribe a minimum amount of *assets* and set reserving and valuation standards, which together imply a minimum *capital* requirement.</span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="ss">2.  </span>Rating agencies specify amounts that correspond to different rating levels (effectively, grades) given to the firm. Their models are generally based on statutory valuations but with adjustments, for example, for discount in loss reserves. The implied capital levels are usually higher than the regulatory minimums.</span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="ss">3.  </span>Management decides a target rating level (or in the EU, a ratio of capital to Solvency II–required capital), balancing revenue and profit needs with what they believe their customers will tolerate. For example, personal lines markets are relatively insensitive to ratings, whereas large commercial markets require more highly rated insurers.</span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="ss">4.  </span>Management—with the help of the capital model—will look at the probabilities of adverse events causing the end-of-period assets to breach the above thresholds. They will then likely consider changing reinsurance, raising capital, or reducing exposure to keep these probabilities in control. In a startup situation, they might require an extra capital buffer, but a going concern rarely raises capital except for specific growth opportunities.</span>
<span id="cb1-18"><a href="#cb1-18"></a></span>
<span id="cb1-19"><a href="#cb1-19"></a>While insurance regulations and laws in the US are created and enforced by the individual states, the National Association of Insurance Commissioners (NAIC) develops model laws, regulations, and standards which most states follow. The NAIC created and maintains the Risk-Based Capital (RBC) framework, which is the primary method regulators use to assess capital adequacy. It specifies minimal capital requirements lest an insurer be put under watch or, worse, taken over by the regulators. @NAIC2024RBC provides background on RBC and links to related content.</span>
<span id="cb1-20"><a href="#cb1-20"></a></span>
<span id="cb1-21"><a href="#cb1-21"></a>Insurers in the European Union are bound by the Solvency II Directive <span class="co">[</span><span class="ot">@EIOPA2009</span><span class="co">]</span>. This specifies a Solvency Capital Requirement to be calculated either by a standard model or by a firm's internal model. See @IAARiskMargins09, @Floreani2011, and @Meyers2019a.</span>
<span id="cb1-22"><a href="#cb1-22"></a></span>
<span id="cb1-23"><a href="#cb1-23"></a>Rating agencies include S&amp;P Global Ratings, AM Best, Moody's, and Fitch. They are primarily concerned with credit risk, i.e., assigning bonds a letter grade, but they also concern themselves with insurer claims paying ability, so there are two distinct types of rating. Rating agencies have their own models, often factor-based models similar to NAIC's RBC. @Karakuyu2023RBC describe "S&amp;P Global Ratings' methodology and assumptions for analyzing the risk-based capital (RBC) adequacy of insurers and reinsurers." @Jakobsen2020 explain AM Best's Universal BCAR (Best's Capital Adequacy Ratio) model. @Fitch2024IRC "specifies Fitch Ratings’ criteria for assigning new and monitoring existing international scale insurer Financial Strength (IFS) ratings." Readers should consult the agencies’ websites for the most recent models, as these frameworks are periodically revised.</span>
<span id="cb1-24"><a href="#cb1-24"></a></span>
<span id="cb1-25"><a href="#cb1-25"></a>Larger insurance firms, especially publicly traded firms, tend to be organized into multiple legal entities, groups, and subsidiaries. @CASHBK state: "To properly analyze the financial condition of a company with subsidiaries, each subsidiary should be analyzed separately." Also, "understand debt obligations of company and parent company, look through on debt structure to determine if subsidiaries, etc., have sufficient cash flows to meet parent’s obligations." @CASDFM say that either a consolidated model with internal cash flows between entities or entirely separate models (feeding each other) can be developed. Bear in mind that in stressed situations capital can become trapped.</span>
<span id="cb1-26"><a href="#cb1-26"></a></span>
<span id="cb1-27"><a href="#cb1-27"></a>@Brehm2007 chapter 2.3 compares regulatory and rating agency capital adequacy models. @Eling2008 provide an overview and comparison of RBC requirements from the US, the EU, Switzerland, and New Zealand, although it is somewhat dated.</span>
<span id="cb1-28"><a href="#cb1-28"></a></span>
<span id="cb1-29"><a href="#cb1-29"></a>The firm's management will likely attend to a hierarchy of event possibilities (not necessarily distinct or in order):</span>
<span id="cb1-30"><a href="#cb1-30"></a></span>
<span id="cb1-31"><a href="#cb1-31"></a><span class="ss">-   </span>Missed earnings</span>
<span id="cb1-32"><a href="#cb1-32"></a><span class="ss">-   </span>Spreads widen on bonds; stock price goes down</span>
<span id="cb1-33"><a href="#cb1-33"></a><span class="ss">-   </span>Market value less than book value</span>
<span id="cb1-34"><a href="#cb1-34"></a><span class="ss">-   </span>Bond ratings outlook change (watch)</span>
<span id="cb1-35"><a href="#cb1-35"></a><span class="ss">-   </span>Bond ratings downgrade</span>
<span id="cb1-36"><a href="#cb1-36"></a><span class="ss">-   </span>Claims paying ratings downgrade</span>
<span id="cb1-37"><a href="#cb1-37"></a><span class="ss">-   </span>Being placed on regulatory watch</span>
<span id="cb1-38"><a href="#cb1-38"></a><span class="ss">-   </span>Regulatory supervision, conservatorship or liquidation</span>
<span id="cb1-39"><a href="#cb1-39"></a><span class="ss">-   </span>Loss of significant shareholder equity</span>
<span id="cb1-40"><a href="#cb1-40"></a><span class="ss">-   </span>Loss of all shareholder equity</span>
<span id="cb1-41"><a href="#cb1-41"></a><span class="ss">-   </span>Failure to pay bond interest</span>
<span id="cb1-42"><a href="#cb1-42"></a><span class="ss">-   </span>Failure to fully redeem a bond</span>
<span id="cb1-43"><a href="#cb1-43"></a><span class="ss">-   </span>Bankruptcy and reorganization</span>
<span id="cb1-44"><a href="#cb1-44"></a></span>
<span id="cb1-45"><a href="#cb1-45"></a>All these are highly correlated with the size of loss experienced in an accounting period, and all but missed earnings and market effects can be ameliorated by holding more capital. <span class="co">&lt;!-- STEVE: spreads and stock prices are under the heading of "market effects."" --&gt;</span></span>
<span id="cb1-46"><a href="#cb1-46"></a></span>
<span id="cb1-47"><a href="#cb1-47"></a>Consider the InsCo example described in @tbl-CA-loss-levels. If losses exceed 52.2 (premiums), then InsCo's investors will not receive any gain on their investment. This event has a probability of 30%. If losses are 80 or more ($52.2+27.8$ capital), then shareholders will be wiped out (lose all their investment); the probability is 10%. Sixty cents more and bondholders will not receive their promised coupons, and the company defaults and is put to the debt holders. If losses reach 100 (also a 10% chance), then bondholders will be wiped out as well, suffering a 100% loss-given-default. Regulatory intervention thresholds might be defined by intermediate levels of loss and corresponding probabilities. Any of these might be used as VaR levels to define required assets. This is elaborated on in the next section.</span>
<span id="cb1-48"><a href="#cb1-48"></a></span>
<span id="cb1-49"><a href="#cb1-49"></a>| **Event**               | **Loss Level** | **Probability** |</span>
<span id="cb1-50"><a href="#cb1-50"></a>|:------------------------|---------------:|----------------:|</span>
<span id="cb1-51"><a href="#cb1-51"></a>| Zero profit             |           52.2 |             30% |</span>
<span id="cb1-52"><a href="#cb1-52"></a>| Shareholders wiped out  |           80.0 |             10% |</span>
<span id="cb1-53"><a href="#cb1-53"></a>| Failure to pay coupons  |           80.6 |             10% |</span>
<span id="cb1-54"><a href="#cb1-54"></a>| Failure to redeem bonds |          100.0 |             10% |</span>
<span id="cb1-55"><a href="#cb1-55"></a>| 99% average loss (TVaR) |          100.0 |             10% |</span>
<span id="cb1-56"><a href="#cb1-56"></a></span>
<span id="cb1-57"><a href="#cb1-57"></a>: InsCo critical loss levels. {#tbl-CA-loss-levels}</span>
<span id="cb1-58"><a href="#cb1-58"></a></span>
<span id="cb1-59"><a href="#cb1-59"></a><span class="fu">### **Value at Risk** and **Tail** **Value at Risk**</span></span>
<span id="cb1-60"><a href="#cb1-60"></a></span>
<span id="cb1-61"><a href="#cb1-61"></a>Various different risk measures can be used to calculate required capital. For a thorough discussion, see section 3.6.3 of @PIR. Typically, the goal is to avoid a particular event with specified probability. An exceedance probability measure tells you the probability a firm becomes insolvent at a particular future time given an initial capital level. Inverting that relation determines the capital needed to attain the desired probability of safety. Thus there is a correspondence between risk measures and adequacy measures <span class="co">[</span><span class="ot">@Cherny2009</span><span class="co">]</span>. Exceedance probability measures are common and lead to one or more **Value at Risk (VaR)** criteria: given a threshold probability, e.g., 99.5%, what size of loss will not be exceeded at that probability level?</span>
<span id="cb1-62"><a href="#cb1-62"></a></span>
<span id="cb1-63"><a href="#cb1-63"></a>VaR has a bit of a problem, however. It is not *subadditive*, which means there are situations where the VaR of the sum of two risks is greater than the sum of the two VaRs. Subadditivity is a good property for a risk measure because it means you manage risk from the bottom up: by managing the risk of each unit to be below its own threshold, you have managed the total risk to be below the sum of the thresholds. There are obvious implications for risk and capacity management. Theoretically, because VaR is not subadditive, it is not a good choice to manage risk at the unit level on up. However, this failure is more an academic quibble than a practical shortcoming. In many real-world situations VaR is subadditive, and it has the added benefits of being easy to understand, estimate, and back-test, and of always existing. In practice VaR is the risk measure of choice for insurance regulators around the world—with the exception of the Swiss.</span>
<span id="cb1-64"><a href="#cb1-64"></a></span>
<span id="cb1-65"><a href="#cb1-65"></a>Academics, the Swiss, and bankers in Basel 3 (also in Switzerland), posit a better alternative is **Tail Value at Risk (TVaR)**. TVaR asks, for a given probability level, what is the average loss in the worst events representing that accumulated probability? Defined in this way, TVaR is subadditive, a plus. On the downside, TVaR does not exist for thick-tailed distributions with no mean. It is also much harder to elicit and back-test than VaR. See @PIR for an elaboration on this.</span>
<span id="cb1-66"><a href="#cb1-66"></a></span>
<span id="cb1-67"><a href="#cb1-67"></a>Another issue with TVaR is its precise definition. Historically, TVaR was called Expected Shortfall (ES) and Conditional Value at Risk (CVaR) by some authors. In addition, there are two subtly different measures called Tail Conditional Expectation (TCE) and Worst Conditional Expectation (WCE). In many cases these are all the same, but in many other realistic (discrete) cases they are not. See chapter 4 of @PIR for a thorough analysis of VaR and TVaR.</span>
<span id="cb1-68"><a href="#cb1-68"></a></span>
<span id="cb1-69"><a href="#cb1-69"></a>In many older texts, TVaR is defined as the average of losses above a specified VaR loss value. This coincides with the TCE definition for continuous random variables but not for discrete or mixed variables, and, in those cases, the resulting measure is not subadditive! More recent literature, led by @McNeil2006, uses the definition we give. Formally,</span>
<span id="cb1-70"><a href="#cb1-70"></a>$$</span>
<span id="cb1-71"><a href="#cb1-71"></a>\mathsf{TVaR}_p(X):=\dfrac{1}{1-p}\int_{p}^1 \mathsf{VaR}_s(X)\,ds=</span>
<span id="cb1-72"><a href="#cb1-72"></a>\dfrac{1}{1-p}\int_{p}^1 F^-(s)\,ds</span>
<span id="cb1-73"><a href="#cb1-73"></a>$$</span>
<span id="cb1-74"><a href="#cb1-74"></a>where $F^-(p)$ is the least inverse of the cumulative distribution function. In particular $\mathsf{TVaR}_0(X)=\mathsf E<span class="co">[</span><span class="ot">X</span><span class="co">]</span>$ and $\mathsf{TVaR}_1(X)$ is defined to be $\sup(X)$, the largest possible outcome.</span>
<span id="cb1-75"><a href="#cb1-75"></a></span>
<span id="cb1-76"><a href="#cb1-76"></a>Here are two simple examples to help demystify subadditivity.</span>
<span id="cb1-77"><a href="#cb1-77"></a></span>
<span id="cb1-78"><a href="#cb1-78"></a><span class="ss">1.  </span>**Discrete example.** Consider a probability space with three outcomes, with probability 0.9, 0.05, and 0.05. Unit 1 has outcomes 0, 0, and 10, and unit 2 has 0, 10, and 0. The total outcomes are 0, 10, and 10. The $p=0.9$ VaRs are 0 for each unit, but it is 10 in total. The corresponding TVaRs are 5 for each unit and 10 in total.</span>
<span id="cb1-79"><a href="#cb1-79"></a><span class="ss">2.  </span>**Continuous example.** It is a curious fact that the sum of two standard exponential distributions fails to be subadditive at $p=0.7$ (and neighboring $p$), so the failure can also apply for continuous variables. The unit VaRs are $-\log(0.3)=1.204$ and the sum (a gamma with shape 2) has VaR equal to $2.439$, which is greater than $2 \times 1.204 = 2.408$.</span>
<span id="cb1-80"><a href="#cb1-80"></a></span>
<span id="cb1-81"><a href="#cb1-81"></a>Mirroring the broader VaR-TVaR debate, your authors split in favor of VaR and TVaR. Your capital model must, however, employ *some* risk measure criteria to determine the amount of assets necessary to protect the firm against adverse loss experience. It can, of course, also cheat and select a (T)VaR threshold equating to actual capital held.</span>
<span id="cb1-82"><a href="#cb1-82"></a></span>
<span id="cb1-83"><a href="#cb1-83"></a>Our InsCo example uses assets $a=100$, which can be characterized in various ways. One way is to say there is a $\mathsf{TVaR}_{0.99}$ standard for the amount of assets needed. This is input "C" in @sec-System-Overview. The other way says it is $\mathsf{VaR}_1$. Both result in $a=100$, the maximum loss among the events, which is the asset value assumed previously. Notice two points. First, in practice the order of operations flows from accountants determining the amount of capital to modelers describing its adequacy (99% TVaR). Second, that $a=100$ corresponds to full collateralization, and so it means there is no possibility of default. Default is not driving any results in this example! Nor should it in the preponderance of realistic models for well-rated companies. We might have chosen any VaR or TVaR level beyond 90% and obtained the same arithmetical results. We use TVaR to illustrate the algebra involved with a nontrivial asset risk measure.</span>
<span id="cb1-84"><a href="#cb1-84"></a></span>
<span id="cb1-85"><a href="#cb1-85"></a>In addition to specifying the model capital amount, it would be helpful to have some analytical capabilities to explain what drives the results. This is discussed in the next section.</span>
<span id="cb1-86"><a href="#cb1-86"></a></span>
<span id="cb1-87"><a href="#cb1-87"></a><span class="fu">## Risk analysis {#sec-Risk-Analysis}</span></span>
<span id="cb1-88"><a href="#cb1-88"></a></span>
<span id="cb1-89"><a href="#cb1-89"></a>A main output of the Capital Adequacy module is an assessment of how often there is sufficient capital to avoid various undesirable outcomes. Natural follow-up questions revolve around explaining those results. Having drill-down and diagnostic capabilities is helpful, especially for complex models. These may include:</span>
<span id="cb1-90"><a href="#cb1-90"></a></span>
<span id="cb1-91"><a href="#cb1-91"></a><span class="ss">1.  </span>Statistics of selected variables</span>
<span id="cb1-92"><a href="#cb1-92"></a><span class="ss">2.  </span>Identification of extreme events</span>
<span id="cb1-93"><a href="#cb1-93"></a><span class="ss">3.  </span>Explaining what variables drive outputs</span>
<span id="cb1-94"><a href="#cb1-94"></a><span class="ss">4.  </span>Evaluation of decision rules (e.g., reinsurance)</span>
<span id="cb1-95"><a href="#cb1-95"></a><span class="ss">5.  </span>Risk/reward analysis</span>
<span id="cb1-96"><a href="#cb1-96"></a><span class="ss">6.  </span>A battery of what-if questions</span>
<span id="cb1-97"><a href="#cb1-97"></a></span>
<span id="cb1-98"><a href="#cb1-98"></a>A systematic battery of what-if questions—what if trend is 3% higher than plan? What if hurricane frequency is actually 20% higher than the cat model assumptions?—can reveal where assumptions are particularly sensitive.</span>
<span id="cb1-99"><a href="#cb1-99"></a></span>
<span id="cb1-100"><a href="#cb1-100"></a>Even within the plan, there is an opportunity for sophisticated analysis. For example, machine learning could construct a decision tree to characterize simulation events with high losses.</span>
<span id="cb1-101"><a href="#cb1-101"></a></span>
<span id="cb1-102"><a href="#cb1-102"></a>At this point, there is a fork in the analytic road with two divergent paths that surprisingly rejoin to produce the same conclusion. The paths lead along a dynamic marginal impact analysis and a more static risk-adjusted probability analysis. Early work of @Venter2006 saw the two paths, and more technical work of @Delbaen2000a actually knew the paths rejoined. Our work, @PIR connected the dots more explicitly in an actuarial context.</span>
<span id="cb1-103"><a href="#cb1-103"></a></span>
<span id="cb1-104"><a href="#cb1-104"></a>The first form of risk analysis looks at the marginal impact on required assets of changes in the underlying portfolio. While unrealistic, a linear scaling of the unit loss distributions is often used, i.e., assets $a(X)$ become $a((1+\epsilon)X)$. This is unrealistic because, e.g., doubling one's auto exposures homogeneously will not change $X$ into $2X$. While it may approximately double the expected loss, the *shape* of the distribution will change: the standard deviation will less than double <span class="co">[</span><span class="ot">@Mildenhall2017c</span><span class="co">]</span>. Nonetheless, linear scaling is useful as a directional indicator. We will return to the issue of nonlinear scaling in @sec-portfolio-optimization.</span>
<span id="cb1-105"><a href="#cb1-105"></a></span>
<span id="cb1-106"><a href="#cb1-106"></a>Specifically, the **marginal approach** looks at the **gradient** (slope) of the risk measure: the change resulting from a small change in exposure. If $X=\sum_i X^i$ and $\phi(X)$ is a risk measure, then define</span>
<span id="cb1-107"><a href="#cb1-107"></a>$$</span>
<span id="cb1-108"><a href="#cb1-108"></a>\nabla^i\phi(X) = \frac{\partial}{\partial\epsilon}\phi(X+\epsilon X^i)=\lim_{\epsilon \downarrow 0}\frac{\phi(X+\epsilon X^i)-\phi(X)}{\epsilon}.</span>
<span id="cb1-109"><a href="#cb1-109"></a>$$</span>
<span id="cb1-110"><a href="#cb1-110"></a>If $\phi$ is continuous and *homogeneous*, that is, $\phi(tX)=t\phi(X)$ for $t&gt;0$, then Euler's homogeneous function theorem tells us that $$</span>
<span id="cb1-111"><a href="#cb1-111"></a>\sum_i \nabla^i\phi(X) = \phi(X),</span>
<span id="cb1-112"><a href="#cb1-112"></a>$$ i.e., the marginals consist of an allocation of the original measure <span class="co">[</span><span class="ot">@Mildenhall2004</span><span class="co">]</span>.</span>
<span id="cb1-113"><a href="#cb1-113"></a></span>
<span id="cb1-114"><a href="#cb1-114"></a>In our example, the risk measure is $\phi(X) = \mathsf{TVaR}_{0.99}(X)$. The gradient of this is</span>
<span id="cb1-115"><a href="#cb1-115"></a>$$</span>
<span id="cb1-116"><a href="#cb1-116"></a>\nabla^i(\phi(X)) = \dfrac{1}{1-p}\int_{p}^1 \mathsf E<span class="co">[</span><span class="ot">X^i \mid X=\mathsf{VaR}_s(X)</span><span class="co">]</span>\,ds,</span>
<span id="cb1-117"><a href="#cb1-117"></a>$$</span>
<span id="cb1-118"><a href="#cb1-118"></a>often called the **coTVaR**. Those measures on the three units in our example refer again to the worst of the 10 losses, so the answers are 16, 20, and 64, respectively, see the last event in @tbl-CA-loss-levels.</span>
<span id="cb1-119"><a href="#cb1-119"></a></span>
<span id="cb1-120"><a href="#cb1-120"></a>So far, the discussion refers to required *assets*, not *capital*. To calculate capital, we have to subtract premiums (@eq-funding). This is detailed in @tbl-ca-marginal-analysis. Ideally, *required* capital is calculated based on *required* premiums, but at this stage in our calculations we do not have those numbers.</span>
<span id="cb1-121"><a href="#cb1-121"></a></span>
<span id="cb1-122"><a href="#cb1-122"></a>| **Item**                    | **Unit A** | **Unit B** | **Unit C** | **Portfolio** |</span>
<span id="cb1-123"><a href="#cb1-123"></a>|:----------------------------|-----------:|-----------:|-----------:|--------------:|</span>
<span id="cb1-124"><a href="#cb1-124"></a>| Required assets coTVaR, $a$ |       16.0 |       20.0 |       64.0 |         100.0 |</span>
<span id="cb1-125"><a href="#cb1-125"></a>| Expected loss, $L$          |       13.4 |       18.3 |       14.9 |          46.6 |</span>
<span id="cb1-126"><a href="#cb1-126"></a>| Plan premium                |       13.9 |       18.7 |       19.6 |          52.2 |</span>
<span id="cb1-127"><a href="#cb1-127"></a>| Required capital (plan)     |        2.1 |        1.3 |       44.4 |          47.8 |</span>
<span id="cb1-128"><a href="#cb1-128"></a></span>
<span id="cb1-129"><a href="#cb1-129"></a>: InsCo marginal analysis. {#tbl-ca-marginal-analysis}</span>
<span id="cb1-130"><a href="#cb1-130"></a></span>
<span id="cb1-131"><a href="#cb1-131"></a><span class="co">&lt;!-- |Co-XTVaR                   |        2.6|        1.7|       59.1|         53.4| --&gt;</span></span>
<span id="cb1-132"><a href="#cb1-132"></a></span>
<span id="cb1-133"><a href="#cb1-133"></a>Note that while TVaR submits to marginal analysis fairly well, VaR needs special handling. Say we were concerned with $\mathsf{VaR}_{0.85}=65$. This occurs solidly in event 9 (@tbl-dupe-x). A straightforward marginal analysis breaks this down to:</span>
<span id="cb1-134"><a href="#cb1-134"></a></span>
<span id="cb1-135"><a href="#cb1-135"></a>| **Unit A** | **Unit B** | **Unit C** | **Portfolio** |</span>
<span id="cb1-136"><a href="#cb1-136"></a>|-----------:|-----------:|-----------:|--------------:|</span>
<span id="cb1-137"><a href="#cb1-137"></a>|       17.0 |        8.0 |       40.0 |          65.0 |</span>
<span id="cb1-138"><a href="#cb1-138"></a></span>
<span id="cb1-139"><a href="#cb1-139"></a>: InsCo marginal analysis of $\mathsf{VaR}_{0.85}$. {#tbl-CA-marginal-VaR}</span>
<span id="cb1-140"><a href="#cb1-140"></a></span>
<span id="cb1-141"><a href="#cb1-141"></a>Yet, for both the lower event 8 and higher event 10, line B's contribution is higher. Imagine a more detailed simulation where each event is only worth 1/10,000 probability. Looking at just that specific event, defining the VaR is inviting a good deal of instability. Another run with different random numbers will likely produce materially different results.</span>
<span id="cb1-142"><a href="#cb1-142"></a></span>
<span id="cb1-143"><a href="#cb1-143"></a>There are two ways out of this problem. One is to estimate the conditional expected loss values described in @sec-Complications. The other is to use a more robust replacement for VaR known as **Range Value at Risk** (RVaR) <span class="co">[</span><span class="ot">@Cont2010</span><span class="co">]</span>. This is the average loss occurring between two probability levels. For example, instead of using $\mathsf{VaR}_{0.99}$, you might use $\mathsf{RVaR}_{0.985,0.995}$.</span>
<span id="cb1-144"><a href="#cb1-144"></a></span>
<span id="cb1-145"><a href="#cb1-145"></a>A sign of problems of the marginal approach is the need to stipulate that epsilon <span class="co">&lt;!--# Replace "epsilon" with symbol? --&gt;</span> decreases to zero. When there are ties in the outcome distribution, the risk measure is not actually differentiable! It has a cusp, and depending on whether you increase or decrease volume in a given line, you get different answers. The risk measure is analogous to the absolute value function at zero, where the left and right derivatives are different. (We will see this haunt us in @sec-portfolio-optimization.) To ensure the risk measure is differentiable, and a marginal approach is really valid, it is enough to require that all outcomes of the total distribution be distinct. In that case, for a small enough change in any unit, there is no reordering of the total outcomes and the risk measure is differentiable. We will implement that requirement in the next chapter.</span>
<span id="cb1-146"><a href="#cb1-146"></a></span>
<span id="cb1-147"><a href="#cb1-147"></a>The second form of risk analysis, again following @Venter2006, looks for a set of risk-adjusted probabilities that reproduce the results of the risk measure. With these adjusted probabilities in hand, it is natural to use the risk-adjusted expected value of each unit as an allocation *of risk*. This method is the basis of the *Natural Allocation* described in @PIR and picked up in @sec-Pricing-Allocation to allocate *premium*.</span>
<span id="cb1-148"><a href="#cb1-148"></a></span>
<span id="cb1-149"><a href="#cb1-149"></a></span>
<span id="cb1-150"><a href="#cb1-150"></a><span class="co">&lt;!--</span></span>
<span id="cb1-151"><a href="#cb1-151"></a><span class="co">Here's why it works. When total outcomes are distinct, a small enough change in a unit results in no reordering of total outcomes, and so</span></span>
<span id="cb1-152"><a href="#cb1-152"></a><span class="co">$$</span></span>
<span id="cb1-153"><a href="#cb1-153"></a><span class="co">\begin{aligned}</span></span>
<span id="cb1-154"><a href="#cb1-154"></a><span class="co">\rho(X+\epsilon X)</span></span>
<span id="cb1-155"><a href="#cb1-155"></a><span class="co">&amp;=\mathsf E_q[X+\epsilon X^i] \\</span></span>
<span id="cb1-156"><a href="#cb1-156"></a><span class="co">&amp;=\mathsf E_q[X]+\epsilon\mathsf E_q[X^i] \\</span></span>
<span id="cb1-157"><a href="#cb1-157"></a><span class="co">&amp;=\rho(X) + \epsilon\mathsf E_q[X^i].</span></span>
<span id="cb1-158"><a href="#cb1-158"></a><span class="co">\end{aligned}</span></span>
<span id="cb1-159"><a href="#cb1-159"></a><span class="co">$$</span></span>
<span id="cb1-160"><a href="#cb1-160"></a><span class="co">Therefore $\nabla^i(\phi(X)) = \mathsf E_q[X^i]$!! The two apparently divergent paths have rejoined in a nirvana where these two eminently plausible allocation methodologies agree. But remember, this conclusion depends upon the outcome values of the total distribution being distinct. When the outcomes are not distinct the marginal approach is not defined because it tries to differentiate a non-differentiable function. Historically, this has been address via various unsatisfactory kludges such as insisting that $\epsilon\downarrow 0$, or specifying that volume in such-as-such unit increases or decreases. @PIR offers two alternative solutions: the linear and lifted Natural Allocations. In the former, events with equal total outcomes are collapsed to a single event, thus restoring nirvana. The latter applies when the equal outcomes are caused by a default state where all losses equal the asset level, but where unlimited losses are all distinct. It lifts a unique ordering of events from the distinct unlimited losses.</span></span>
<span id="cb1-161"><a href="#cb1-161"></a><span class="co">--&gt;</span></span>
<span id="cb1-162"><a href="#cb1-162"></a></span>
<span id="cb1-163"><a href="#cb1-163"></a><span class="fu">## Algorithms</span></span>
<span id="cb1-164"><a href="#cb1-164"></a></span>
<span id="cb1-165"><a href="#cb1-165"></a><span class="fu">### Algorithm to evaluate expected loss for discrete random variables</span></span>
<span id="cb1-166"><a href="#cb1-166"></a></span>
<span id="cb1-167"><a href="#cb1-167"></a>The algorithm in this subsection is very basic. We present it to establish an approach to working with discrete random variables that we generalize in subsequent chapters.</span>
<span id="cb1-168"><a href="#cb1-168"></a></span>
<span id="cb1-169"><a href="#cb1-169"></a>We present an algorithm to compute $\mathsf E<span class="co">[</span><span class="ot">X</span><span class="co">]</span>$ in two ways, based on \begin{equation}\label{eq:ex-two-means}</span>
<span id="cb1-170"><a href="#cb1-170"></a>\mathsf E<span class="co">[</span><span class="ot">X</span><span class="co">]</span>=\int_0^\infty xdF(x) = \int_0^\infty S(x)dx.</span>
<span id="cb1-171"><a href="#cb1-171"></a>\end{equation}</span>
<span id="cb1-172"><a href="#cb1-172"></a></span>
<span id="cb1-173"><a href="#cb1-173"></a>**Algorithm Input:** $X$ is a discrete random variable, taking finitely many values $X_j\ge 0$, and $p_j=\mathsf P(X=x_j)$. \index{algorithm!expected loss}</span>
<span id="cb1-174"><a href="#cb1-174"></a></span>
<span id="cb1-175"><a href="#cb1-175"></a>Follow these steps to evaluate \cref{eq:ex-two-means}.</span>
<span id="cb1-176"><a href="#cb1-176"></a></span>
<span id="cb1-177"><a href="#cb1-177"></a>**Algorithm Steps**</span>
<span id="cb1-178"><a href="#cb1-178"></a></span>
<span id="cb1-179"><a href="#cb1-179"></a>(1) **Pad** the input by adding a zero outcome $X=0$ with probability 0.</span>
<span id="cb1-180"><a href="#cb1-180"></a>(2) **Group by** $X_j$ and sum the corresponding $p_j$.</span>
<span id="cb1-181"><a href="#cb1-181"></a>(3) **Sort** events by outcome $X_j$ into ascending order. Relabel events $X_0&lt; X_1 &lt; \dots &lt; X_m$ and probabilities $p_0,\dots, p_m$.</span>
<span id="cb1-182"><a href="#cb1-182"></a>(4) **Decumulate** probabilities to compute the survival function $S_j:=S(X_j)$ using $S_0=1-p_0$ and $S_j=S_{j-1}-p_j$, $j &gt; 0$.</span>
<span id="cb1-183"><a href="#cb1-183"></a>(5) **Difference** the outcomes to compute $\Delta X_j=X_{j+1} - X_j$, $j=0,\dots, m-1$.</span>
<span id="cb1-184"><a href="#cb1-184"></a>(6) **Outcome-probability sum-product:**</span>
<span id="cb1-185"><a href="#cb1-185"></a>    $$</span>
<span id="cb1-186"><a href="#cb1-186"></a>    \mathsf E<span class="co">[</span><span class="ot">X</span><span class="co">]</span> =\int_0^\infty xdF(x)= \sum_{j=1}^m X_j p_j.</span>
<span id="cb1-187"><a href="#cb1-187"></a>    $$ {#eq-ex-d-one}</span>
<span id="cb1-188"><a href="#cb1-188"></a>(7) **Survival function sum-product:**</span>
<span id="cb1-189"><a href="#cb1-189"></a>    $$</span>
<span id="cb1-190"><a href="#cb1-190"></a>    \mathsf E<span class="co">[</span><span class="ot">X</span><span class="co">]</span> = \int_0^\infty S(x)dx = \sum_{j=0}^{m-1} S_{j}\Delta X_j.</span>
<span id="cb1-191"><a href="#cb1-191"></a>    $$ {#eq-ex-d-three}</span>
<span id="cb1-192"><a href="#cb1-192"></a></span>
<span id="cb1-193"><a href="#cb1-193"></a>**Comments**</span>
<span id="cb1-194"><a href="#cb1-194"></a></span>
<span id="cb1-195"><a href="#cb1-195"></a>(a) Step (1) treats 0 as special because the second integral in \cref{eq:ex-two-means} starts at $X=0$. Step (1) allows us to systematically deal with any discrete data. It adds a new outcome row only when the smallest observation is $&gt;0$.</span>
<span id="cb1-196"><a href="#cb1-196"></a>(b) After Step (3), the $X_j$ are distinct; they are in ascending order, $X_0=0$, and $p_j=\mathsf P(X=X_j)$.</span>
<span id="cb1-197"><a href="#cb1-197"></a>(c) In Step (4), $S_m=\mathsf P(X&gt;X_m)=0$ since $X_m$ is the maximum value of $X$.</span>
<span id="cb1-198"><a href="#cb1-198"></a>(d) The forward difference $\Delta X$ computed in Step (5) replaces $dx$ in various formulas. Since it is a forward difference $\Delta X_m$ is undefined. It is also unneeded.</span>
<span id="cb1-199"><a href="#cb1-199"></a>(e) In step (6), the sum starts at $j=1$ because $X_0=0$. Notice that $\mathsf P(X=X_j)=S_{j-1}-S_j$ is the negative backward difference of $S$. <span class="co">&lt;!-- It is negative because $dS=-f(x)dx$. --&gt;</span></span>
<span id="cb1-200"><a href="#cb1-200"></a>(f) Note the index shift between @eq-ex-d-one and @eq-ex-d-three.</span>
<span id="cb1-201"><a href="#cb1-201"></a>(g) Both @eq-ex-d-one and @eq-ex-d-three are exact evaluations. The approximation occurs when the underlying distribution being modeled is replaced with the discrete sample given by $X$.</span>
<span id="cb1-202"><a href="#cb1-202"></a></span>
<span id="cb1-203"><a href="#cb1-203"></a><span class="fu">### Algorithm to evaluate VaR for a discrete distribution</span></span>
<span id="cb1-204"><a href="#cb1-204"></a></span>
<span id="cb1-205"><a href="#cb1-205"></a><span class="co">&lt;!-- JOHN: **Concur?** YES --&gt;</span></span>
<span id="cb1-206"><a href="#cb1-206"></a></span>
<span id="cb1-207"><a href="#cb1-207"></a>**Algorithm input:** $X$ is a discrete random variable, taking $N$ equally likely values $X_j \ge 0$, $j = 0, \dots, N-1$. Probability level $p$.</span>
<span id="cb1-208"><a href="#cb1-208"></a></span>
<span id="cb1-209"><a href="#cb1-209"></a>Follow these steps to determine $\mathsf{VaR}_p(X)$.</span>
<span id="cb1-210"><a href="#cb1-210"></a></span>
<span id="cb1-211"><a href="#cb1-211"></a>**Algorithm steps**</span>
<span id="cb1-212"><a href="#cb1-212"></a></span>
<span id="cb1-213"><a href="#cb1-213"></a>(1) **Sort** outcomes into ascending order $X_0 &lt; \dots &lt; X_{N-1}$.</span>
<span id="cb1-214"><a href="#cb1-214"></a></span>
<span id="cb1-215"><a href="#cb1-215"></a>(2) **Calculate** $n=\lfloor pN\rfloor$, the greatest integer less than or equal to $pN$.</span>
<span id="cb1-216"><a href="#cb1-216"></a></span>
<span id="cb1-217"><a href="#cb1-217"></a>(3) **Return** $\mathsf{VaR}_p(X) := X_{n}$ (since the indexing starts at $0$).</span>
<span id="cb1-218"><a href="#cb1-218"></a></span>
<span id="cb1-219"><a href="#cb1-219"></a>These steps compute the least quantile at level $p$. A $p$ quantile is any value $x$ so that $\mathsf P(X &lt; x) \le p \le \mathsf P(X\le x)$ and $\mathsf{VaR}_p$ is the *smallest* such $x$. If you draw a graph of the distribution function and allow the vertical lines joining jumps to be part of the graph, then this algorithm is just inverting the distribution function by finding the leftmost $x$ at which the graph reaches height $p$, see chapter 4 of @PIR.</span>
<span id="cb1-220"><a href="#cb1-220"></a></span>
<span id="cb1-221"><a href="#cb1-221"></a><span class="fu">### Algorithm to evaluate TVaR for a discrete distribution</span></span>
<span id="cb1-222"><a href="#cb1-222"></a></span>
<span id="cb1-223"><a href="#cb1-223"></a>**Algorithm input:** $X$ is a discrete random variable, taking $N$ equally likely values $X_j\ge 0$, $j=0,\dots, N-1$. Probability level $p$.</span>
<span id="cb1-224"><a href="#cb1-224"></a></span>
<span id="cb1-225"><a href="#cb1-225"></a>Follow these steps to determine $\mathsf{TVaR}_p(X)$.</span>
<span id="cb1-226"><a href="#cb1-226"></a></span>
<span id="cb1-227"><a href="#cb1-227"></a>**Algorithm steps**</span>
<span id="cb1-228"><a href="#cb1-228"></a></span>
<span id="cb1-229"><a href="#cb1-229"></a>(1) **Sort** outcomes into ascending order $X_0 &lt; \dots &lt; X_{N-1}$.</span>
<span id="cb1-230"><a href="#cb1-230"></a>(2) **Find** $n$ so that $n \le pN &lt; (n+1)$.</span>
<span id="cb1-231"><a href="#cb1-231"></a>(3) **If** $n+1=N$, **then** $\mathsf{TVaR}_p(X) := X_{N-1}$ is the largest observation, exit;</span>
<span id="cb1-232"><a href="#cb1-232"></a>(4) **Else** $n &lt; N-1$ and continue.</span>
<span id="cb1-233"><a href="#cb1-233"></a>(5) **Compute** $T_1 := X_{n+1} + \cdots + X_{N-1}$.</span>
<span id="cb1-234"><a href="#cb1-234"></a>(6) **Compute** $T_2 := ((n+1)-pN)x_n$.</span>
<span id="cb1-235"><a href="#cb1-235"></a>(7) **Compute** $\mathsf{TVaR}_p(X) := (1-p)^{-1}(T_1+T_2)/N$.</span>
<span id="cb1-236"><a href="#cb1-236"></a></span>
<span id="cb1-237"><a href="#cb1-237"></a>These steps compute the average of the largest $N(1-p)$ observations. Step (6) adds a pro-rata portion of the $\lfloor N(1-p)\rfloor$ largest observation when $N(1-p)$ is not an integer.</span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>DRAFT - do not redistribute</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>