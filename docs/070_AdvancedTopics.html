<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>8&nbsp; Advanced topics – Introduction to Capital Modeling and Portfolio Management</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./080_Calculations.html" rel="next">
<link href="./065_Evaluation.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-01c78b5cd655e4cd89133cf59d535862.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-44a2bfbc4aea0d0866ad2a0ddca8a790.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<link rel="icon" href="./static/favicon.ico" type="image/x-icon">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="8&nbsp; Advanced topics – Introduction to Capital Modeling and Portfolio Management">
<meta property="og:description" content="">
<meta property="og:image" content="https://cmm.mynl.com/070_AdvancedTopics_files/figure-html/fig-marginals-output-1.png">
<meta property="og:site_name" content="Introduction to Capital Modeling and Portfolio Management">
<meta property="og:image:height" content="3261">
<meta property="og:image:width" content="3279">
<meta name="twitter:title" content="8&nbsp; Advanced topics – Introduction to Capital Modeling and Portfolio Management">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://cmm.mynl.com/070_AdvancedTopics_files/figure-html/fig-marginals-output-1.png">
<meta name="twitter:image-height" content="3261">
<meta name="twitter:image-width" content="3279">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./070_AdvancedTopics.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Advanced topics</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Capital Modeling and Portfolio Management</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dedication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dedication</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./010_Introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./020_BusinessOperations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Business operations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./030_CapitalAdequacy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Capital adequacy and sources of risk</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./040_PricingAndAllocation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Pricing and allocation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./050_Applications.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Applications of pricing and allocation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./060_SelectingSRM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Selecting and calibrating an SRM</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./065_Evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Evaluating models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./070_AdvancedTopics.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Advanced topics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./080_Calculations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Calculations with <code>Aggregate</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./090_EndMatter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Appendices</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bibliography</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">In this chapter:</h2>
   
  <ul>
  <li><a href="#sec-Uncertainty" id="toc-sec-Uncertainty" class="nav-link active" data-scroll-target="#sec-Uncertainty"><span class="header-section-number">8.1</span> Dealing with uncertainty</a></li>
  <li><a href="#sec-iman-conover" id="toc-sec-iman-conover" class="nav-link" data-scroll-target="#sec-iman-conover"><span class="header-section-number">8.2</span> The Iman-Conover method</a>
  <ul class="collapse">
  <li><a href="#loss-or-loss-ratio" id="toc-loss-or-loss-ratio" class="nav-link" data-scroll-target="#loss-or-loss-ratio"><span class="header-section-number">8.2.1</span> Loss or loss ratio?</a></li>
  <li><a href="#sec-example-1" id="toc-sec-example-1" class="nav-link" data-scroll-target="#sec-example-1"><span class="header-section-number">8.2.2</span> Example 1: A simple example</a></li>
  <li><a href="#different-reference-distributions" id="toc-different-reference-distributions" class="nav-link" data-scroll-target="#different-reference-distributions"><span class="header-section-number">8.2.3</span> Different reference distributions</a></li>
  <li><a href="#copulas-as-reference-distributions" id="toc-copulas-as-reference-distributions" class="nav-link" data-scroll-target="#copulas-as-reference-distributions"><span class="header-section-number">8.2.4</span> Copulas as reference distributions</a></li>
  <li><a href="#sec-IC-NC" id="toc-sec-IC-NC" class="nav-link" data-scroll-target="#sec-IC-NC"><span class="header-section-number">8.2.5</span> Iman-Conover compared with the normal copula method</a></li>
  <li><a href="#block-iman-conover-bic" id="toc-block-iman-conover-bic" class="nav-link" data-scroll-target="#block-iman-conover-bic"><span class="header-section-number">8.2.6</span> Block Iman-Conover (BIC)</a></li>
  <li><a href="#example-2-multistate-multiline-correlation" id="toc-example-2-multistate-multiline-correlation" class="nav-link" data-scroll-target="#example-2-multistate-multiline-correlation"><span class="header-section-number">8.2.7</span> Example 2: Multistate, multiline correlation</a></li>
  <li><a href="#theoretical-derivation-of-the-iman-conover-method" id="toc-theoretical-derivation-of-the-iman-conover-method" class="nav-link" data-scroll-target="#theoretical-derivation-of-the-iman-conover-method"><span class="header-section-number">8.2.8</span> Theoretical derivation of the Iman-Conover method</a></li>
  </ul></li>
  <li><a href="#sec-Allocating-Capital" id="toc-sec-Allocating-Capital" class="nav-link" data-scroll-target="#sec-Allocating-Capital"><span class="header-section-number">8.3</span> Allocating capital, if you must</a></li>
  <li><a href="#comparions-with-bodoffs-layer-capital-allocation" id="toc-comparions-with-bodoffs-layer-capital-allocation" class="nav-link" data-scroll-target="#comparions-with-bodoffs-layer-capital-allocation"><span class="header-section-number">8.4</span> Comparions with Bodoff’s layer capital allocation</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-Advanced-Topics" class="quarto-section-identifier"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Advanced topics</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="sec-Uncertainty" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="sec-Uncertainty"><span class="header-section-number">8.1</span> Dealing with uncertainty</h2>
<p><em>In this world, nothing is certain except death and taxes.</em><br>
<em>- Benjamin Franklin, letter to Jean-Baptiste Leroy</em></p>
<p>The purpose of simulation is to estimate certain <strong>quantities of interest</strong> or <strong>QoI</strong>. A QoI is typically a quantile or other function (e.g., mean, risk measure) of the sample outcomes that the simulation created. Since it is being estimated from a sample, it cannot be measured with perfect accuracy because of sampling error. The more simulated samples are created, the more accurate the estimate can be. However, there is another reason that the estimate will not be accurate.</p>
<p><strong>Parameter uncertainty</strong> here is to be distinguished from <strong>process risk</strong>. For example, when you simulate the outcome from a random variable with a lognormal distribution with particular parameters, you are modeling process risk. When you aren’t sure what the parameter values should be, you are suffering from parameter uncertainty. The uncertainty around input parameters will propagate to uncertainty about the QoI. For example, it is well known that ignoring parameter uncertainty often systematically biases estimated quantiles downward. See <span class="citation" data-cites="Jewson2025">Jewson et al. (<a href="references.html#ref-Jewson2025" role="doc-biblioref">2025</a>)</span> for an approach to adjust for this bias.</p>
<p>Parameter uncertainty arises from <em>nonsampling error</em>. There are many potential sources of this in a capital model. Data used to build the model could have erroneous entries, or it might not be of an appropriate vintage or refer to a population that is sufficiently relevant to the modeling task. In building the model, perhaps not all relevant factors have been taken into account. This is not an exhaustive list!</p>
<p>In addition, some parameters vary over time. A data snapshot taken to estimate parameters may be inappropriate to modeling the same phenomenon at a later date.</p>
<p>Parameter uncertainty will likely permeate your modeling efforts, especially if you are trying to make a model that can replicate historical experience. There are several ways to deal with uncertainty:</p>
<ol type="1">
<li><strong>Ignore it.</strong> Use a best estimate of parameter values and let it go at that. While this may be acceptable for early versions of the model, it is not recommended for the long term. At the very least you must disclose that there is some uncertainty as to the QoI values and what the business risks of that are. “The answer is <span class="math inline">\(A\)</span>, but there is some uncertainty.”</li>
<li><strong>Report it.</strong> Statistical analysis of data will usually give some indication of the range (e.g., variance) of parameter values consistent with a chosen model for the data. If you want to push your luck, that insight can be turned into a distributional model for the parameters. Rerun your model with carefully chosen exemplars or a sample from the putative distribution of those random parameters. Report the range or the resulting distribution of the QoI. “The answer is <span class="math inline">\(A \pm \epsilon\)</span>.”</li>
<li><strong>Absorb it.</strong> Classical (frequentist) statistics has prediction intervals to accommodate uncertainty in the parameters; Bayesian theory provides a formal framework for treating parameter uncertainty as another species of process risk. Essentially, this means treating the random parameter as mixing the distribution of QoI, creating what Bayesians call a predictive distribution; see <span class="citation" data-cites="bolstad2016introduction">Bolstad and Curran (<a href="references.html#ref-bolstad2016introduction" role="doc-biblioref">2016</a>)</span> or <span class="citation" data-cites="geisser2017predictive">Geisser (<a href="references.html#ref-geisser2017predictive" role="doc-biblioref">2017</a>)</span>. This is explained in an actuarial context in <span class="citation" data-cites="Kreps1997">Kreps (<a href="references.html#ref-Kreps1997" role="doc-biblioref">1997</a>)</span>; however, <span class="citation" data-cites="Major1999a">Major (<a href="references.html#ref-Major1999a" role="doc-biblioref">1999</a>)</span> finds reasons to doubt it is always the right approach. Prediction intervals are bigger than classically estimated intervals. The QoI is likely to be sensitive to the upper tail, which moves up. “The answer is <span class="math inline">\(A+\delta\)</span>.”</li>
<li><strong>Isolate it.</strong> Find a credible worst-case to offer as an example of what can go wrong. This is the approach covered in <span class="citation" data-cites="Hansen2008">Hansen and Sargent (<a href="references.html#ref-Hansen2008" role="doc-biblioref">2008</a>)</span> and <span class="citation" data-cites="Major2015">Major et al. (<a href="references.html#ref-Major2015" role="doc-biblioref">2015</a>)</span>. Again, this is likely to increase a risk-sensitive QoI. “The answer is <span class="math inline">\(A\)</span>, but it could be as bad as <span class="math inline">\(A+\gamma\)</span>.”</li>
</ol>
<p>For a general treatment, see <span class="citation" data-cites="smith2024uncertainty">Smith (<a href="references.html#ref-smith2024uncertainty" role="doc-biblioref">2024</a>)</span>.</p>
</section>
<section id="sec-iman-conover" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="sec-iman-conover"><span class="header-section-number">8.2</span> The Iman-Conover method</h2>
<p><em>Correlation is not causation, but you can cause some correlation.</em></p>
<p>The Iman-Conover method is an easy way to induce correlation between marginal distributions. Here is the idea. Given samples of <span class="math inline">\(n\)</span> values from <span class="math inline">\(r\)</span> known marginal distributions <span class="math inline">\(X_1,\dots,X_r\)</span> and a desired <span class="math inline">\(r\times r\)</span> (linear) correlation matrix <span class="math inline">\(\Sigma\)</span> between them, reorder the <span class="math inline">\(i\)</span>th sample to have the same rank order as the <span class="math inline">\(i\)</span>th column of a reference distribution of size <span class="math inline">\(n\times r\)</span> with linear correlation <span class="math inline">\(\Sigma\)</span>. The reordered output will then have the same rank correlation as the reference, and since linear correlation and rank correlation are typically close, it will have close to the desired correlation structure. What makes the Iman-Conover method work so effectively is the existence of easy algorithms to determine samples from reference distributions with prescribed correlation structures.</p>
<p>The Iman-Conover method is very powerful, quick, and easy to use. However, it is not magic, and it is constrained by mathematical reality. For given pairs of distributions there is often an upper bound on the <em>linear</em> correlation between them, so if you ask for very high correlation you may be disappointed. You should go back and ask yourself why you think the linear correlation is so high.</p>
<p>Iman-Conover is usually used to induce a desired linear correlation. There other measures, such as rank correlation and Kendall’s tau, that could be used <span class="citation" data-cites="Mildenhall2005a">(<a href="references.html#ref-Mildenhall2005a" role="doc-biblioref">Mildenhall 2005</a>)</span> and the user should reflect on which is most appropriate to their application. If your target is rank correlation, Iman-Conover will give you an exact match.</p>
<p>The <a href="https://aggregate.readthedocs.io/en/latest/5_technical_guides/5_x_iman_conover.html#algorithm"><code>aggregate</code> documentation</a> provides a detailed description of the algorithm, including discussion of using different reference distributions (called scores) in place of the normal, and a comparison with the normal copula method.</p>
<section id="loss-or-loss-ratio" class="level3" data-number="8.2.1">
<h3 data-number="8.2.1" class="anchored" data-anchor-id="loss-or-loss-ratio"><span class="header-section-number">8.2.1</span> Loss or loss ratio?</h3>
<p>Are you modeling correlation of <em>loss ratios</em> or correlation of <em>losses</em>? It is a surprising empirical fact that the former is often greater than the latter, leading to the conclusion that correlation in <em>underwriting results</em> is driven by correlation in <em>premium</em> more than loss, see <span class="citation" data-cites="MildenhallCR2022">Mildenhall (<a href="references.html#ref-MildenhallCR2022" role="doc-biblioref">n.d.</a>)</span>. These findings highlight a stark property-casualty split. Property tends to be loss-volatility driven, with loss correlation caused (and explained) by geographic proximity. Casualty tends to be premium-volatility driven, with loss ratio correlation caused by (account) underwriting and the underwriting cycle.</p>
</section>
<section id="sec-example-1" class="level3" data-number="8.2.2">
<h3 data-number="8.2.2" class="anchored" data-anchor-id="sec-example-1"><span class="header-section-number">8.2.2</span> Example 1: A simple example</h3>
<p>This section presents a simple example applying Iman-Conover to realistic distributions, using the <code>aggregate</code> library. It shows how easy it is to use Iman-Conover in modern programming languages. Another example, with more the details, appears in the <a href="https://aggregate.readthedocs.io/en/latest/5_technical_guides/5_x_iman_conover.html#simple-example-of-iman-conover"><code>aggregate</code> documentation</a>. See <a href="080_Calculations.html#sec-setup-code" class="quarto-xref"><span>Section 9.3</span></a> for instructions to set up your Python environment to replicate the code samples. The full source code to replicate the examples is available on the <a href="https://cmm.mynl.com">Monograph website</a>.</p>
<p>The example works with <span class="math inline">\(r=3\)</span> different marginals: Auto, general liability (GL), and Property. Losses are simulated using frequency-severity aggregate distributions with a lognormal severity and per occurrence limits. Frequency is a gamma-mixed Poisson (negative binomial) with varying CVs. See <span class="citation" data-cites="Mildenhall2023a">Mildenhall (<a href="references.html#ref-Mildenhall2023a" role="doc-biblioref">2023</a>)</span> for a description of the <code>aggregate</code> DecL language, used to specify these portfolios.</p>
<pre><code>port ICExample
    agg Auto      5000 loss  2000 xs 0 sev lognorm  30 cv 2 mixed gamma 0.2
    agg GL        2000 loss  5000 xs 0 sev lognorm  50 cv 5 mixed gamma 0.3
    agg Property  7000 loss 10000 xs 0 sev lognorm 100 cv 5 mixed gamma 0.1</code></pre>
<p>This example uses only 1,000 simulations, but the software can easily handle 100,000 or more. The slowest part of the Iman-Conover algorithm is creating the scores. These are cached, so subsequent runs are very fast, even if the desired correlation matrix changes.</p>
<p><a href="#tbl-samples-agg" class="quarto-xref">Table&nbsp;<span>8.1</span></a> shows summary statistics and the first few samples of the underlying multivariate distribution, and <a href="#fig-marginals" class="quarto-xref">Figure&nbsp;<span>8.1</span></a> shows histograms of each marginal and scatterplots. By construction, the units are approximately independent.</p>
<div id="tbl-samples-agg" class="quarto-layout-panel anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-samples-agg-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;8.1: Set up and summary statistics of sample for Iman-Conover example using 1,000 samples.
</figcaption>
<div aria-describedby="tbl-samples-agg-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-samples-agg" style="flex-basis: 100.0%;justify-content: center;">
<div class="greater-table">
<style>
    #TYIXFS6PGJMR2  {
    border-collapse: collapse;
    font-family: "Roboto", "Open Sans Condensed", "Arial", 'Segoe UI', sans-serif;
    font-size: 1.0em;
    width: auto;
    
    margin: 10px auto;
    border: none;
    overflow: auto;
    margin-left: auto;
    margin-right: auto;
    }
    
    
    
    #TYIXFS6PGJMR2 caption {
        padding: 4px 10px 2px 10px;
        font-size: 1.1em;
        text-align: center;
        font-weight: normal;
        caption-side: top;
    }
    #TYIXFS6PGJMR2 thead {
        
        border-top: 1px solid #000;
        border-bottom: 1px solid #000;
        font-size: 1.0em;
        }
    #TYIXFS6PGJMR2 tbody {
        
        border-bottom: 1px solid #000;
        }
    #TYIXFS6PGJMR2 th  {
        vertical-align: bottom;
        padding: 4px 10px 4px 10px;
    }
    #TYIXFS6PGJMR2 td {
        
        padding: 2px 10px 2px 10px;
        vertical-align: top;
    }
    
    #TYIXFS6PGJMR2 .grt-hrule-0 {
        border-top: 0.0px solid #000;
    }
    #TYIXFS6PGJMR2 .grt-hrule-1 {
        border-top: 0.0px solid #000;
    }
    #TYIXFS6PGJMR2 .grt-hrule-2 {
        border-top: 0.0px solid #000;
    }
    
    #TYIXFS6PGJMR2 .grt-bhrule-0 {
        border-bottom: 0.0px solid #000;
    }
    #TYIXFS6PGJMR2 .grt-bhrule-1 {
        border-bottom: 0.0px solid #000;
    }
    #TYIXFS6PGJMR2 .grt-vrule-index {
        border-left: 1px solid #000;
    }
    #TYIXFS6PGJMR2 .grt-vrule-0 {
        border-left: 0.0px solid #000;
    }
    #TYIXFS6PGJMR2 .grt-vrule-1 {
        border-left: 0.0px solid #000;
    }
    #TYIXFS6PGJMR2 .grt-vrule-2 {
        border-left: 0.0px solid #000;
    }
    #TYIXFS6PGJMR2 .grt-left {
        text-align: left;
    }
    #TYIXFS6PGJMR2 .grt-center {
        text-align: center;
    }
    #TYIXFS6PGJMR2 .grt-right {
        text-align: right;
        font-variant-numeric: tabular-nums;
    }
    #TYIXFS6PGJMR2 .grt-head {
        font-family: "Times New Roman", 'Courier New';
        font-size: 1.0em;
    }
    #TYIXFS6PGJMR2 .grt-bold {
        font-weight: bold;
    }

</style>

<div id="tbl-samples-agg-1" class="do-not-create-environment quarto-float quarto-figure quarto-figure-center anchored" data-quarto-postprocess="true">
<figure class="quarto-float quarto-subfloat-tbl figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-samples-agg-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Summary statistics.
</figcaption>
<div aria-describedby="tbl-samples-agg-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-samples-agg-1" class="do-not-create-environment caption-top table" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="grt-left" style="text-align: left;" data-quarto-table-cell-role="th">index</th>
<th class="grt-center grt-vrule-index" style="text-align: left;" data-quarto-table-cell-role="th">Auto</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">GL</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">Property</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">count</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">1,000</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">1,000</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">1,000</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left" style="text-align: left;">mean</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">5007.1</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">2008.0</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">7106.6</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">std</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">1375.3</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">1398.9</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">3266.2</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left" style="text-align: left;">min</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">1,588</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">195</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">1,244</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">25%</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">4048.2</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">1,085</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">4842.5</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left" style="text-align: left;">50%</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">4,922</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">1,671</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">6380.5</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">75%</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">5,898</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">2,528</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">8,573</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left" style="text-align: left;">max</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">12,229</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">15,100</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">23,390</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">cv</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0.275</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0.697</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0.460</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-execution_count="3" data-ref-parent="tbl-samples-agg" style="flex-basis: 100.0%;justify-content: center;">
<div class="greater-table">
<style>
    #TLH6PUDT4CAKS  {
    border-collapse: collapse;
    font-family: "Roboto", "Open Sans Condensed", "Arial", 'Segoe UI', sans-serif;
    font-size: 1.0em;
    width: auto;
    
    margin: 10px auto;
    border: none;
    overflow: auto;
    margin-left: auto;
    margin-right: auto;
    }
    
    
    
    #TLH6PUDT4CAKS caption {
        padding: 4px 10px 2px 10px;
        font-size: 1.1em;
        text-align: center;
        font-weight: normal;
        caption-side: top;
    }
    #TLH6PUDT4CAKS thead {
        
        border-top: 1px solid #000;
        border-bottom: 1px solid #000;
        font-size: 1.0em;
        }
    #TLH6PUDT4CAKS tbody {
        
        border-bottom: 1px solid #000;
        }
    #TLH6PUDT4CAKS th  {
        vertical-align: bottom;
        padding: 4px 10px 4px 10px;
    }
    #TLH6PUDT4CAKS td {
        
        padding: 2px 10px 2px 10px;
        vertical-align: top;
    }
    
    #TLH6PUDT4CAKS .grt-hrule-0 {
        border-top: 0.0px solid #000;
    }
    #TLH6PUDT4CAKS .grt-hrule-1 {
        border-top: 0.0px solid #000;
    }
    #TLH6PUDT4CAKS .grt-hrule-2 {
        border-top: 0.0px solid #000;
    }
    
    #TLH6PUDT4CAKS .grt-bhrule-0 {
        border-bottom: 0.0px solid #000;
    }
    #TLH6PUDT4CAKS .grt-bhrule-1 {
        border-bottom: 0.0px solid #000;
    }
    #TLH6PUDT4CAKS .grt-vrule-index {
        border-left: 1px solid #000;
    }
    #TLH6PUDT4CAKS .grt-vrule-0 {
        border-left: 0.0px solid #000;
    }
    #TLH6PUDT4CAKS .grt-vrule-1 {
        border-left: 0.0px solid #000;
    }
    #TLH6PUDT4CAKS .grt-vrule-2 {
        border-left: 0.0px solid #000;
    }
    #TLH6PUDT4CAKS .grt-left {
        text-align: left;
    }
    #TLH6PUDT4CAKS .grt-center {
        text-align: center;
    }
    #TLH6PUDT4CAKS .grt-right {
        text-align: right;
        font-variant-numeric: tabular-nums;
    }
    #TLH6PUDT4CAKS .grt-head {
        font-family: "Times New Roman", 'Courier New';
        font-size: 1.0em;
    }
    #TLH6PUDT4CAKS .grt-bold {
        font-weight: bold;
    }

</style>

<div id="tbl-samples-agg-2" class="do-not-create-environment quarto-float quarto-figure quarto-figure-center anchored" data-quarto-postprocess="true">
<figure class="quarto-float quarto-subfloat-tbl figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-samples-agg-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) First 10 samples.
</figcaption>
<div aria-describedby="tbl-samples-agg-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-samples-agg-2" class="do-not-create-environment caption-top table" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="grt-left" style="text-align: left;" data-quarto-table-cell-role="th">index</th>
<th class="grt-center grt-vrule-index" style="text-align: left;" data-quarto-table-cell-role="th">Auto</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">GL</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">Property</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">0</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">6,158</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">1,694</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">4,362</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left" style="text-align: left;">1</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">5,714</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">2,079</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">6,258</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">2</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">5,165</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">2,771</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">3,298</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left" style="text-align: left;">3</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">4,377</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">1,386</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">5,860</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">4</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">5,839</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">994</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">11,687</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left" style="text-align: left;">5</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">4,380</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">2,881</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">7,925</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">6</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">4,504</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">2,087</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">8,936</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left" style="text-align: left;">7</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">7,699</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">907</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">4,746</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">8</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">3,015</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">4,440</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">15,814</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left" style="text-align: left;">9</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">4,167</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">890</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">12,251</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
</div>
</div>
</figure>
</div>
<div id="cell-fig-marginals" class="cell" data-fig-format="png" data-execution_count="5">
<div class="cell-output cell-output-display">
<div id="fig-marginals" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-marginals-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="070_AdvancedTopics_files/figure-html/fig-marginals-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure&nbsp;8.1: Uncorrelated marginals input to IC method. Diagonal shows univariate histograms."><img src="070_AdvancedTopics_files/figure-html/fig-marginals-output-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-marginals-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8.1: Uncorrelated marginals input to IC method. Diagonal shows univariate histograms.
</figcaption>
</figure>
</div>
</div>
</div>
<p>In addition to marginal distributions, Iman-Conover requires a target desired correlation matrix as input. This is produced by a separate analysis, and here we assume it is given by <a href="#tbl-desired-corr" class="quarto-xref">Table&nbsp;<span>8.2</span></a>. Remember, a correlation matrix must be symmetric (easy to check) and positive definite (harder). Matrices computed from statistical analysis may fail to be positive definite if they are not computed from a multivariate sample. Iman-Conover fails if given a nonpositive definite matrix.</p>
<div class="cell" data-execution_count="6">
<div id="tbl-desired-corr" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="6">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-desired-corr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;8.2: Target correlation matrix.
</figcaption>
<div aria-describedby="tbl-desired-corr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="5">
<div class="greater-table">
<style>
    #TW4GYSSZRL2I4  {
    border-collapse: collapse;
    font-family: "Roboto", "Open Sans Condensed", "Arial", 'Segoe UI', sans-serif;
    font-size: 1.0em;
    width: auto;
    
    margin: 10px auto;
    border: none;
    overflow: auto;
    margin-left: auto;
    margin-right: auto;
    }
    
    
    
    #TW4GYSSZRL2I4 caption {
        padding: 4px 10px 2px 10px;
        font-size: 1.1em;
        text-align: center;
        font-weight: normal;
        caption-side: top;
    }
    #TW4GYSSZRL2I4 thead {
        
        border-top: 1px solid #000;
        border-bottom: 1px solid #000;
        font-size: 1.0em;
        }
    #TW4GYSSZRL2I4 tbody {
        
        border-bottom: 1px solid #000;
        }
    #TW4GYSSZRL2I4 th  {
        vertical-align: bottom;
        padding: 4px 10px 4px 10px;
    }
    #TW4GYSSZRL2I4 td {
        
        padding: 2px 10px 2px 10px;
        vertical-align: top;
    }
    
    #TW4GYSSZRL2I4 .grt-hrule-0 {
        border-top: 0.0px solid #000;
    }
    #TW4GYSSZRL2I4 .grt-hrule-1 {
        border-top: 0.0px solid #000;
    }
    #TW4GYSSZRL2I4 .grt-hrule-2 {
        border-top: 0.0px solid #000;
    }
    
    #TW4GYSSZRL2I4 .grt-bhrule-0 {
        border-bottom: 0.0px solid #000;
    }
    #TW4GYSSZRL2I4 .grt-bhrule-1 {
        border-bottom: 0.0px solid #000;
    }
    #TW4GYSSZRL2I4 .grt-vrule-index {
        border-left: 1px solid #000;
    }
    #TW4GYSSZRL2I4 .grt-vrule-0 {
        border-left: 0.0px solid #000;
    }
    #TW4GYSSZRL2I4 .grt-vrule-1 {
        border-left: 0.0px solid #000;
    }
    #TW4GYSSZRL2I4 .grt-vrule-2 {
        border-left: 0.0px solid #000;
    }
    #TW4GYSSZRL2I4 .grt-left {
        text-align: left;
    }
    #TW4GYSSZRL2I4 .grt-center {
        text-align: center;
    }
    #TW4GYSSZRL2I4 .grt-right {
        text-align: right;
        font-variant-numeric: tabular-nums;
    }
    #TW4GYSSZRL2I4 .grt-head {
        font-family: "Times New Roman", 'Courier New';
        font-size: 1.0em;
    }
    #TW4GYSSZRL2I4 .grt-bold {
        font-weight: bold;
    }

</style>

<table id="TW4GYSSZRL2I4" class="do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="grt-left" data-quarto-table-cell-role="th">index</th>
<th class="grt-center grt-vrule-index" data-quarto-table-cell-role="th">Auto</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">GL</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">Property</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="grt-c-0 grt-left">Auto</td>
<td class="grt-c-1 grt-right grt-vrule-index">1</td>
<td class="grt-c-2 grt-right grt-vrule-0">-0.3</td>
<td class="grt-c-3 grt-right grt-vrule-0">0</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left">GL</td>
<td class="grt-c-1 grt-right grt-vrule-index">-0.3</td>
<td class="grt-c-2 grt-right grt-vrule-0">1</td>
<td class="grt-c-3 grt-right grt-vrule-0">0.8</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left">Property</td>
<td class="grt-c-1 grt-right grt-vrule-index">0</td>
<td class="grt-c-2 grt-right grt-vrule-0">0.8</td>
<td class="grt-c-3 grt-right grt-vrule-0">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>The Iman-Conover method is implemented in <code>aggregate</code> by the function <code>iman_conover</code>, so the transformation is simply</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a>df2 <span class="op">=</span> iman_conover(df, desired)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>where <code>desired</code> is the desired correlation matrix. <a href="#tbl-ic" class="quarto-xref">Table&nbsp;<span>8.3</span></a> shows the achieved linear and rank correlation, and the absolute and relative errors. Finally, <a href="#fig-marginals-2" class="quarto-xref">Figure&nbsp;<span>8.2</span></a> provides a scatter plot of the shuffled inputs, making the correlation evident. It is possible to obtain a correlated sample from a <code>Portfolio</code> object by passing in a correlation matrix: the code below extracts a sample and automatically applies Iman-Conover.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a>df <span class="op">=</span> port.sample(n, desired_correlation<span class="op">=</span>desired, keep_total<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-ic" class="quarto-layout-panel anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-ic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;8.3: Achieved correlation matrix and output errors with Iman-Conover method.
</figcaption>
<div aria-describedby="tbl-ic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-ic" style="flex-basis: 100.0%;justify-content: center;">
<div class="greater-table">
<style>
    #TSOTJFYIXN6FY  {
    border-collapse: collapse;
    font-family: "Roboto", "Open Sans Condensed", "Arial", 'Segoe UI', sans-serif;
    font-size: 1.0em;
    width: auto;
    
    margin: 10px auto;
    border: none;
    overflow: auto;
    margin-left: auto;
    margin-right: auto;
    }
    
    
    
    #TSOTJFYIXN6FY caption {
        padding: 4px 10px 2px 10px;
        font-size: 1.1em;
        text-align: center;
        font-weight: normal;
        caption-side: top;
    }
    #TSOTJFYIXN6FY thead {
        
        border-top: 1px solid #000;
        border-bottom: 1px solid #000;
        font-size: 1.0em;
        }
    #TSOTJFYIXN6FY tbody {
        
        border-bottom: 1px solid #000;
        }
    #TSOTJFYIXN6FY th  {
        vertical-align: bottom;
        padding: 4px 10px 4px 10px;
    }
    #TSOTJFYIXN6FY td {
        
        padding: 2px 10px 2px 10px;
        vertical-align: top;
    }
    
    #TSOTJFYIXN6FY .grt-hrule-0 {
        border-top: 0.0px solid #000;
    }
    #TSOTJFYIXN6FY .grt-hrule-1 {
        border-top: 0.0px solid #000;
    }
    #TSOTJFYIXN6FY .grt-hrule-2 {
        border-top: 0.0px solid #000;
    }
    
    #TSOTJFYIXN6FY .grt-bhrule-0 {
        border-bottom: 0.0px solid #000;
    }
    #TSOTJFYIXN6FY .grt-bhrule-1 {
        border-bottom: 0.0px solid #000;
    }
    #TSOTJFYIXN6FY .grt-vrule-index {
        border-left: 1px solid #000;
    }
    #TSOTJFYIXN6FY .grt-vrule-0 {
        border-left: 0.0px solid #000;
    }
    #TSOTJFYIXN6FY .grt-vrule-1 {
        border-left: 0.0px solid #000;
    }
    #TSOTJFYIXN6FY .grt-vrule-2 {
        border-left: 0.0px solid #000;
    }
    #TSOTJFYIXN6FY .grt-left {
        text-align: left;
    }
    #TSOTJFYIXN6FY .grt-center {
        text-align: center;
    }
    #TSOTJFYIXN6FY .grt-right {
        text-align: right;
        font-variant-numeric: tabular-nums;
    }
    #TSOTJFYIXN6FY .grt-head {
        font-family: "Times New Roman", 'Courier New';
        font-size: 1.0em;
    }
    #TSOTJFYIXN6FY .grt-bold {
        font-weight: bold;
    }

</style>

<div id="tbl-ic-1" class="do-not-create-environment quarto-float quarto-figure quarto-figure-center anchored" data-quarto-postprocess="true">
<figure class="quarto-float quarto-subfloat-tbl figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-ic-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Linear correlation
</figcaption>
<div aria-describedby="tbl-ic-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-ic-1" class="do-not-create-environment caption-top table" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="grt-left" style="text-align: left;" data-quarto-table-cell-role="th">index</th>
<th class="grt-center grt-vrule-index" style="text-align: left;" data-quarto-table-cell-role="th">Auto</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">GL</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">Property</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">Auto</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">1</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">-0.265</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">-0.001</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left" style="text-align: left;">GL</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">-0.265</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">1</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0.770</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">Property</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">-0.001</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0.770</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">1</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-ic" style="flex-basis: 100.0%;justify-content: center;">
<div class="greater-table">
<style>
    #TRG3WOZGFBBB3  {
    border-collapse: collapse;
    font-family: "Roboto", "Open Sans Condensed", "Arial", 'Segoe UI', sans-serif;
    font-size: 1.0em;
    width: auto;
    
    margin: 10px auto;
    border: none;
    overflow: auto;
    margin-left: auto;
    margin-right: auto;
    }
    
    
    
    #TRG3WOZGFBBB3 caption {
        padding: 4px 10px 2px 10px;
        font-size: 1.1em;
        text-align: center;
        font-weight: normal;
        caption-side: top;
    }
    #TRG3WOZGFBBB3 thead {
        
        border-top: 1px solid #000;
        border-bottom: 1px solid #000;
        font-size: 1.0em;
        }
    #TRG3WOZGFBBB3 tbody {
        
        border-bottom: 1px solid #000;
        }
    #TRG3WOZGFBBB3 th  {
        vertical-align: bottom;
        padding: 4px 10px 4px 10px;
    }
    #TRG3WOZGFBBB3 td {
        
        padding: 2px 10px 2px 10px;
        vertical-align: top;
    }
    
    #TRG3WOZGFBBB3 .grt-hrule-0 {
        border-top: 0.0px solid #000;
    }
    #TRG3WOZGFBBB3 .grt-hrule-1 {
        border-top: 0.0px solid #000;
    }
    #TRG3WOZGFBBB3 .grt-hrule-2 {
        border-top: 0.0px solid #000;
    }
    
    #TRG3WOZGFBBB3 .grt-bhrule-0 {
        border-bottom: 0.0px solid #000;
    }
    #TRG3WOZGFBBB3 .grt-bhrule-1 {
        border-bottom: 0.0px solid #000;
    }
    #TRG3WOZGFBBB3 .grt-vrule-index {
        border-left: 1px solid #000;
    }
    #TRG3WOZGFBBB3 .grt-vrule-0 {
        border-left: 0.0px solid #000;
    }
    #TRG3WOZGFBBB3 .grt-vrule-1 {
        border-left: 0.0px solid #000;
    }
    #TRG3WOZGFBBB3 .grt-vrule-2 {
        border-left: 0.0px solid #000;
    }
    #TRG3WOZGFBBB3 .grt-left {
        text-align: left;
    }
    #TRG3WOZGFBBB3 .grt-center {
        text-align: center;
    }
    #TRG3WOZGFBBB3 .grt-right {
        text-align: right;
        font-variant-numeric: tabular-nums;
    }
    #TRG3WOZGFBBB3 .grt-head {
        font-family: "Times New Roman", 'Courier New';
        font-size: 1.0em;
    }
    #TRG3WOZGFBBB3 .grt-bold {
        font-weight: bold;
    }

</style>

<div id="tbl-ic-2" class="do-not-create-environment quarto-float quarto-figure quarto-figure-center anchored" data-quarto-postprocess="true">
<figure class="quarto-float quarto-subfloat-tbl figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-ic-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Rank correlation
</figcaption>
<div aria-describedby="tbl-ic-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-ic-2" class="do-not-create-environment caption-top table" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="grt-left" style="text-align: left;" data-quarto-table-cell-role="th">index</th>
<th class="grt-center grt-vrule-index" style="text-align: left;" data-quarto-table-cell-role="th">Auto</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">GL</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">Property</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">Auto</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">1</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">-0.282</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0.009</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left" style="text-align: left;">GL</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">-0.282</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">1</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0.778</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">Property</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0.009</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0.778</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">1</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-ic" style="flex-basis: 100.0%;justify-content: center;">
<div class="greater-table">
<style>
    #TKHVNSNCMNBHO  {
    border-collapse: collapse;
    font-family: "Roboto", "Open Sans Condensed", "Arial", 'Segoe UI', sans-serif;
    font-size: 1.0em;
    width: auto;
    
    margin: 10px auto;
    border: none;
    overflow: auto;
    margin-left: auto;
    margin-right: auto;
    }
    
    
    
    #TKHVNSNCMNBHO caption {
        padding: 4px 10px 2px 10px;
        font-size: 1.1em;
        text-align: center;
        font-weight: normal;
        caption-side: top;
    }
    #TKHVNSNCMNBHO thead {
        
        border-top: 1px solid #000;
        border-bottom: 1px solid #000;
        font-size: 1.0em;
        }
    #TKHVNSNCMNBHO tbody {
        
        border-bottom: 1px solid #000;
        }
    #TKHVNSNCMNBHO th  {
        vertical-align: bottom;
        padding: 4px 10px 4px 10px;
    }
    #TKHVNSNCMNBHO td {
        
        padding: 2px 10px 2px 10px;
        vertical-align: top;
    }
    
    #TKHVNSNCMNBHO .grt-hrule-0 {
        border-top: 0.0px solid #000;
    }
    #TKHVNSNCMNBHO .grt-hrule-1 {
        border-top: 0.0px solid #000;
    }
    #TKHVNSNCMNBHO .grt-hrule-2 {
        border-top: 0.0px solid #000;
    }
    
    #TKHVNSNCMNBHO .grt-bhrule-0 {
        border-bottom: 0.0px solid #000;
    }
    #TKHVNSNCMNBHO .grt-bhrule-1 {
        border-bottom: 0.0px solid #000;
    }
    #TKHVNSNCMNBHO .grt-vrule-index {
        border-left: 1px solid #000;
    }
    #TKHVNSNCMNBHO .grt-vrule-0 {
        border-left: 0.0px solid #000;
    }
    #TKHVNSNCMNBHO .grt-vrule-1 {
        border-left: 0.0px solid #000;
    }
    #TKHVNSNCMNBHO .grt-vrule-2 {
        border-left: 0.0px solid #000;
    }
    #TKHVNSNCMNBHO .grt-left {
        text-align: left;
    }
    #TKHVNSNCMNBHO .grt-center {
        text-align: center;
    }
    #TKHVNSNCMNBHO .grt-right {
        text-align: right;
        font-variant-numeric: tabular-nums;
    }
    #TKHVNSNCMNBHO .grt-head {
        font-family: "Times New Roman", 'Courier New';
        font-size: 1.0em;
    }
    #TKHVNSNCMNBHO .grt-bold {
        font-weight: bold;
    }

</style>

<div id="tbl-ic-3" class="do-not-create-environment quarto-float quarto-figure quarto-figure-center anchored" data-quarto-postprocess="true">
<figure class="quarto-float quarto-subfloat-tbl figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-ic-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Absolute error
</figcaption>
<div aria-describedby="tbl-ic-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-ic-3" class="do-not-create-environment caption-top table" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="grt-left" style="text-align: left;" data-quarto-table-cell-role="th">index</th>
<th class="grt-center grt-vrule-index" style="text-align: left;" data-quarto-table-cell-role="th">Auto</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">GL</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">Property</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">Auto</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0.035</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0.001</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left" style="text-align: left;">GL</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0.035</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0.030</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">Property</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0.001</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0.030</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-execution_count="6" data-ref-parent="tbl-ic" style="flex-basis: 100.0%;justify-content: center;">
<div class="greater-table">
<style>
    #TEGFYWAGKVEML  {
    border-collapse: collapse;
    font-family: "Roboto", "Open Sans Condensed", "Arial", 'Segoe UI', sans-serif;
    font-size: 1.0em;
    width: auto;
    
    margin: 10px auto;
    border: none;
    overflow: auto;
    margin-left: auto;
    margin-right: auto;
    }
    
    
    
    #TEGFYWAGKVEML caption {
        padding: 4px 10px 2px 10px;
        font-size: 1.1em;
        text-align: center;
        font-weight: normal;
        caption-side: top;
    }
    #TEGFYWAGKVEML thead {
        
        border-top: 1px solid #000;
        border-bottom: 1px solid #000;
        font-size: 1.0em;
        }
    #TEGFYWAGKVEML tbody {
        
        border-bottom: 1px solid #000;
        }
    #TEGFYWAGKVEML th  {
        vertical-align: bottom;
        padding: 4px 10px 4px 10px;
    }
    #TEGFYWAGKVEML td {
        
        padding: 2px 10px 2px 10px;
        vertical-align: top;
    }
    
    #TEGFYWAGKVEML .grt-hrule-0 {
        border-top: 0.0px solid #000;
    }
    #TEGFYWAGKVEML .grt-hrule-1 {
        border-top: 0.0px solid #000;
    }
    #TEGFYWAGKVEML .grt-hrule-2 {
        border-top: 0.0px solid #000;
    }
    
    #TEGFYWAGKVEML .grt-bhrule-0 {
        border-bottom: 0.0px solid #000;
    }
    #TEGFYWAGKVEML .grt-bhrule-1 {
        border-bottom: 0.0px solid #000;
    }
    #TEGFYWAGKVEML .grt-vrule-index {
        border-left: 1px solid #000;
    }
    #TEGFYWAGKVEML .grt-vrule-0 {
        border-left: 0.0px solid #000;
    }
    #TEGFYWAGKVEML .grt-vrule-1 {
        border-left: 0.0px solid #000;
    }
    #TEGFYWAGKVEML .grt-vrule-2 {
        border-left: 0.0px solid #000;
    }
    #TEGFYWAGKVEML .grt-left {
        text-align: left;
    }
    #TEGFYWAGKVEML .grt-center {
        text-align: center;
    }
    #TEGFYWAGKVEML .grt-right {
        text-align: right;
        font-variant-numeric: tabular-nums;
    }
    #TEGFYWAGKVEML .grt-head {
        font-family: "Times New Roman", 'Courier New';
        font-size: 1.0em;
    }
    #TEGFYWAGKVEML .grt-bold {
        font-weight: bold;
    }

</style>

<div id="tbl-ic-4" class="do-not-create-environment quarto-float quarto-figure quarto-figure-center anchored" data-quarto-postprocess="true">
<figure class="quarto-float quarto-subfloat-tbl figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-ic-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d) Relative error
</figcaption>
<div aria-describedby="tbl-ic-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-ic-4" class="do-not-create-environment caption-top table" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="grt-left" style="text-align: left;" data-quarto-table-cell-role="th">index</th>
<th class="grt-center grt-vrule-index" style="text-align: left;" data-quarto-table-cell-role="th">Auto</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">GL</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">Property</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">Auto</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">-0.117</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">-inf</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left" style="text-align: left;">GL</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">-0.117</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">-0.037</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">Property</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">-inf</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">-0.037</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
</div>
</div>
</figure>
</div>
<div id="cell-fig-marginals-2" class="cell" data-fig-format="png" data-execution_count="8">
<div class="cell-output cell-output-display">
<div id="fig-marginals-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-marginals-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="070_AdvancedTopics_files/figure-html/fig-marginals-2-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure&nbsp;8.2: Correlated marginals output by the Iman-Conover method. Diagonal shows unchanged univariate histograms, but the scatterplots clearly show the introduction of correlation."><img src="070_AdvancedTopics_files/figure-html/fig-marginals-2-output-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-marginals-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8.2: Correlated marginals output by the Iman-Conover method. Diagonal shows unchanged univariate histograms, but the scatterplots clearly show the introduction of correlation.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="different-reference-distributions" class="level3" data-number="8.2.3">
<h3 data-number="8.2.3" class="anchored" data-anchor-id="different-reference-distributions"><span class="header-section-number">8.2.3</span> Different reference distributions</h3>
<p>The Iman-Conover algorithm relies on a sample from a multivariate reference distribution called scores. A straightforward method to compute a reference is to use the Choleski decomposition method applied to certain independent scores (samples with mean zero and standard deviation one). The standard algorithm uses standard normal scores. However, nothing prevents the use of other distributions for the scores, provided they are suitably normalized to have mean zero and standard deviation one. Several other families of multivariate distributions could be used, such as elliptically contoured distributions (which include the normal and <span class="math inline">\(t\)</span> as a special cases) and the multivariate Laplace distribution. These are all easy to simulate.</p>
<p>The <code>aggregate</code> implementation provides <span class="math inline">\(t\)</span>-distribution scores. It includes an argument <code>dof</code>. By default <code>dof=0</code> resulting in a normal reference. A <code>dof&gt;0</code> is interpreted as degrees of freedom, and the reference becomes a <span class="math inline">\(t\)</span>-distribution. <a href="#fig-t-ref" class="quarto-xref">Figure&nbsp;<span>8.3</span></a> reruns <a href="#sec-example-1" class="quarto-xref"><span>Section 8.2.2</span></a> using a <span class="math inline">\(t\)</span> reference with 2 degrees of freedom, a very extreme choice. It results in more tail correlation, evident in the pinched scatterplots. Be warned, however, that this modeling flexibility definitely falls into the “just because you can, doesn’t mean you should” category!</p>
<div id="cell-fig-t-ref" class="cell" data-fig-format="png" data-execution_count="9">
<div class="cell-output cell-output-display">
<div id="fig-t-ref" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-t-ref-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="070_AdvancedTopics_files/figure-html/fig-t-ref-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure&nbsp;8.3: Correlated marginals using a t-distribution with 2 degrees of freedom."><img src="070_AdvancedTopics_files/figure-html/fig-t-ref-output-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-t-ref-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8.3: Correlated marginals using a <span class="math inline">\(t\)</span>-distribution with 2 degrees of freedom.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="copulas-as-reference-distributions" class="level3" data-number="8.2.4">
<h3 data-number="8.2.4" class="anchored" data-anchor-id="copulas-as-reference-distributions"><span class="header-section-number">8.2.4</span> Copulas as reference distributions</h3>
<p>The reader may be wondering about using a copula as a reference score. Alas, most copulas are only bivariate. Multivariate copulas, aside from those related to elliptical or Laplace distributions already mentioned, are Archimedian, which means they have a single parameter and cannot be calibrated to a desired correlation matrix.</p>
<p>See the <a href="https://aggregate.readthedocs.io/en/latest/5_technical_guides/5_x_working_with_samples.html#alternative-scores"><code>aggregate</code> documentation</a> and <span class="citation" data-cites="Mildenhall2005a">Mildenhall (<a href="references.html#ref-Mildenhall2005a" role="doc-biblioref">2005</a>)</span> for more details.</p>
</section>
<section id="sec-IC-NC" class="level3" data-number="8.2.5">
<h3 data-number="8.2.5" class="anchored" data-anchor-id="sec-IC-NC"><span class="header-section-number">8.2.5</span> Iman-Conover compared with the normal copula method</h3>
<p>The normal copula method is described in <span class="citation" data-cites="WangS1998">Wang (<a href="references.html#ref-WangS1998" role="doc-biblioref">1998</a>)</span>. Given a set of risks <span class="math inline">\((X_1,\dots,X_k)\)</span> with marginal cumulative distribution functions <span class="math inline">\(F_i\)</span> and Kendall’s tau <span class="math inline">\(\tau_{ij}=\tau(X_i,X_j)\)</span> or rank correlation coefficients <span class="math inline">\(r(X_i,X_j)\)</span>, it works as follows. Assume that <span class="math inline">\((Z_1,\dots,Z_k)\)</span> have a multivariate normal joint probability density function given by <span class="math display">\[
f(z_1,\dots,z_k)=\frac{1}{\sqrt{(2\pi)^k|\Sigma|}}\exp(-\mathsf{z}'\Sigma^{-1}\mathsf{z}/2),
\]</span> <span class="math inline">\(\mathsf{z}=(z_1,\dots,z_k)\)</span>, with correlation coefficients <span class="math inline">\(\Sigma_{ij}=\rho_{ij}=\rho(Z_i,Z_j)\)</span>. Let <span class="math inline">\(H(z_1,\dots,z_k)\)</span> be their joint cumulative distribution function. Then <span class="math display">\[
C(u_1,\dots,u_k)=H(\Phi^{-1}(u_1),\dots,\Phi^{-1}(u_k))
\]</span> defines a multivariate uniform cumulative distribution function called the <strong>normal copula</strong>. Using <span class="math inline">\(H\)</span>, the set of variables <span id="eq-ncm"><span class="math display">\[
X_1=F_1^{-1}(\Phi(Z_1)),\dots,X_k=F_1^{-1}(\Phi(Z_k))
\tag{8.1}\]</span></span> have a joint cumulative function <span class="math display">\[
F_{X_1,\dots,X_k}(x_1,\dots,x_k)=H(\Phi^{-1}(F_x(u_1)),\dots,
\Phi^{-1}(F_k(u_k))
\]</span> with marginal cumulative distribution functions <span class="math inline">\(F_1,\dots,F_k\)</span>. The multivariate variables <span class="math inline">\((X_1,\dots,X_k)\)</span> have Kendall’s tau <span class="math display">\[
\tau(X_i,X_j)=\tau(Z_i,Z_j)=\frac{2}{\pi}\arcsin(\rho_{ij})
\]</span> and Spearman’s rank correlation coefficients <span class="math display">\[
\text{rkCorr}(X_i,X_j)=\text{rkCorr}(Z_i,Z_j)=\frac{6}{\pi}\arcsin(\rho_{ij}/2)
\]</span> so <span class="math inline">\(\rho\)</span> can be adjusted to achieve the desired correlation.</p>
<p>In the normal copula method, we simulate from <span class="math inline">\(H\)</span> and then invert using <a href="#eq-ncm" class="quarto-xref">Equation&nbsp;<span>8.1</span></a>. In the Iman-Conover method with normal scores we produce a sample from <span class="math inline">\(H\)</span> such that <span class="math inline">\(\Phi(z_i)\)</span> are equally spaced between zero and one and then, rather than invert the distribution functions, we make the <span class="math inline">\(j\)</span>th order statistic from the input sample correspond to <span class="math inline">\(\Phi(z)=j/(n+1)\)</span> where the input has <span class="math inline">\(n\)</span> observations. Because the <span class="math inline">\(j\)</span>th order statistic of a sample of <span class="math inline">\(n\)</span> observations from a distribution <span class="math inline">\(F\)</span> approximates <span class="math inline">\(F^{-1}(j/(n+1))\)</span>, we see the normal copula and Iman-Conover methods are doing essentially the same thing.</p>
<p>While the normal copula method and the Iman-Conover method are confusingly similar, there are some important differences to bear in mind. Comparing and contrasting the two methods should help clarify how the two algorithms are different.</p>
<ol type="1">
<li><span class="citation" data-cites="WangS1998">Wang (<a href="references.html#ref-WangS1998" role="doc-biblioref">1998</a>)</span> shows the normal copula method corresponds to the Iman-Conover method when the latter is computed using normal scores and the Choleski trick.</li>
<li>The Iman-Conover method works on a given sample of marginal distributions. The normal copula method generates the sample by inverting the distribution function of each marginal as part of the simulation process.</li>
<li>Through the use of scores, the Iman-Conover method relies on a sample of normal variables. The normal copula method could use a similar method, or it could sample randomly from the base normals. Conversely, a sample could be used in the Iman-Conover method.</li>
<li>Only the Iman-Conover method has an adjustment to ensure that the reference multivariate distribution has exactly the required correlation structure.</li>
<li>Iman-Conover method samples have rank correlation exactly equal to a sample from a reference distribution with the correct linear correlation. Normal copula samples have approximately correct linear and rank correlations.</li>
<li>An Iman-Conover method sample must be taken in its entirety to be used correctly. The number of output points is fixed by the number of input points, and the sample is computed in its entirety in one step. Some Iman-Conover tools produce output, which is in a particular order. Thus, if you sample the <span class="math inline">\(n\)</span>th observation from multiple simulations, or take the first <span class="math inline">\(n\)</span> samples, you will not get a random sample from the desired distribution. However, if you select random rows from multiple simulations (or, equivalently, if you randomly permute the rows’ output prior to selecting the <span class="math inline">\(n\)</span>th) then you will obtain the desired random sample. It is important to be aware of these issues before using canned software routines.</li>
<li>The normal copula method produces simulations one at a time, and at each iteration the resulting sample is a sample from the required multivariate distribution. That is, output from the algorithm can be partitioned and used in pieces.</li>
</ol>
<p>In summary, remember that these differences can have material, practical consequences, and it is important not to misuse Iman-Conover method samples.</p>
</section>
<section id="block-iman-conover-bic" class="level3" data-number="8.2.6">
<h3 data-number="8.2.6" class="anchored" data-anchor-id="block-iman-conover-bic"><span class="header-section-number">8.2.6</span> Block Iman-Conover (BIC)</h3>
<p>The Iman-Conover method can lead you into a state of sin: the sin of thinking you can reliably estimate a <span class="math inline">\(100 \times 100\)</span> correlation matrix (or larger). You can’t; don’t try—it’s all noise. Look at the distribution of eigenvalues to see; start by computing the SVD and compare your distribution with that of a random matrix. However, you might be able to say something about the correlation of chunks of your book. Generally (going back to premium is riskier than loss), lines that are underwritten together have correlated loss ratios, and properties that are nearby have correlated losses. The Block Iman-Conover (BIC) method is a way to use this information without fabricating large correlation matrices.</p>
<section id="sec-bic" class="level4" data-number="8.2.6.1">
<h4 data-number="8.2.6.1" class="anchored" data-anchor-id="sec-bic"><span class="header-section-number">8.2.6.1</span> Description of BIC</h4>
<p>BIC is best explained through an example. You underwrite auto liability, GL, and property in four regions: North, East, South, and West. Based on reliable studies, you have a sense of the loss (ratio) correlation between each line overall (a <span class="math inline">\(3 \times 3\)</span> matrix, with three parameters), and, separately, between the total regional results (a <span class="math inline">\(4 \times 4\)</span> matrix, with six parameters). The BIC produces a multivariate sample across all 12 line and region units that incorporates what you know, but using just these nine parameters rather than requiring 66 parameters (for a <span class="math inline">\(12 \times 12\)</span> matrix). Here’s how it works. Pick a number of simulations <span class="math inline">\(n\)</span>, then:</p>
<ol type="1">
<li>Produce four <span class="math inline">\(n \times 3\)</span> matrices with results by line for each region, <span class="math inline">\(R_1\)</span>, <span class="math inline">\(R_2\)</span>, <span class="math inline">\(R_3\)</span>, <span class="math inline">\(R_4\)</span>.</li>
<li>Apply Iman-Conover to each <span class="math inline">\(R_i\)</span> separately using your <span class="math inline">\(3\times 3\)</span> between-line correlation matrix, to produce <span class="math inline">\(\tilde R_i\)</span>.</li>
<li>Sum across simulations in each <span class="math inline">\(\tilde R_i\)</span> to get total regional losses and assemble these into a <span class="math inline">\(n\times 4\)</span> matrix <span class="math inline">\(T\)</span>.</li>
<li>Apply Iman-Conover to <span class="math inline">\(T\)</span> using your <span class="math inline">\(4\times 4\)</span> between-region correlation matrix, and capture the ranking.</li>
<li>Reorder each <span class="math inline">\(\tilde R_i\)</span> <em>by-row</em> according to the ranking in Step 4 to obtain <span class="math inline">\(\tilde{\tilde R_i}\)</span>.</li>
<li>Assemble <span class="math inline">\(\tilde{\tilde R_i}\)</span> together into a <span class="math inline">\(n\times 12\)</span> multivariate sample <span class="math inline">\(X\)</span>.</li>
</ol>
<p>The result of this algorithm has the correct by-line correlation within each region—because in step 5 rows are moved, which preserves their within-group correlation—and the correct correlation of total by region, from step 4.</p>
<p>The <code>aggregate</code> package implements BIC as <code>block_iman_conover</code>. It takes arguments:</p>
<ul>
<li><code>unit_losses</code>: a list of samples, in our example the four blocks <span class="math inline">\(R_i\)</span> of losses by line within a region.</li>
<li><code>intra_unit_corrs</code>: a list of correlation matrices within (intra) each region.</li>
<li><code>inter_unit_corr</code>: the between (inter) unit correlation matrix.</li>
</ul>
<p>The regions can have different numbers of lines, and the intra-correlation matrices can vary across regions. In the example below, we just use four regions with three lines, and we assume the intra-region by-line correlations are all the same.</p>
</section>
</section>
<section id="example-2-multistate-multiline-correlation" class="level3" data-number="8.2.7">
<h3 data-number="8.2.7" class="anchored" data-anchor-id="example-2-multistate-multiline-correlation"><span class="header-section-number">8.2.7</span> Example 2: Multistate, multiline correlation</h3>
<p>Example 2 implements the case described in <a href="#sec-bic" class="quarto-xref"><span>Section 8.2.6.1</span></a>: four regions each with three lines, and reliably estimated correlation matrices between lines and between regions. The next block shows the specification of the regional loss distributions in DecL.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a>port North</span>
<span id="cb4-2"><a href="#cb4-2"></a>    agg Auto_North  <span class="dv">4000</span> loss  <span class="dv">2000</span> xs <span class="dv">0</span> sev lognorm  <span class="dv">30</span> cv <span class="dv">2</span> mixed gamma <span class="fl">.2</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>    agg GL_North    <span class="dv">2000</span> loss  <span class="dv">5000</span> xs <span class="dv">0</span> sev lognorm  <span class="dv">50</span> cv <span class="dv">4</span> mixed gamma <span class="fl">.3</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>    agg Prop_North  <span class="dv">2000</span> loss <span class="dv">10000</span> xs <span class="dv">0</span> sev lognorm <span class="dv">100</span> cv <span class="dv">5</span> mixed gamma <span class="fl">.1</span></span>
<span id="cb4-5"><a href="#cb4-5"></a></span>
<span id="cb4-6"><a href="#cb4-6"></a>port East</span>
<span id="cb4-7"><a href="#cb4-7"></a>    agg Auto_East     <span class="dv">3000</span> loss  <span class="dv">2000</span> xs <span class="dv">0</span> sev lognorm  <span class="dv">30</span> cv <span class="dv">2</span> mixed gamma <span class="fl">.2</span></span>
<span id="cb4-8"><a href="#cb4-8"></a>    agg GL_East       <span class="dv">1000</span> loss  <span class="dv">5000</span> xs <span class="dv">0</span> sev lognorm  <span class="dv">50</span> cv <span class="dv">4</span> mixed gamma <span class="fl">.3</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>    agg Property_East <span class="dv">3000</span> loss <span class="dv">10000</span> xs <span class="dv">0</span> sev lognorm <span class="dv">100</span> cv <span class="dv">5</span> mixed gamma <span class="fl">.1</span></span>
<span id="cb4-10"><a href="#cb4-10"></a></span>
<span id="cb4-11"><a href="#cb4-11"></a>port West</span>
<span id="cb4-12"><a href="#cb4-12"></a>    agg Auto_West     <span class="dv">5000</span> loss  <span class="dv">2000</span> xs <span class="dv">0</span> sev lognorm  <span class="dv">30</span> cv <span class="dv">2</span> mixed gamma <span class="fl">.2</span></span>
<span id="cb4-13"><a href="#cb4-13"></a>    agg GL_West       <span class="dv">2000</span> loss  <span class="dv">5000</span> xs <span class="dv">0</span> sev lognorm  <span class="dv">50</span> cv <span class="dv">4</span> mixed gamma <span class="fl">.3</span></span>
<span id="cb4-14"><a href="#cb4-14"></a>    agg Property_West <span class="dv">2000</span> loss <span class="dv">10000</span> xs <span class="dv">0</span> sev lognorm <span class="dv">100</span> cv <span class="dv">5</span> mixed gamma <span class="fl">.1</span></span>
<span id="cb4-15"><a href="#cb4-15"></a></span>
<span id="cb4-16"><a href="#cb4-16"></a>port South</span>
<span id="cb4-17"><a href="#cb4-17"></a>    agg Auto_South   <span class="dv">5000</span> loss  <span class="dv">2000</span> xs <span class="dv">0</span> sev lognorm  <span class="dv">30</span> cv <span class="dv">2</span> mixed gamma <span class="fl">.2</span></span>
<span id="cb4-18"><a href="#cb4-18"></a>    agg GL_South     <span class="dv">2000</span> loss  <span class="dv">5000</span> xs <span class="dv">0</span> sev lognorm  <span class="dv">50</span> cv <span class="dv">4</span> mixed gamma <span class="fl">.3</span></span>
<span id="cb4-19"><a href="#cb4-19"></a>    agg Prop_South   <span class="dv">7000</span> loss <span class="dv">10000</span> xs <span class="dv">0</span> sev lognorm <span class="dv">100</span> cv <span class="dv">5</span> mixed gamma <span class="fl">.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The losses by line are simulated using frequency-severity aggregate distributions with a lognormal severity and per occurrence limits. Frequency is a gamma-mixed Poisson (negative binomial) with varying CVs. See <span class="citation" data-cites="Mildenhall2023a">Mildenhall (<a href="references.html#ref-Mildenhall2023a" role="doc-biblioref">2023</a>)</span> for a description of the <code>aggregate</code> DecL language, used to specify these portfolios. The South region portfolio was previously used to illustrate the standard Iman-Conover method in <a href="#sec-example-1" class="quarto-xref"><span>Section 8.2.2</span></a>.</p>
<p><a href="#tbl-bic-stats" class="quarto-xref">Table&nbsp;<span>8.4</span></a> <!--# In Table 8.4, the entry for North is formatted differently from the other entries. Please update from 8000.0 to 8,000 to match the rest of the table data. -->shows the expected losses, modeling error, CV, and 99th percentile of total loss by region. Model error means the difference between the output of the Fast Fourier Transform algorithm and the requested input mean losses. As you can see, the two are almost identical. The CVs vary reflecting volume and mix of business between regions.</p>
<div class="cell" data-execution_count="11">
<div id="tbl-bic-stats" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="11">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-bic-stats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;8.4: Expected losses, CV, and 99th percentile loss by region.
</figcaption>
<div aria-describedby="tbl-bic-stats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="10">
<div class="greater-table">
<style>
    #T6PA4PB3U3MNI  {
    border-collapse: collapse;
    font-family: "Roboto", "Open Sans Condensed", "Arial", 'Segoe UI', sans-serif;
    font-size: 1.0em;
    width: auto;
    
    margin: 10px auto;
    border: none;
    overflow: auto;
    margin-left: auto;
    margin-right: auto;
    }
    
    
    
    #T6PA4PB3U3MNI caption {
        padding: 4px 10px 2px 10px;
        font-size: 1.1em;
        text-align: center;
        font-weight: normal;
        caption-side: top;
    }
    #T6PA4PB3U3MNI thead {
        
        border-top: 1px solid #000;
        border-bottom: 1px solid #000;
        font-size: 1.0em;
        }
    #T6PA4PB3U3MNI tbody {
        
        border-bottom: 1px solid #000;
        }
    #T6PA4PB3U3MNI th  {
        vertical-align: bottom;
        padding: 4px 10px 4px 10px;
    }
    #T6PA4PB3U3MNI td {
        
        padding: 2px 10px 2px 10px;
        vertical-align: top;
    }
    
    #T6PA4PB3U3MNI .grt-hrule-0 {
        border-top: 0.0px solid #000;
    }
    #T6PA4PB3U3MNI .grt-hrule-1 {
        border-top: 0.0px solid #000;
    }
    #T6PA4PB3U3MNI .grt-hrule-2 {
        border-top: 0.0px solid #000;
    }
    
    #T6PA4PB3U3MNI .grt-bhrule-0 {
        border-bottom: 0.0px solid #000;
    }
    #T6PA4PB3U3MNI .grt-bhrule-1 {
        border-bottom: 0.0px solid #000;
    }
    #T6PA4PB3U3MNI .grt-vrule-index {
        border-left: 1px solid #000;
    }
    #T6PA4PB3U3MNI .grt-vrule-0 {
        border-left: 0.0px solid #000;
    }
    #T6PA4PB3U3MNI .grt-vrule-1 {
        border-left: 0.0px solid #000;
    }
    #T6PA4PB3U3MNI .grt-vrule-2 {
        border-left: 0.0px solid #000;
    }
    #T6PA4PB3U3MNI .grt-left {
        text-align: left;
    }
    #T6PA4PB3U3MNI .grt-center {
        text-align: center;
    }
    #T6PA4PB3U3MNI .grt-right {
        text-align: right;
        font-variant-numeric: tabular-nums;
    }
    #T6PA4PB3U3MNI .grt-head {
        font-family: "Times New Roman", 'Courier New';
        font-size: 1.0em;
    }
    #T6PA4PB3U3MNI .grt-bold {
        font-weight: bold;
    }

</style>

<table id="T6PA4PB3U3MNI" class="do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="grt-left" data-quarto-table-cell-role="th">Region</th>
<th class="grt-center grt-vrule-index" data-quarto-table-cell-role="th">Expected loss</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">Model Error</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">CV</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">99th percentile</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="grt-c-0 grt-left">North</td>
<td class="grt-c-1 grt-right grt-vrule-index">8000.0</td>
<td class="grt-c-2 grt-right grt-vrule-0">-0.000</td>
<td class="grt-c-3 grt-right grt-vrule-0">0.298</td>
<td class="grt-c-4 grt-right grt-vrule-0">16,237</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left grt-hrule-0">East</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">7,000</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">-0.000</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">0.347</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">15,920</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left grt-hrule-0">South</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">14,000</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">-0.000</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">0.266</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">25,737</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left grt-hrule-0">West</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">9,000</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">-0.000</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">0.276</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">17,331</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>Next, we sample <span class="math inline">\(n=1000\)</span> losses from each region with the intraregion correlation. In this case, all the intraregion by-line correlations are the same, but the method allows them to vary.</p>
<p>The BIC is then run using:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a>ans <span class="op">=</span> block_iman_conover(region_losses, intra_region_correl, inter_region_correl, <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The three panels of <a href="#tbl-bic-inter-corr" class="quarto-xref">Table&nbsp;<span>8.5</span></a> (respectively, <a href="#tbl-bic-intra-corr" class="quarto-xref">Table&nbsp;<span>8.6</span></a>) show the target and achieved inter-region (respectively, intraregion) correlation and the error (difference). The achieved results are very close to those desired.</p>
<div id="tbl-bic-inter-corr" class="quarto-layout-panel anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-bic-inter-corr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;8.5: Target and achieved inter-region correlations.
</figcaption>
<div aria-describedby="tbl-bic-inter-corr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-bic-inter-corr" style="flex-basis: 100.0%;justify-content: center;">
<div class="greater-table">
<style>
    #TZ6GKQH5GCFA6  {
    border-collapse: collapse;
    font-family: "Roboto", "Open Sans Condensed", "Arial", 'Segoe UI', sans-serif;
    font-size: 1.0em;
    width: auto;
    
    margin: 10px auto;
    border: none;
    overflow: auto;
    margin-left: auto;
    margin-right: auto;
    }
    
    
    
    #TZ6GKQH5GCFA6 caption {
        padding: 4px 10px 2px 10px;
        font-size: 1.1em;
        text-align: center;
        font-weight: normal;
        caption-side: top;
    }
    #TZ6GKQH5GCFA6 thead {
        
        border-top: 1px solid #000;
        border-bottom: 1px solid #000;
        font-size: 1.0em;
        }
    #TZ6GKQH5GCFA6 tbody {
        
        border-bottom: 1px solid #000;
        }
    #TZ6GKQH5GCFA6 th  {
        vertical-align: bottom;
        padding: 4px 10px 4px 10px;
    }
    #TZ6GKQH5GCFA6 td {
        
        padding: 2px 10px 2px 10px;
        vertical-align: top;
    }
    
    #TZ6GKQH5GCFA6 .grt-hrule-0 {
        border-top: 0.0px solid #000;
    }
    #TZ6GKQH5GCFA6 .grt-hrule-1 {
        border-top: 0.0px solid #000;
    }
    #TZ6GKQH5GCFA6 .grt-hrule-2 {
        border-top: 0.0px solid #000;
    }
    
    #TZ6GKQH5GCFA6 .grt-bhrule-0 {
        border-bottom: 0.0px solid #000;
    }
    #TZ6GKQH5GCFA6 .grt-bhrule-1 {
        border-bottom: 0.0px solid #000;
    }
    #TZ6GKQH5GCFA6 .grt-vrule-index {
        border-left: 1px solid #000;
    }
    #TZ6GKQH5GCFA6 .grt-vrule-0 {
        border-left: 0.0px solid #000;
    }
    #TZ6GKQH5GCFA6 .grt-vrule-1 {
        border-left: 0.0px solid #000;
    }
    #TZ6GKQH5GCFA6 .grt-vrule-2 {
        border-left: 0.0px solid #000;
    }
    #TZ6GKQH5GCFA6 .grt-left {
        text-align: left;
    }
    #TZ6GKQH5GCFA6 .grt-center {
        text-align: center;
    }
    #TZ6GKQH5GCFA6 .grt-right {
        text-align: right;
        font-variant-numeric: tabular-nums;
    }
    #TZ6GKQH5GCFA6 .grt-head {
        font-family: "Times New Roman", 'Courier New';
        font-size: 1.0em;
    }
    #TZ6GKQH5GCFA6 .grt-bold {
        font-weight: bold;
    }

</style>

<div id="tbl-bic-inter-corr-1" class="do-not-create-environment quarto-float quarto-figure quarto-figure-center anchored" data-quarto-postprocess="true">
<figure class="quarto-float quarto-subfloat-tbl figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-bic-inter-corr-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Target inter-region correlation
</figcaption>
<div aria-describedby="tbl-bic-inter-corr-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-bic-inter-corr-1" class="do-not-create-environment caption-top table" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="grt-left" style="text-align: left;" data-quarto-table-cell-role="th">index</th>
<th class="grt-center grt-vrule-index" style="text-align: left;" data-quarto-table-cell-role="th">North</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">East</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">South</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">West</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">North</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">1</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0.7</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0.2</td>
<td class="grt-c-4 grt-right grt-vrule-0" style="text-align: left;">0</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left" style="text-align: left;">East</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0.7</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">1</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0.4</td>
<td class="grt-c-4 grt-right grt-vrule-0" style="text-align: left;">0.2</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">South</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0.2</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0.4</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">1</td>
<td class="grt-c-4 grt-right grt-vrule-0" style="text-align: left;">0.8</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left" style="text-align: left;">West</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0.2</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0.8</td>
<td class="grt-c-4 grt-right grt-vrule-0" style="text-align: left;">1</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-bic-inter-corr" style="flex-basis: 100.0%;justify-content: center;">
<div class="greater-table">
<style>
    #T3SREKDA6H6N2  {
    border-collapse: collapse;
    font-family: "Roboto", "Open Sans Condensed", "Arial", 'Segoe UI', sans-serif;
    font-size: 1.0em;
    width: auto;
    
    margin: 10px auto;
    border: none;
    overflow: auto;
    margin-left: auto;
    margin-right: auto;
    }
    
    
    
    #T3SREKDA6H6N2 caption {
        padding: 4px 10px 2px 10px;
        font-size: 1.1em;
        text-align: center;
        font-weight: normal;
        caption-side: top;
    }
    #T3SREKDA6H6N2 thead {
        
        border-top: 1px solid #000;
        border-bottom: 1px solid #000;
        font-size: 1.0em;
        }
    #T3SREKDA6H6N2 tbody {
        
        border-bottom: 1px solid #000;
        }
    #T3SREKDA6H6N2 th  {
        vertical-align: bottom;
        padding: 4px 10px 4px 10px;
    }
    #T3SREKDA6H6N2 td {
        
        padding: 2px 10px 2px 10px;
        vertical-align: top;
    }
    
    #T3SREKDA6H6N2 .grt-hrule-0 {
        border-top: 0.0px solid #000;
    }
    #T3SREKDA6H6N2 .grt-hrule-1 {
        border-top: 0.0px solid #000;
    }
    #T3SREKDA6H6N2 .grt-hrule-2 {
        border-top: 0.0px solid #000;
    }
    
    #T3SREKDA6H6N2 .grt-bhrule-0 {
        border-bottom: 0.0px solid #000;
    }
    #T3SREKDA6H6N2 .grt-bhrule-1 {
        border-bottom: 0.0px solid #000;
    }
    #T3SREKDA6H6N2 .grt-vrule-index {
        border-left: 1px solid #000;
    }
    #T3SREKDA6H6N2 .grt-vrule-0 {
        border-left: 0.0px solid #000;
    }
    #T3SREKDA6H6N2 .grt-vrule-1 {
        border-left: 0.0px solid #000;
    }
    #T3SREKDA6H6N2 .grt-vrule-2 {
        border-left: 0.0px solid #000;
    }
    #T3SREKDA6H6N2 .grt-left {
        text-align: left;
    }
    #T3SREKDA6H6N2 .grt-center {
        text-align: center;
    }
    #T3SREKDA6H6N2 .grt-right {
        text-align: right;
        font-variant-numeric: tabular-nums;
    }
    #T3SREKDA6H6N2 .grt-head {
        font-family: "Times New Roman", 'Courier New';
        font-size: 1.0em;
    }
    #T3SREKDA6H6N2 .grt-bold {
        font-weight: bold;
    }

</style>

<div id="tbl-bic-inter-corr-2" class="do-not-create-environment quarto-float quarto-figure quarto-figure-center anchored" data-quarto-postprocess="true">
<figure class="quarto-float quarto-subfloat-tbl figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-bic-inter-corr-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Achieved inter-region correlation
</figcaption>
<div aria-describedby="tbl-bic-inter-corr-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-bic-inter-corr-2" class="do-not-create-environment caption-top table" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="grt-left" style="text-align: left;" data-quarto-table-cell-role="th">index</th>
<th class="grt-center grt-vrule-index" style="text-align: left;" data-quarto-table-cell-role="th">North</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">East</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">South</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">West</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">North</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">1</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0.685</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0.164</td>
<td class="grt-c-4 grt-right grt-vrule-0" style="text-align: left;">-0.003</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left" style="text-align: left;">East</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0.685</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">1</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0.370</td>
<td class="grt-c-4 grt-right grt-vrule-0" style="text-align: left;">0.196</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">South</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0.164</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0.370</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">1</td>
<td class="grt-c-4 grt-right grt-vrule-0" style="text-align: left;">0.801</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left" style="text-align: left;">West</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">-0.003</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0.196</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0.801</td>
<td class="grt-c-4 grt-right grt-vrule-0" style="text-align: left;">1</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-bic-inter-corr" style="flex-basis: 100.0%;justify-content: center;">
<div class="greater-table">
<style>
    #T4WF4OCCDUXOO  {
    border-collapse: collapse;
    font-family: "Roboto", "Open Sans Condensed", "Arial", 'Segoe UI', sans-serif;
    font-size: 1.0em;
    width: auto;
    
    margin: 10px auto;
    border: none;
    overflow: auto;
    margin-left: auto;
    margin-right: auto;
    }
    
    
    
    #T4WF4OCCDUXOO caption {
        padding: 4px 10px 2px 10px;
        font-size: 1.1em;
        text-align: center;
        font-weight: normal;
        caption-side: top;
    }
    #T4WF4OCCDUXOO thead {
        
        border-top: 1px solid #000;
        border-bottom: 1px solid #000;
        font-size: 1.0em;
        }
    #T4WF4OCCDUXOO tbody {
        
        border-bottom: 1px solid #000;
        }
    #T4WF4OCCDUXOO th  {
        vertical-align: bottom;
        padding: 4px 10px 4px 10px;
    }
    #T4WF4OCCDUXOO td {
        
        padding: 2px 10px 2px 10px;
        vertical-align: top;
    }
    
    #T4WF4OCCDUXOO .grt-hrule-0 {
        border-top: 0.0px solid #000;
    }
    #T4WF4OCCDUXOO .grt-hrule-1 {
        border-top: 0.0px solid #000;
    }
    #T4WF4OCCDUXOO .grt-hrule-2 {
        border-top: 0.0px solid #000;
    }
    
    #T4WF4OCCDUXOO .grt-bhrule-0 {
        border-bottom: 0.0px solid #000;
    }
    #T4WF4OCCDUXOO .grt-bhrule-1 {
        border-bottom: 0.0px solid #000;
    }
    #T4WF4OCCDUXOO .grt-vrule-index {
        border-left: 1px solid #000;
    }
    #T4WF4OCCDUXOO .grt-vrule-0 {
        border-left: 0.0px solid #000;
    }
    #T4WF4OCCDUXOO .grt-vrule-1 {
        border-left: 0.0px solid #000;
    }
    #T4WF4OCCDUXOO .grt-vrule-2 {
        border-left: 0.0px solid #000;
    }
    #T4WF4OCCDUXOO .grt-left {
        text-align: left;
    }
    #T4WF4OCCDUXOO .grt-center {
        text-align: center;
    }
    #T4WF4OCCDUXOO .grt-right {
        text-align: right;
        font-variant-numeric: tabular-nums;
    }
    #T4WF4OCCDUXOO .grt-head {
        font-family: "Times New Roman", 'Courier New';
        font-size: 1.0em;
    }
    #T4WF4OCCDUXOO .grt-bold {
        font-weight: bold;
    }

</style>

<div id="tbl-bic-inter-corr-3" class="do-not-create-environment quarto-float quarto-figure quarto-figure-center anchored" data-quarto-postprocess="true">
<figure class="quarto-float quarto-subfloat-tbl figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-bic-inter-corr-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Difference
</figcaption>
<div aria-describedby="tbl-bic-inter-corr-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-bic-inter-corr-3" class="do-not-create-environment caption-top table" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="grt-left" style="text-align: left;" data-quarto-table-cell-role="th">index</th>
<th class="grt-center grt-vrule-index" style="text-align: left;" data-quarto-table-cell-role="th">North</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">East</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">South</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">West</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">North</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0.015</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0.036</td>
<td class="grt-c-4 grt-right grt-vrule-0" style="text-align: left;">0.003</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left" style="text-align: left;">East</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0.015</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0.030</td>
<td class="grt-c-4 grt-right grt-vrule-0" style="text-align: left;">0.004</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">South</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0.036</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0.030</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0</td>
<td class="grt-c-4 grt-right grt-vrule-0" style="text-align: left;">-0.001</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left" style="text-align: left;">West</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0.003</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0.004</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">-0.001</td>
<td class="grt-c-4 grt-right grt-vrule-0" style="text-align: left;">0</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
</div>
</div>
</figure>
</div>
<div id="tbl-bic-intra-corr" class="quarto-layout-panel anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-bic-intra-corr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;8.6: Achieved (a-d) and target (e) intra-region correlation.
</figcaption>
<div aria-describedby="tbl-bic-intra-corr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-bic-intra-corr" style="flex-basis: 100.0%;justify-content: center;">
<div class="greater-table">
<style>
    #TBH6MIB3XPXPE  {
    border-collapse: collapse;
    font-family: "Roboto", "Open Sans Condensed", "Arial", 'Segoe UI', sans-serif;
    font-size: 1.0em;
    width: auto;
    
    margin: 10px auto;
    border: none;
    overflow: auto;
    margin-left: auto;
    margin-right: auto;
    }
    
    
    
    #TBH6MIB3XPXPE caption {
        padding: 4px 10px 2px 10px;
        font-size: 1.1em;
        text-align: center;
        font-weight: normal;
        caption-side: top;
    }
    #TBH6MIB3XPXPE thead {
        
        border-top: 1px solid #000;
        border-bottom: 1px solid #000;
        font-size: 1.0em;
        }
    #TBH6MIB3XPXPE tbody {
        
        border-bottom: 1px solid #000;
        }
    #TBH6MIB3XPXPE th  {
        vertical-align: bottom;
        padding: 4px 10px 4px 10px;
    }
    #TBH6MIB3XPXPE td {
        
        padding: 2px 10px 2px 10px;
        vertical-align: top;
    }
    
    #TBH6MIB3XPXPE .grt-hrule-0 {
        border-top: 0.0px solid #000;
    }
    #TBH6MIB3XPXPE .grt-hrule-1 {
        border-top: 0.0px solid #000;
    }
    #TBH6MIB3XPXPE .grt-hrule-2 {
        border-top: 0.0px solid #000;
    }
    
    #TBH6MIB3XPXPE .grt-bhrule-0 {
        border-bottom: 0.0px solid #000;
    }
    #TBH6MIB3XPXPE .grt-bhrule-1 {
        border-bottom: 0.0px solid #000;
    }
    #TBH6MIB3XPXPE .grt-vrule-index {
        border-left: 1px solid #000;
    }
    #TBH6MIB3XPXPE .grt-vrule-0 {
        border-left: 0.0px solid #000;
    }
    #TBH6MIB3XPXPE .grt-vrule-1 {
        border-left: 0.0px solid #000;
    }
    #TBH6MIB3XPXPE .grt-vrule-2 {
        border-left: 0.0px solid #000;
    }
    #TBH6MIB3XPXPE .grt-left {
        text-align: left;
    }
    #TBH6MIB3XPXPE .grt-center {
        text-align: center;
    }
    #TBH6MIB3XPXPE .grt-right {
        text-align: right;
        font-variant-numeric: tabular-nums;
    }
    #TBH6MIB3XPXPE .grt-head {
        font-family: "Times New Roman", 'Courier New';
        font-size: 1.0em;
    }
    #TBH6MIB3XPXPE .grt-bold {
        font-weight: bold;
    }

</style>

<div id="tbl-bic-intra-corr-1" class="do-not-create-environment quarto-float quarto-figure quarto-figure-center anchored" data-quarto-postprocess="true">
<figure class="quarto-float quarto-subfloat-tbl figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-bic-intra-corr-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) North
</figcaption>
<div aria-describedby="tbl-bic-intra-corr-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-bic-intra-corr-1" class="do-not-create-environment caption-top table" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="grt-left" style="text-align: left;" data-quarto-table-cell-role="th">index</th>
<th class="grt-center grt-vrule-index" style="text-align: left;" data-quarto-table-cell-role="th">N-AL</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">N-GL</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">N-Pr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">N-AL</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">1</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0.567</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0.177</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left" style="text-align: left;">N-GL</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0.567</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">1</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0.323</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">N-Pr</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0.177</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0.323</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">1</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-bic-intra-corr" style="flex-basis: 100.0%;justify-content: center;">
<div class="greater-table">
<style>
    #THKRE5ZLIVCVB  {
    border-collapse: collapse;
    font-family: "Roboto", "Open Sans Condensed", "Arial", 'Segoe UI', sans-serif;
    font-size: 1.0em;
    width: auto;
    
    margin: 10px auto;
    border: none;
    overflow: auto;
    margin-left: auto;
    margin-right: auto;
    }
    
    
    
    #THKRE5ZLIVCVB caption {
        padding: 4px 10px 2px 10px;
        font-size: 1.1em;
        text-align: center;
        font-weight: normal;
        caption-side: top;
    }
    #THKRE5ZLIVCVB thead {
        
        border-top: 1px solid #000;
        border-bottom: 1px solid #000;
        font-size: 1.0em;
        }
    #THKRE5ZLIVCVB tbody {
        
        border-bottom: 1px solid #000;
        }
    #THKRE5ZLIVCVB th  {
        vertical-align: bottom;
        padding: 4px 10px 4px 10px;
    }
    #THKRE5ZLIVCVB td {
        
        padding: 2px 10px 2px 10px;
        vertical-align: top;
    }
    
    #THKRE5ZLIVCVB .grt-hrule-0 {
        border-top: 0.0px solid #000;
    }
    #THKRE5ZLIVCVB .grt-hrule-1 {
        border-top: 0.0px solid #000;
    }
    #THKRE5ZLIVCVB .grt-hrule-2 {
        border-top: 0.0px solid #000;
    }
    
    #THKRE5ZLIVCVB .grt-bhrule-0 {
        border-bottom: 0.0px solid #000;
    }
    #THKRE5ZLIVCVB .grt-bhrule-1 {
        border-bottom: 0.0px solid #000;
    }
    #THKRE5ZLIVCVB .grt-vrule-index {
        border-left: 1px solid #000;
    }
    #THKRE5ZLIVCVB .grt-vrule-0 {
        border-left: 0.0px solid #000;
    }
    #THKRE5ZLIVCVB .grt-vrule-1 {
        border-left: 0.0px solid #000;
    }
    #THKRE5ZLIVCVB .grt-vrule-2 {
        border-left: 0.0px solid #000;
    }
    #THKRE5ZLIVCVB .grt-left {
        text-align: left;
    }
    #THKRE5ZLIVCVB .grt-center {
        text-align: center;
    }
    #THKRE5ZLIVCVB .grt-right {
        text-align: right;
        font-variant-numeric: tabular-nums;
    }
    #THKRE5ZLIVCVB .grt-head {
        font-family: "Times New Roman", 'Courier New';
        font-size: 1.0em;
    }
    #THKRE5ZLIVCVB .grt-bold {
        font-weight: bold;
    }

</style>

<div id="tbl-bic-intra-corr-2" class="do-not-create-environment quarto-float quarto-figure quarto-figure-center anchored" data-quarto-postprocess="true">
<figure class="quarto-float quarto-subfloat-tbl figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-bic-intra-corr-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) East
</figcaption>
<div aria-describedby="tbl-bic-intra-corr-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-bic-intra-corr-2" class="do-not-create-environment caption-top table" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="grt-left" style="text-align: left;" data-quarto-table-cell-role="th">index</th>
<th class="grt-center grt-vrule-index" style="text-align: left;" data-quarto-table-cell-role="th">E-AL</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">E-GL</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">E-Pr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">E-AL</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">1</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0.535</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0.185</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left" style="text-align: left;">E-GL</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0.535</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">1</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0.318</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">E-Pr</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0.185</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0.318</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">1</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-bic-intra-corr" style="flex-basis: 100.0%;justify-content: center;">
<div class="greater-table">
<style>
    #TK45XV577EHHS  {
    border-collapse: collapse;
    font-family: "Roboto", "Open Sans Condensed", "Arial", 'Segoe UI', sans-serif;
    font-size: 1.0em;
    width: auto;
    
    margin: 10px auto;
    border: none;
    overflow: auto;
    margin-left: auto;
    margin-right: auto;
    }
    
    
    
    #TK45XV577EHHS caption {
        padding: 4px 10px 2px 10px;
        font-size: 1.1em;
        text-align: center;
        font-weight: normal;
        caption-side: top;
    }
    #TK45XV577EHHS thead {
        
        border-top: 1px solid #000;
        border-bottom: 1px solid #000;
        font-size: 1.0em;
        }
    #TK45XV577EHHS tbody {
        
        border-bottom: 1px solid #000;
        }
    #TK45XV577EHHS th  {
        vertical-align: bottom;
        padding: 4px 10px 4px 10px;
    }
    #TK45XV577EHHS td {
        
        padding: 2px 10px 2px 10px;
        vertical-align: top;
    }
    
    #TK45XV577EHHS .grt-hrule-0 {
        border-top: 0.0px solid #000;
    }
    #TK45XV577EHHS .grt-hrule-1 {
        border-top: 0.0px solid #000;
    }
    #TK45XV577EHHS .grt-hrule-2 {
        border-top: 0.0px solid #000;
    }
    
    #TK45XV577EHHS .grt-bhrule-0 {
        border-bottom: 0.0px solid #000;
    }
    #TK45XV577EHHS .grt-bhrule-1 {
        border-bottom: 0.0px solid #000;
    }
    #TK45XV577EHHS .grt-vrule-index {
        border-left: 1px solid #000;
    }
    #TK45XV577EHHS .grt-vrule-0 {
        border-left: 0.0px solid #000;
    }
    #TK45XV577EHHS .grt-vrule-1 {
        border-left: 0.0px solid #000;
    }
    #TK45XV577EHHS .grt-vrule-2 {
        border-left: 0.0px solid #000;
    }
    #TK45XV577EHHS .grt-left {
        text-align: left;
    }
    #TK45XV577EHHS .grt-center {
        text-align: center;
    }
    #TK45XV577EHHS .grt-right {
        text-align: right;
        font-variant-numeric: tabular-nums;
    }
    #TK45XV577EHHS .grt-head {
        font-family: "Times New Roman", 'Courier New';
        font-size: 1.0em;
    }
    #TK45XV577EHHS .grt-bold {
        font-weight: bold;
    }

</style>

<div id="tbl-bic-intra-corr-3" class="do-not-create-environment quarto-float quarto-figure quarto-figure-center anchored" data-quarto-postprocess="true">
<figure class="quarto-float quarto-subfloat-tbl figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-bic-intra-corr-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) South
</figcaption>
<div aria-describedby="tbl-bic-intra-corr-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-bic-intra-corr-3" class="do-not-create-environment caption-top table" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="grt-left" style="text-align: left;" data-quarto-table-cell-role="th">index</th>
<th class="grt-center grt-vrule-index" style="text-align: left;" data-quarto-table-cell-role="th">S-AL</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">S-GL</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">S-Pr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">S-AL</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">1</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0.566</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0.189</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left" style="text-align: left;">S-GL</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0.566</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">1</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0.355</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">S-Pr</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0.189</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0.355</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">1</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-bic-intra-corr" style="flex-basis: 100.0%;justify-content: center;">
<div class="greater-table">
<style>
    #T3ANBMY7N5ADS  {
    border-collapse: collapse;
    font-family: "Roboto", "Open Sans Condensed", "Arial", 'Segoe UI', sans-serif;
    font-size: 1.0em;
    width: auto;
    
    margin: 10px auto;
    border: none;
    overflow: auto;
    margin-left: auto;
    margin-right: auto;
    }
    
    
    
    #T3ANBMY7N5ADS caption {
        padding: 4px 10px 2px 10px;
        font-size: 1.1em;
        text-align: center;
        font-weight: normal;
        caption-side: top;
    }
    #T3ANBMY7N5ADS thead {
        
        border-top: 1px solid #000;
        border-bottom: 1px solid #000;
        font-size: 1.0em;
        }
    #T3ANBMY7N5ADS tbody {
        
        border-bottom: 1px solid #000;
        }
    #T3ANBMY7N5ADS th  {
        vertical-align: bottom;
        padding: 4px 10px 4px 10px;
    }
    #T3ANBMY7N5ADS td {
        
        padding: 2px 10px 2px 10px;
        vertical-align: top;
    }
    
    #T3ANBMY7N5ADS .grt-hrule-0 {
        border-top: 0.0px solid #000;
    }
    #T3ANBMY7N5ADS .grt-hrule-1 {
        border-top: 0.0px solid #000;
    }
    #T3ANBMY7N5ADS .grt-hrule-2 {
        border-top: 0.0px solid #000;
    }
    
    #T3ANBMY7N5ADS .grt-bhrule-0 {
        border-bottom: 0.0px solid #000;
    }
    #T3ANBMY7N5ADS .grt-bhrule-1 {
        border-bottom: 0.0px solid #000;
    }
    #T3ANBMY7N5ADS .grt-vrule-index {
        border-left: 1px solid #000;
    }
    #T3ANBMY7N5ADS .grt-vrule-0 {
        border-left: 0.0px solid #000;
    }
    #T3ANBMY7N5ADS .grt-vrule-1 {
        border-left: 0.0px solid #000;
    }
    #T3ANBMY7N5ADS .grt-vrule-2 {
        border-left: 0.0px solid #000;
    }
    #T3ANBMY7N5ADS .grt-left {
        text-align: left;
    }
    #T3ANBMY7N5ADS .grt-center {
        text-align: center;
    }
    #T3ANBMY7N5ADS .grt-right {
        text-align: right;
        font-variant-numeric: tabular-nums;
    }
    #T3ANBMY7N5ADS .grt-head {
        font-family: "Times New Roman", 'Courier New';
        font-size: 1.0em;
    }
    #T3ANBMY7N5ADS .grt-bold {
        font-weight: bold;
    }

</style>

<div id="tbl-bic-intra-corr-4" class="do-not-create-environment quarto-float quarto-figure quarto-figure-center anchored" data-quarto-postprocess="true">
<figure class="quarto-float quarto-subfloat-tbl figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-bic-intra-corr-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d) West
</figcaption>
<div aria-describedby="tbl-bic-intra-corr-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-bic-intra-corr-4" class="do-not-create-environment caption-top table" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="grt-left" style="text-align: left;" data-quarto-table-cell-role="th">index</th>
<th class="grt-center grt-vrule-index" style="text-align: left;" data-quarto-table-cell-role="th">W-AL</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">W-GL</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">W-Pr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">W-AL</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">1</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0.570</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0.183</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left" style="text-align: left;">W-GL</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0.570</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">1</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0.331</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">W-Pr</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0.183</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0.331</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">1</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-bic-intra-corr" style="flex-basis: 100.0%;justify-content: center;">
<div class="greater-table">
<style>
    #T5WALMGBVFNX3  {
    border-collapse: collapse;
    font-family: "Roboto", "Open Sans Condensed", "Arial", 'Segoe UI', sans-serif;
    font-size: 1.0em;
    width: auto;
    
    margin: 10px auto;
    border: none;
    overflow: auto;
    margin-left: auto;
    margin-right: auto;
    }
    
    
    
    #T5WALMGBVFNX3 caption {
        padding: 4px 10px 2px 10px;
        font-size: 1.1em;
        text-align: center;
        font-weight: normal;
        caption-side: top;
    }
    #T5WALMGBVFNX3 thead {
        
        border-top: 1px solid #000;
        border-bottom: 1px solid #000;
        font-size: 1.0em;
        }
    #T5WALMGBVFNX3 tbody {
        
        border-bottom: 1px solid #000;
        }
    #T5WALMGBVFNX3 th  {
        vertical-align: bottom;
        padding: 4px 10px 4px 10px;
    }
    #T5WALMGBVFNX3 td {
        
        padding: 2px 10px 2px 10px;
        vertical-align: top;
    }
    
    #T5WALMGBVFNX3 .grt-hrule-0 {
        border-top: 0.0px solid #000;
    }
    #T5WALMGBVFNX3 .grt-hrule-1 {
        border-top: 0.0px solid #000;
    }
    #T5WALMGBVFNX3 .grt-hrule-2 {
        border-top: 0.0px solid #000;
    }
    
    #T5WALMGBVFNX3 .grt-bhrule-0 {
        border-bottom: 0.0px solid #000;
    }
    #T5WALMGBVFNX3 .grt-bhrule-1 {
        border-bottom: 0.0px solid #000;
    }
    #T5WALMGBVFNX3 .grt-vrule-index {
        border-left: 1px solid #000;
    }
    #T5WALMGBVFNX3 .grt-vrule-0 {
        border-left: 0.0px solid #000;
    }
    #T5WALMGBVFNX3 .grt-vrule-1 {
        border-left: 0.0px solid #000;
    }
    #T5WALMGBVFNX3 .grt-vrule-2 {
        border-left: 0.0px solid #000;
    }
    #T5WALMGBVFNX3 .grt-left {
        text-align: left;
    }
    #T5WALMGBVFNX3 .grt-center {
        text-align: center;
    }
    #T5WALMGBVFNX3 .grt-right {
        text-align: right;
        font-variant-numeric: tabular-nums;
    }
    #T5WALMGBVFNX3 .grt-head {
        font-family: "Times New Roman", 'Courier New';
        font-size: 1.0em;
    }
    #T5WALMGBVFNX3 .grt-bold {
        font-weight: bold;
    }

</style>

<div id="tbl-bic-intra-corr-5" class="do-not-create-environment quarto-float quarto-figure quarto-figure-center anchored" data-quarto-postprocess="true">
<figure class="quarto-float quarto-subfloat-tbl figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-bic-intra-corr-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(e) Target
</figcaption>
<div aria-describedby="tbl-bic-intra-corr-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-bic-intra-corr-5" class="do-not-create-environment caption-top table" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="grt-left" style="text-align: left;" data-quarto-table-cell-role="th">index</th>
<th class="grt-center grt-vrule-index" style="text-align: left;" data-quarto-table-cell-role="th">W-AL</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">W-GL</th>
<th class="grt-center grt-vrule-0" style="text-align: left;" data-quarto-table-cell-role="th">W-Pr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">W-AL</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">1</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0.6</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0.2</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left" style="text-align: left;">W-GL</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0.6</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">1</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">0.4</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left" style="text-align: left;">W-Pr</td>
<td class="grt-c-1 grt-right grt-vrule-index" style="text-align: left;">0.2</td>
<td class="grt-c-2 grt-right grt-vrule-0" style="text-align: left;">0.4</td>
<td class="grt-c-3 grt-right grt-vrule-0" style="text-align: left;">1</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
</div>
</div>
</figure>
</div>
<p><a href="#tbl-bic-all-corr" class="quarto-xref">Table&nbsp;<span>8.7</span></a> shows the overall correlation matrix at the line-region level (12 x 12 matrix), and <a href="#fig-bic-intra-corr" class="quarto-xref">Figure&nbsp;<span>8.4</span></a> shows an image plot of the same matrix. The underlying block structure is clear from the image. <!--# Please note error message in PDF about table format. --></p>
<div class="cell" data-execution_count="16">
<div id="tbl-bic-all-corr" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="16">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-bic-all-corr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;8.7: Achieved correlation across lines and regions.
</figcaption>
<div aria-describedby="tbl-bic-all-corr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="15">
<div class="greater-table">
<style>
    #TXWX2SRXBJPNR  {
    border-collapse: collapse;
    font-family: "Roboto", "Open Sans Condensed", "Arial", 'Segoe UI', sans-serif;
    font-size: 1.0em;
    width: auto;
    
    margin: 10px auto;
    border: none;
    overflow: auto;
    margin-left: auto;
    margin-right: auto;
    }
    
    
    
    #TXWX2SRXBJPNR caption {
        padding: 4px 10px 2px 10px;
        font-size: 1.1em;
        text-align: center;
        font-weight: normal;
        caption-side: top;
    }
    #TXWX2SRXBJPNR thead {
        
        border-top: 1px solid #000;
        border-bottom: 1px solid #000;
        font-size: 1.0em;
        }
    #TXWX2SRXBJPNR tbody {
        
        border-bottom: 1px solid #000;
        }
    #TXWX2SRXBJPNR th  {
        vertical-align: bottom;
        padding: 4px 10px 4px 10px;
    }
    #TXWX2SRXBJPNR td {
        
        padding: 2px 10px 2px 10px;
        vertical-align: top;
    }
    
    #TXWX2SRXBJPNR .grt-hrule-0 {
        border-top: 0.0px solid #000;
    }
    #TXWX2SRXBJPNR .grt-hrule-1 {
        border-top: 0.0px solid #000;
    }
    #TXWX2SRXBJPNR .grt-hrule-2 {
        border-top: 0.0px solid #000;
    }
    
    #TXWX2SRXBJPNR .grt-bhrule-0 {
        border-bottom: 0.0px solid #000;
    }
    #TXWX2SRXBJPNR .grt-bhrule-1 {
        border-bottom: 0.0px solid #000;
    }
    #TXWX2SRXBJPNR .grt-vrule-index {
        border-left: 1px solid #000;
    }
    #TXWX2SRXBJPNR .grt-vrule-0 {
        border-left: 0.0px solid #000;
    }
    #TXWX2SRXBJPNR .grt-vrule-1 {
        border-left: 0.0px solid #000;
    }
    #TXWX2SRXBJPNR .grt-vrule-2 {
        border-left: 0.0px solid #000;
    }
    #TXWX2SRXBJPNR .grt-left {
        text-align: left;
    }
    #TXWX2SRXBJPNR .grt-center {
        text-align: center;
    }
    #TXWX2SRXBJPNR .grt-right {
        text-align: right;
        font-variant-numeric: tabular-nums;
    }
    #TXWX2SRXBJPNR .grt-head {
        font-family: "Times New Roman", 'Courier New';
        font-size: 1.0em;
    }
    #TXWX2SRXBJPNR .grt-bold {
        font-weight: bold;
    }

</style>

<table id="TXWX2SRXBJPNR" class="do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="grt-left" data-quarto-table-cell-role="th">index</th>
<th class="grt-center grt-vrule-index" data-quarto-table-cell-role="th">N-AL</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">N-GL</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">N-Pr</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">E-AL</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">E-GL</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">E-Pr</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">S-AL</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">S-GL</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">S-Pr</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">W-AL</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">W-GL</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">W-Pr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="grt-c-0 grt-left">N-AL</td>
<td class="grt-c-1 grt-right grt-vrule-index">1</td>
<td class="grt-c-2 grt-right grt-vrule-0">0.567</td>
<td class="grt-c-3 grt-right grt-vrule-0">0.177</td>
<td class="grt-c-4 grt-right grt-vrule-0">0.376</td>
<td class="grt-c-5 grt-right grt-vrule-0">0.337</td>
<td class="grt-c-6 grt-right grt-vrule-0">0.355</td>
<td class="grt-c-7 grt-right grt-vrule-0">0.086</td>
<td class="grt-c-8 grt-right grt-vrule-0">0.101</td>
<td class="grt-c-9 grt-right grt-vrule-0">0.102</td>
<td class="grt-c-10 grt-right grt-vrule-0">0.033</td>
<td class="grt-c-11 grt-right grt-vrule-0">-0.012</td>
<td class="grt-c-12 grt-right grt-vrule-0">0.000</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left">N-GL</td>
<td class="grt-c-1 grt-right grt-vrule-index">0.567</td>
<td class="grt-c-2 grt-right grt-vrule-0">1</td>
<td class="grt-c-3 grt-right grt-vrule-0">0.323</td>
<td class="grt-c-4 grt-right grt-vrule-0">0.354</td>
<td class="grt-c-5 grt-right grt-vrule-0">0.385</td>
<td class="grt-c-6 grt-right grt-vrule-0">0.433</td>
<td class="grt-c-7 grt-right grt-vrule-0">0.122</td>
<td class="grt-c-8 grt-right grt-vrule-0">0.088</td>
<td class="grt-c-9 grt-right grt-vrule-0">0.157</td>
<td class="grt-c-10 grt-right grt-vrule-0">0.053</td>
<td class="grt-c-11 grt-right grt-vrule-0">0.020</td>
<td class="grt-c-12 grt-right grt-vrule-0">0.018</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left">N-Pr</td>
<td class="grt-c-1 grt-right grt-vrule-index">0.177</td>
<td class="grt-c-2 grt-right grt-vrule-0">0.323</td>
<td class="grt-c-3 grt-right grt-vrule-0">1</td>
<td class="grt-c-4 grt-right grt-vrule-0">0.277</td>
<td class="grt-c-5 grt-right grt-vrule-0">0.335</td>
<td class="grt-c-6 grt-right grt-vrule-0">0.490</td>
<td class="grt-c-7 grt-right grt-vrule-0">0.055</td>
<td class="grt-c-8 grt-right grt-vrule-0">0.022</td>
<td class="grt-c-9 grt-right grt-vrule-0">0.088</td>
<td class="grt-c-10 grt-right grt-vrule-0">-0.031</td>
<td class="grt-c-11 grt-right grt-vrule-0">-0.034</td>
<td class="grt-c-12 grt-right grt-vrule-0">-0.025</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left">E-AL</td>
<td class="grt-c-1 grt-right grt-vrule-index">0.376</td>
<td class="grt-c-2 grt-right grt-vrule-0">0.354</td>
<td class="grt-c-3 grt-right grt-vrule-0">0.277</td>
<td class="grt-c-4 grt-right grt-vrule-0">1</td>
<td class="grt-c-5 grt-right grt-vrule-0">0.535</td>
<td class="grt-c-6 grt-right grt-vrule-0">0.185</td>
<td class="grt-c-7 grt-right grt-vrule-0">0.170</td>
<td class="grt-c-8 grt-right grt-vrule-0">0.156</td>
<td class="grt-c-9 grt-right grt-vrule-0">0.204</td>
<td class="grt-c-10 grt-right grt-vrule-0">0.128</td>
<td class="grt-c-11 grt-right grt-vrule-0">0.081</td>
<td class="grt-c-12 grt-right grt-vrule-0">0.044</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left">E-GL</td>
<td class="grt-c-1 grt-right grt-vrule-index">0.337</td>
<td class="grt-c-2 grt-right grt-vrule-0">0.385</td>
<td class="grt-c-3 grt-right grt-vrule-0">0.335</td>
<td class="grt-c-4 grt-right grt-vrule-0">0.535</td>
<td class="grt-c-5 grt-right grt-vrule-0">1</td>
<td class="grt-c-6 grt-right grt-vrule-0">0.318</td>
<td class="grt-c-7 grt-right grt-vrule-0">0.168</td>
<td class="grt-c-8 grt-right grt-vrule-0">0.220</td>
<td class="grt-c-9 grt-right grt-vrule-0">0.242</td>
<td class="grt-c-10 grt-right grt-vrule-0">0.138</td>
<td class="grt-c-11 grt-right grt-vrule-0">0.095</td>
<td class="grt-c-12 grt-right grt-vrule-0">0.066</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left">E-Pr</td>
<td class="grt-c-1 grt-right grt-vrule-index">0.355</td>
<td class="grt-c-2 grt-right grt-vrule-0">0.433</td>
<td class="grt-c-3 grt-right grt-vrule-0">0.490</td>
<td class="grt-c-4 grt-right grt-vrule-0">0.185</td>
<td class="grt-c-5 grt-right grt-vrule-0">0.318</td>
<td class="grt-c-6 grt-right grt-vrule-0">1</td>
<td class="grt-c-7 grt-right grt-vrule-0">0.148</td>
<td class="grt-c-8 grt-right grt-vrule-0">0.218</td>
<td class="grt-c-9 grt-right grt-vrule-0">0.267</td>
<td class="grt-c-10 grt-right grt-vrule-0">0.116</td>
<td class="grt-c-11 grt-right grt-vrule-0">0.113</td>
<td class="grt-c-12 grt-right grt-vrule-0">0.158</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left">S-AL</td>
<td class="grt-c-1 grt-right grt-vrule-index">0.086</td>
<td class="grt-c-2 grt-right grt-vrule-0">0.122</td>
<td class="grt-c-3 grt-right grt-vrule-0">0.055</td>
<td class="grt-c-4 grt-right grt-vrule-0">0.170</td>
<td class="grt-c-5 grt-right grt-vrule-0">0.168</td>
<td class="grt-c-6 grt-right grt-vrule-0">0.148</td>
<td class="grt-c-7 grt-right grt-vrule-0">1</td>
<td class="grt-c-8 grt-right grt-vrule-0">0.566</td>
<td class="grt-c-9 grt-right grt-vrule-0">0.189</td>
<td class="grt-c-10 grt-right grt-vrule-0">0.384</td>
<td class="grt-c-11 grt-right grt-vrule-0">0.368</td>
<td class="grt-c-12 grt-right grt-vrule-0">0.348</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left">S-GL</td>
<td class="grt-c-1 grt-right grt-vrule-index">0.101</td>
<td class="grt-c-2 grt-right grt-vrule-0">0.088</td>
<td class="grt-c-3 grt-right grt-vrule-0">0.022</td>
<td class="grt-c-4 grt-right grt-vrule-0">0.156</td>
<td class="grt-c-5 grt-right grt-vrule-0">0.220</td>
<td class="grt-c-6 grt-right grt-vrule-0">0.218</td>
<td class="grt-c-7 grt-right grt-vrule-0">0.566</td>
<td class="grt-c-8 grt-right grt-vrule-0">1</td>
<td class="grt-c-9 grt-right grt-vrule-0">0.355</td>
<td class="grt-c-10 grt-right grt-vrule-0">0.450</td>
<td class="grt-c-11 grt-right grt-vrule-0">0.461</td>
<td class="grt-c-12 grt-right grt-vrule-0">0.388</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left">S-Pr</td>
<td class="grt-c-1 grt-right grt-vrule-index">0.102</td>
<td class="grt-c-2 grt-right grt-vrule-0">0.157</td>
<td class="grt-c-3 grt-right grt-vrule-0">0.088</td>
<td class="grt-c-4 grt-right grt-vrule-0">0.204</td>
<td class="grt-c-5 grt-right grt-vrule-0">0.242</td>
<td class="grt-c-6 grt-right grt-vrule-0">0.267</td>
<td class="grt-c-7 grt-right grt-vrule-0">0.189</td>
<td class="grt-c-8 grt-right grt-vrule-0">0.355</td>
<td class="grt-c-9 grt-right grt-vrule-0">1</td>
<td class="grt-c-10 grt-right grt-vrule-0">0.514</td>
<td class="grt-c-11 grt-right grt-vrule-0">0.569</td>
<td class="grt-c-12 grt-right grt-vrule-0">0.490</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left">W-AL</td>
<td class="grt-c-1 grt-right grt-vrule-index">0.033</td>
<td class="grt-c-2 grt-right grt-vrule-0">0.053</td>
<td class="grt-c-3 grt-right grt-vrule-0">-0.031</td>
<td class="grt-c-4 grt-right grt-vrule-0">0.128</td>
<td class="grt-c-5 grt-right grt-vrule-0">0.138</td>
<td class="grt-c-6 grt-right grt-vrule-0">0.116</td>
<td class="grt-c-7 grt-right grt-vrule-0">0.384</td>
<td class="grt-c-8 grt-right grt-vrule-0">0.450</td>
<td class="grt-c-9 grt-right grt-vrule-0">0.514</td>
<td class="grt-c-10 grt-right grt-vrule-0">1</td>
<td class="grt-c-11 grt-right grt-vrule-0">0.570</td>
<td class="grt-c-12 grt-right grt-vrule-0">0.183</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left">W-GL</td>
<td class="grt-c-1 grt-right grt-vrule-index">-0.012</td>
<td class="grt-c-2 grt-right grt-vrule-0">0.020</td>
<td class="grt-c-3 grt-right grt-vrule-0">-0.034</td>
<td class="grt-c-4 grt-right grt-vrule-0">0.081</td>
<td class="grt-c-5 grt-right grt-vrule-0">0.095</td>
<td class="grt-c-6 grt-right grt-vrule-0">0.113</td>
<td class="grt-c-7 grt-right grt-vrule-0">0.368</td>
<td class="grt-c-8 grt-right grt-vrule-0">0.461</td>
<td class="grt-c-9 grt-right grt-vrule-0">0.569</td>
<td class="grt-c-10 grt-right grt-vrule-0">0.570</td>
<td class="grt-c-11 grt-right grt-vrule-0">1</td>
<td class="grt-c-12 grt-right grt-vrule-0">0.331</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left">W-Pr</td>
<td class="grt-c-1 grt-right grt-vrule-index">0.000</td>
<td class="grt-c-2 grt-right grt-vrule-0">0.018</td>
<td class="grt-c-3 grt-right grt-vrule-0">-0.025</td>
<td class="grt-c-4 grt-right grt-vrule-0">0.044</td>
<td class="grt-c-5 grt-right grt-vrule-0">0.066</td>
<td class="grt-c-6 grt-right grt-vrule-0">0.158</td>
<td class="grt-c-7 grt-right grt-vrule-0">0.348</td>
<td class="grt-c-8 grt-right grt-vrule-0">0.388</td>
<td class="grt-c-9 grt-right grt-vrule-0">0.490</td>
<td class="grt-c-10 grt-right grt-vrule-0">0.183</td>
<td class="grt-c-11 grt-right grt-vrule-0">0.331</td>
<td class="grt-c-12 grt-right grt-vrule-0">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<div id="cell-fig-bic-intra-corr" class="cell" data-execution_count="17">
<div class="cell-output cell-output-display">
<div id="fig-bic-intra-corr" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-bic-intra-corr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="070_AdvancedTopics_files/figure-html/fig-bic-intra-corr-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Figure&nbsp;8.4: Image plot of achieved intra-region correlation. The block structure is clearly evident."><img src="070_AdvancedTopics_files/figure-html/fig-bic-intra-corr-output-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-bic-intra-corr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8.4: Image plot of achieved intra-region correlation. The block structure is clearly evident.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="theoretical-derivation-of-the-iman-conover-method" class="level3" data-number="8.2.8">
<h3 data-number="8.2.8" class="anchored" data-anchor-id="theoretical-derivation-of-the-iman-conover-method"><span class="header-section-number">8.2.8</span> Theoretical derivation of the Iman-Conover method</h3>
<p>Suppose that <span class="math inline">\(\mathsf{M}\)</span> is an <span class="math inline">\(n\)</span> element sample from an <span class="math inline">\(r\)</span> dimensional multivariate distribution, so <span class="math inline">\(\mathsf{M}\)</span> is an <span class="math inline">\(n\times r\)</span> matrix. Assume that the columns of <span class="math inline">\(\mathsf{M}\)</span> are uncorrelated, have mean zero, and have a standard deviation of one. Let <span class="math inline">\(\mathsf{M}'\)</span> denote the transpose of <span class="math inline">\(\mathsf{M}\)</span>. These assumptions imply that the correlation matrix of the sample <span class="math inline">\(\mathsf{M}\)</span> can be computed as <span class="math inline">\(n^{-1}\mathsf{M}'\mathsf{M}\)</span>, and because the columns are independent, <span class="math inline">\(n^{-1}\mathsf{M}'\mathsf{M}=\mathsf{id}\)</span>. (There is no need to scale the covariance matrix by the row and column standard deviations because they are all one. In general <span class="math inline">\(n^{-1}\mathsf{M}'\mathsf{M}\)</span> is the covariance matrix of <span class="math inline">\(\mathsf{M}\)</span>.)</p>
<p>Let <span class="math inline">\(\mathsf{S}\)</span> be a correlation matrix, i.e., <span class="math inline">\(\mathsf{S}\)</span> is a positive semidefinite symmetric matrix with ones on the diagonal and all elements <span class="math inline">\(\le 1\)</span> in absolute value. In order to rule out linearly dependent variables, assume <span class="math inline">\(\mathsf{S}\)</span> is positive definite. These assumptions ensure <span class="math inline">\(\mathsf{S}\)</span> has a Choleski decomposition <span class="math display">\[
\mathsf{S}=\mathsf{C}'\mathsf{C}
\]</span> for some upper triangular matrix <span class="math inline">\(\mathsf{C}\)</span>, see <span class="citation" data-cites="Golub2013bk">Golub and Van Loan (<a href="references.html#ref-Golub2013bk" role="doc-biblioref">2013</a>)</span> or <span class="citation" data-cites="Press1992a">Press et al. (<a href="references.html#ref-Press1992a" role="doc-biblioref">1992</a>)</span>. Set <span class="math inline">\(\mathsf{T}=\mathsf{M}\mathsf{C}\)</span>. The columns of <span class="math inline">\(\mathsf{T}\)</span> still have mean zero, because they are linear combinations of the columns of <span class="math inline">\(\mathsf{M}\)</span>, which have zero mean by assumption. It is less obvious, but still true, that the columns of <span class="math inline">\(\mathsf{T}\)</span> still have standard deviation one. To see why, remember that the covariance matrix of <span class="math inline">\(\mathsf{T}\)</span> is <span id="eq-coolA"><span class="math display">\[
n^{-1}\mathsf{T}'\mathsf{T}=n^{-1}\mathsf{C}'\mathsf{M}'\mathsf{M}\mathsf{C}=\mathsf{C}'\mathsf{C}=\mathsf{S},
\tag{8.2}\]</span></span> since <span class="math inline">\(n^{-1}\mathsf{M}'\mathsf{M}=\mathsf{id}\)</span> is the identity by assumption. Now <span class="math inline">\(\mathsf{S}\)</span> also is actually the correlation matrix because the diagonal is scaled to standard deviation one, so the covariance and correlation matrices coincide. The process of converting <span class="math inline">\(\mathsf{M}\)</span>, which is easy to simulate, into <span class="math inline">\(\mathsf{T}\)</span>, which has the desired correlation structure <span class="math inline">\(\mathsf{S}\)</span>, is the theoretical basis of the Iman-Conover method.</p>
<p>It is important to note that estimates of correlation matrices, depending on how they are constructed, need not have the mathematical properties of a correlation matrix. Therefore, when trying to use an estimate of a correlation matrix in an algorithm, such as the Iman-Conover, which actually requires a proper correlation matrix as input, it may be necessary to check the input matrix does have the correct mathematical properties.</p>
<p>Next, we discuss how to make <span class="math inline">\(n\times r\)</span> matrices <span class="math inline">\(\mathsf{M}\)</span>, with independent, mean zero columns. The basic idea is to take <span class="math inline">\(n\)</span> numbers <span class="math inline">\(a_1,\dots,a_n\)</span> with <span class="math inline">\(\sum_i a_i=0\)</span> and <span class="math inline">\(n^{-1}\sum_i a_i^2=1\)</span>, use them to form one <span class="math inline">\(n\times 1\)</span> column of <span class="math inline">\(\mathsf{M}\)</span>, and then to copy it <span class="math inline">\(r\)</span> times. Finally, randomly permute the entries in each column to make them independent as columns of random variables. Iman and Conover call these <span class="math inline">\(a_i\)</span> scores. They discuss several possible definitions for scores, including scaled versions of <span class="math inline">\(a_i=i\)</span> (ranks) and <span class="math inline">\(a_i\)</span> uniformly distributed. They note that the shape of the output multivariate distribution depends on the scores. All of the examples in their paper use normal scores.</p>
<p>Given that the scores will be based on normal random variables, we can either simulate <span class="math inline">\(n\)</span> random standard normal variables and then shift and rescale to ensure mean zero and standard deviation one, or we can use a systematic sample from the standard normal, <span class="math inline">\(a_i=\Phi^{-1}(i/(n+1))\)</span>. By construction, the systematic sample has mean zero, which is an advantage. Also, by symmetry, using the systematic sample halves the number of calls to <span class="math inline">\(\Phi^{-1}\)</span>. For these two reasons we prefer it in the algorithm below. <!-- https://quillbot.com/blog/frequently-asked-questions/whats-the-difference-between-stratified-and-systematic-sampling/ --></p>
<p>The correlation matrix of <span class="math inline">\(\mathsf{M}\)</span>, constructed by randomly permuting the scores in each column, will only be approximately equal to <span class="math inline">\(\mathsf{id}\)</span> because of random simulation error. In order to correct for the slight error which could be introduced, Iman and Conover use another adjustment in their algorithm. Let <span class="math inline">\(\mathsf{EE}=n^{-1}\mathsf{M}'\mathsf{M}\)</span> be the actual correlation matrix of <span class="math inline">\(\mathsf{M}\)</span>, and let <span class="math inline">\(\mathsf{EE}=\mathsf{F}'\mathsf{F}\)</span> be the Choleski decomposition of <span class="math inline">\(\mathsf{EE}\)</span>, and define <span class="math inline">\(\mathsf{T}=\mathsf{M}\mathsf{F}^{-1}\mathsf{C}\)</span>. The columns of <span class="math inline">\(\mathsf{T}\)</span> have mean zero, and the covariance matrix of <span class="math inline">\(\mathsf{T}\)</span> is <span class="math display">\[
\begin{aligned}
n^{-1}\mathsf{T}'\mathsf{T} &amp;= n^{-1}\mathsf{C}'\mathsf{F}'^{-1}\mathsf{M}'\mathsf{M}\mathsf{F}^{-1}\mathsf{C} \notag  \\
&amp;= \mathsf{C}'\mathsf{F}'^{-1}\mathsf{EE}\mathsf{F}^{-1}\mathsf{C} \notag   \\
&amp;= \mathsf{C}'\mathsf{F}'^{-1}\mathsf{F}'\mathsf{F}\mathsf{F}^{-1}\mathsf{C} \notag  \\
&amp;= \mathsf{C}' \mathsf{C} \notag  \\
&amp;= \mathsf{S}
\end{aligned}
\]</span> and hence <span class="math inline">\(\mathsf{T}\)</span> has correlation matrix exactly equal to <span class="math inline">\(\mathsf{S}\)</span>, as desired. If <span class="math inline">\(\mathsf{EE}\)</span> is singular, then the column shuffle needs to be repeated.</p>
<p>Now that the reference distribution <span class="math inline">\(\mathsf{T}\)</span> with exact correlation structure <span class="math inline">\(\mathsf{S}\)</span> is in hand, all that remains to complete the Iman-Conover method is to reorder each column of the input distribution <span class="math inline">\(\mathsf{X}\)</span> to have the same rank order as the corresponding column of <span class="math inline">\(\mathsf{T}\)</span>.</p>
</section>
</section>
<section id="sec-Allocating-Capital" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="sec-Allocating-Capital"><span class="header-section-number">8.3</span> Allocating capital, if you must</h2>
<p><em>Within each layer, we can allocate its expected losses and premiums to the various portfolio units. Having done so, capital allocation to units follows.</em></p>
<p><strong>Admonition.</strong> We can’t emphasize strongly enough that you <strong>should not allocate capital</strong>. Different layers of capital do not have the same cost (think: equity, junk debt, government bonds), therefore you do not know the appropriate target return on your allocated capital. Without that, you can’t say if a projected return is good or bad. Allocate margin, not capital!</p>
<p>Warnings about smoking don’t work either. We know your CFO, senior management, and investors discuss allocating underwriting capacity in the language of allocating capital, and we previously admonished you to speak the language of your customers. This section describes two methods you can use to translate allocated margins into allocated capital.</p>
<p>The first method is obvious: simply assume all capital earns the weighted average cost of capital and allocate capital by dividing allocated margin by the weighted average cost of capital. This will result in an additive allocation of capital. This has the advantage of being simple to implement, but the disadvantage is that it obscures—nay, denies!—the fact that different segments of capital earn different returns.</p>
<p>The second method has a more theoretically sound basis. It applies the principles discussed in <a href="040_PricingAndAllocation.html" class="quarto-xref"><span>Chapter 4</span></a> to obtain an allocation of capital <span class="math inline">\(Q\)</span> and unit-specific rates of return <span class="math inline">\(\iota^i\)</span> consistent with the SRM approach.</p>
<p>Layer <span class="math inline">\(k\)</span> is <span class="math inline">\(\Delta X_k\)</span> dollars wide but is triggered by any portfolio loss <span class="math inline">\(X &gt; X_k\)</span>. We propose that the expectation of that loss be allocated to units by equal priority, that is, in proportion to the expected losses of the units <em>in those triggering events</em>. We may define the layer-<span class="math inline">\(k\)</span> <strong>expected loss share</strong> to unit <span class="math inline">\(i\)</span> as <span class="math display">\[
\alpha_k^i := \mathsf E_p\left[\frac{X^i}{X}\mid X &gt; X_k\right].
\]</span> In particular, this means <span id="eq-alpha-k-i"><span class="math display">\[
\alpha_k^i S_k = \mathsf E_p\left[\frac{X^i}{X}1_{\mid X &gt; X_k}\right] = \sum_{j&gt;k}\frac{X_j^i}{X_j}p_j.
\tag{8.3}\]</span></span> The <span class="math inline">\(\alpha^i\)</span> sum to one across the units because (conditional) expectations are linear. The expected loss to layer <span class="math inline">\(k\)</span>, <span class="math inline">\(S_k\Delta X_k\)</span>, can thus be partitioned into <span class="math inline">\(\alpha_k^i S_k\Delta X_k\)</span> across the various units. The total portfolio loss, <span class="math inline">\(\mathsf E[X]\)</span>, is allocated to unit <span class="math inline">\(i\)</span> as <span id="eq-alpha-k-ii"><span class="math display">\[
\mathsf E[X^i] = \sum_j \alpha_j^i S_j\Delta X_j.
\tag{8.4}\]</span></span></p>
<p><strong>Exercise.</strong> Prove <a href="#eq-alpha-k-ii" class="quarto-xref">Equation&nbsp;<span>8.4</span></a>, given <a href="#eq-alpha-k-i" class="quarto-xref">Equation&nbsp;<span>8.3</span></a>.</p>
<p><strong>Solution.</strong> <span class="math display">\[
\begin{aligned}
\sum_j \alpha_j^i S_j\Delta X_j &amp;= \sum_{k=0}^{n-1} \left(\sum_{j=k+1}^{n}\frac{X_j^i}{X_j} p_j  \right)(X_{k+1}-X_k) \\
&amp;=\sum_{j=1}^n \frac{X_j^i}{X_j} p_j\sum_{k=0}^{j-1} (X_{k+1}-X_{k}) \\
&amp;=\sum_{j=1}^n \frac{X_j^i}{X_j} p_j X_j \\
&amp;=\sum_{j=1}^n X_j^i p_j \\
&amp;= \mathsf E[X^i]
\end{aligned}
\]</span> noting <span class="math inline">\(X_0=X_0^i=0\)</span>. </p>
<p>What about premium? We propose that the premium associated with layer <span class="math inline">\(k\)</span> be allocated to units in proportion to the <em>distorted</em> expected losses of the units in those triggering events. This leads to the definition of the <strong>distorted expected loss share</strong> <span class="math display">\[
\beta_k^i := \mathsf E_q\left[\frac{X^i}{X}\mid X &gt; X_k\right]
\]</span> In particular, this means <span class="math display">\[
\beta_k^i g(S_k) = \sum_{j&gt;k}\frac{X_j^i}{X_j}q_j = \sum_{j&gt;k}\frac{X_j^i Z_j}{X_j}p_j.
\]</span> where, recall, <span class="math inline">\(Z_j=q_j/p_j\)</span> is the event weight.</p>
<p>The premium to layer <span class="math inline">\(k\)</span>, given by <span class="math inline">\(P_k = g(S_k)\Delta X_k\)</span>, is partitioned to the units as <span class="math inline">\(\beta_k^i g(S_k)\Delta X_k\)</span>. The total premium is therefore allocated to the units as <span class="math display">\[
\mathsf E[X^i Z(X)] = \sum_j \beta_j^i g(S_j)\Delta X_j
\]</span> being the total premium to unit <span class="math inline">\(i\)</span>.</p>
<p><strong>Exercise.</strong> Prove the previous equality.</p>
<p><strong>Solution.</strong> The same steps as the preceding exercise. </p>
<p>Since margin is the difference between premium and expected loss (<a href="040_PricingAndAllocation.html#eq-PLM" class="quarto-xref">Equation&nbsp;<span>4.1</span></a>), we immediately have the allocation of unit <span class="math inline">\(i\)</span>’s margin <span id="eq-M-i2"><span class="math display">\[
M^i = \sum_j (\beta_j^i g(S_j) - \alpha_j^i S_j)\Delta X_j.
\tag{8.5}\]</span></span></p>
<p><strong>Exercise.</strong> Use <a href="040_PricingAndAllocation.html#eq-M-i" class="quarto-xref">Equation&nbsp;<span>4.10</span></a> with <a href="040_PricingAndAllocation.html#eq-P-i" class="quarto-xref">Equation&nbsp;<span>4.8</span></a> and <a href="040_PricingAndAllocation.html#eq-L-i" class="quarto-xref">Equation&nbsp;<span>4.9</span></a> to derive a simple equation for <span class="math inline">\(M^i\)</span> and then prove it is the equivalent of <a href="#eq-M-i2" class="quarto-xref">Equation&nbsp;<span>8.5</span></a>. </p>
<p>Recall that the layer <span class="math inline">\(k\)</span> cost of capital is <span class="math display">\[
\iota_k := \frac{M_k}{Q_k} = \frac{P_k - S_k\Delta X_k}{\Delta X_k-P_k} = \frac{g(S_k) - S_k}{1- g(S_k)}.
\]</span> Here, we lean on the assumption of law invariance (see <a href="040_PricingAndAllocation.html#sec-Pricing-layers" class="quarto-xref"><span>Section 4.4</span></a>). We claim that for a law invariant pricing approach, the layer cost of capital must be the <em>same for all units</em>. Law invariance implies the risk measure is only concerned with the attachment probability of the layer and not with the cause of loss within the layer. If <span class="math inline">\(\iota\)</span> <em>within a layer</em> varied by unit, then the allocation could not be law invariant. This crucial observation underlies the following logic.</p>
<p>Because cost of capital equals margin over capital, and seeing as both margin and cost of capital are known by layer and by unit, with the latter constant across units, we can compute unit capital by layer <span class="math inline">\(Q_k^i\)</span> via</p>
<p><span class="math display">\[\begin{equation}
\iota_k: = \frac{M_k}{Q_k} = \frac{M_k^i}{Q_k^i}\implies Q_k^i = \frac{M_k^i}{\iota_k}.
\end{equation}\]</span> Substituting the details gives the following definition for the <strong>NA of capital</strong> in layer <span class="math inline">\(k\)</span> to unit <span class="math inline">\(i\)</span>: <span id="eq-Q-ki"><span class="math display">\[
Q_k^i = \frac{\beta_k^i g(S_k) -  \alpha_k^i S_k}{g(S_k)- S_k} (1-g(S_k))\Delta X_k.
\tag{8.6}\]</span></span></p>
<p>In words, taking <a href="#eq-Q-ki" class="quarto-xref">Equation&nbsp;<span>8.6</span></a> and dividing numerator and denominator by capital in the layer shows <span class="math display">\[
Q_k^i = \frac{\text{Margin for unit in layer}}{\text{Total margin in layer}}\times \text{Capital in layer} = \frac{\text{Margin for unit in layer}}{\text{Layer cost of capital}}.
\]</span> The NA is the same as method 1 (divide by weighted average cost of capital) but <strong>applied separately for each layer</strong> of capital!</p>
<p><strong>Exercise.</strong> Derive <a href="#eq-Q-ki" class="quarto-xref">Equation&nbsp;<span>8.6</span></a>. </p>
<p>Since <span class="math inline">\(1-g(S_k)\)</span> is the proportion of of layer <span class="math inline">\(k\)</span>’s limit devoted to capital, this says the proportion of capital allocated to unit <span class="math inline">\(i\)</span> is given by the nicely symmetric expression <span id="eq-q-formula"><span class="math display">\[
\frac{\beta_k^i g(S_k) -  \alpha_k^i S_k}{g(S_k)- S_k}
\tag{8.7}\]</span></span> To determine total capital by unit, we sum across layers <span class="math display">\[
Q^i := \sum_j Q_j^i.
\]</span> Finally, we can determine the average cost of capital for unit <span class="math inline">\(i\)</span> <span class="math display">\[\begin{equation}
\iota^i = \frac{M^i}{Q^i}.
\end{equation}\]</span></p>
<p>This is illustrated for our example in <a href="#tbl-alpha" class="quarto-xref">Table&nbsp;<span>8.8</span></a>, <a href="#tbl-beta" class="quarto-xref">Table&nbsp;<span>8.9</span></a>, and <a href="#tbl-q-alloc" class="quarto-xref">Table&nbsp;<span>8.10</span></a>. In the last table, the columns are calculated as <span class="math inline">\(M^i=\beta^i g(S)-\alpha^i S\)</span>, <span class="math inline">\(\iota=(g-S)/(1-g)\)</span>, <span class="math inline">\(Q^i=M^i/\iota\)</span>, and the low row <span class="math inline">\(M\)</span> (respectively, <span class="math inline">\(Q\)</span>) show sum products with <span class="math inline">\(\Delta X\)</span>. <!--# Note message in PDF about table size not allowing "pleasant formatting." --></p>
<div class="cell" data-execution_count="18">
<div id="tbl-alpha" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="18">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-alpha-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;8.8: Calculation of loss shares by layer. The row <span class="math inline">\(L\)</span> shows sum products with <span class="math inline">\(\Delta X\)</span>.
</figcaption>
<div aria-describedby="tbl-alpha-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="17">
<div class="greater-table">
<style>
    #TE5A2UXPJKM4W  {
    border-collapse: collapse;
    font-family: "Roboto", "Open Sans Condensed", "Arial", 'Segoe UI', sans-serif;
    font-size: 1.0em;
    width: auto;
    
    margin: 10px auto;
    border: none;
    overflow: auto;
    margin-left: auto;
    margin-right: auto;
    }
    
    
    
    #TE5A2UXPJKM4W caption {
        padding: 4px 10px 2px 10px;
        font-size: 1.1em;
        text-align: center;
        font-weight: normal;
        caption-side: top;
    }
    #TE5A2UXPJKM4W thead {
        
        border-top: 1px solid #000;
        border-bottom: 1px solid #000;
        font-size: 1.0em;
        }
    #TE5A2UXPJKM4W tbody {
        
        border-bottom: 1px solid #000;
        }
    #TE5A2UXPJKM4W th  {
        vertical-align: bottom;
        padding: 4px 10px 4px 10px;
    }
    #TE5A2UXPJKM4W td {
        
        padding: 2px 10px 2px 10px;
        vertical-align: top;
    }
    
    #TE5A2UXPJKM4W .grt-hrule-0 {
        border-top: 0.0px solid #000;
    }
    #TE5A2UXPJKM4W .grt-hrule-1 {
        border-top: 0.0px solid #000;
    }
    #TE5A2UXPJKM4W .grt-hrule-2 {
        border-top: 0.0px solid #000;
    }
    
    #TE5A2UXPJKM4W .grt-bhrule-0 {
        border-bottom: 0.0px solid #000;
    }
    #TE5A2UXPJKM4W .grt-bhrule-1 {
        border-bottom: 0.0px solid #000;
    }
    #TE5A2UXPJKM4W .grt-vrule-index {
        border-left: 1px solid #000;
    }
    #TE5A2UXPJKM4W .grt-vrule-0 {
        border-left: 0.0px solid #000;
    }
    #TE5A2UXPJKM4W .grt-vrule-1 {
        border-left: 0.0px solid #000;
    }
    #TE5A2UXPJKM4W .grt-vrule-2 {
        border-left: 0.0px solid #000;
    }
    #TE5A2UXPJKM4W .grt-left {
        text-align: left;
    }
    #TE5A2UXPJKM4W .grt-center {
        text-align: center;
    }
    #TE5A2UXPJKM4W .grt-right {
        text-align: right;
        font-variant-numeric: tabular-nums;
    }
    #TE5A2UXPJKM4W .grt-head {
        font-family: "Times New Roman", 'Courier New';
        font-size: 1.0em;
    }
    #TE5A2UXPJKM4W .grt-bold {
        font-weight: bold;
    }

</style>

<table id="TE5A2UXPJKM4W" class="do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="grt-left" data-quarto-table-cell-role="th">\(k\)</th>
<th class="grt-center grt-vrule-index" data-quarto-table-cell-role="th">Unit A \(X^1\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">Unit B \(X^2\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">Unit C \(X^3\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">Total \(X\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(p\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(S\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(\Delta X\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(\alpha^1 S\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(\alpha^2 S\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(\alpha^3 S\)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="grt-c-0 grt-left">0</td>
<td class="grt-c-1 grt-right grt-vrule-index">0</td>
<td class="grt-c-2 grt-right grt-vrule-0">0</td>
<td class="grt-c-3 grt-right grt-vrule-0">0</td>
<td class="grt-c-4 grt-right grt-vrule-0">0</td>
<td class="grt-c-5 grt-right grt-vrule-0">0</td>
<td class="grt-c-6 grt-right grt-vrule-0">1</td>
<td class="grt-c-7 grt-right grt-vrule-0">22</td>
<td class="grt-c-8 grt-right grt-vrule-0">0.325</td>
<td class="grt-c-9 grt-right grt-vrule-0">0.441</td>
<td class="grt-c-10 grt-right grt-vrule-0">0.234</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left grt-hrule-0">1</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">15</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">7</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">0</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">22</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">0.1</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">0.9</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">6</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">0.257</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0">0.409</td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0">0.234</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left grt-hrule-0">2</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">15</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">13</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">0</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">28</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">0.1</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">0.8</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">8</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">0.203</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0">0.362</td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0">0.234</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left grt-hrule-0">3</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">5</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">20</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">11</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">36</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">0.1</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">0.7</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">4</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">0.189</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0">0.307</td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0">0.204</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left grt-hrule-0">4</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">10</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">24</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">6</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">40</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">0.4</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">0.3</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">15</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">0.089</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0">0.067</td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0">0.144</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left grt-hrule-0">5</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">26</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">19</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">10</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">55</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">0.1</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">0.2</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">10</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">0.042</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0">0.032</td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0">0.126</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left grt-hrule-0">6</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">17</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">8</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">40</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">65</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">0.1</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">0.1</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">35</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">0.016</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0">0.020</td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0">0.064</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left grt-hrule-0">7</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">16</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">20</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">64</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">100</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">0.1</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">0</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">0</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">0</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0">0</td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0">0</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left grt-hrule-0">\(L=\mathsf E_p\)</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">13.4</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">18.3</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">14.9</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">46.6</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">13.4</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0">18.3</td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0">14.9</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<div class="cell" data-execution_count="19">
<div id="tbl-beta" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="19">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-beta-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;8.9: Calculation of premium shares by layer. The row <span class="math inline">\(P\)</span> shows sum products with <span class="math inline">\(\Delta X\)</span>.
</figcaption>
<div aria-describedby="tbl-beta-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="18">
<div class="greater-table">
<style>
    #TQLNF4XQEXVE6  {
    border-collapse: collapse;
    font-family: "Roboto", "Open Sans Condensed", "Arial", 'Segoe UI', sans-serif;
    font-size: 1.0em;
    width: auto;
    
    margin: 10px auto;
    border: none;
    overflow: auto;
    margin-left: auto;
    margin-right: auto;
    }
    
    
    
    #TQLNF4XQEXVE6 caption {
        padding: 4px 10px 2px 10px;
        font-size: 1.1em;
        text-align: center;
        font-weight: normal;
        caption-side: top;
    }
    #TQLNF4XQEXVE6 thead {
        
        border-top: 1px solid #000;
        border-bottom: 1px solid #000;
        font-size: 1.0em;
        }
    #TQLNF4XQEXVE6 tbody {
        
        border-bottom: 1px solid #000;
        }
    #TQLNF4XQEXVE6 th  {
        vertical-align: bottom;
        padding: 4px 10px 4px 10px;
    }
    #TQLNF4XQEXVE6 td {
        
        padding: 2px 10px 2px 10px;
        vertical-align: top;
    }
    
    #TQLNF4XQEXVE6 .grt-hrule-0 {
        border-top: 0.0px solid #000;
    }
    #TQLNF4XQEXVE6 .grt-hrule-1 {
        border-top: 0.0px solid #000;
    }
    #TQLNF4XQEXVE6 .grt-hrule-2 {
        border-top: 0.0px solid #000;
    }
    
    #TQLNF4XQEXVE6 .grt-bhrule-0 {
        border-bottom: 0.0px solid #000;
    }
    #TQLNF4XQEXVE6 .grt-bhrule-1 {
        border-bottom: 0.0px solid #000;
    }
    #TQLNF4XQEXVE6 .grt-vrule-index {
        border-left: 1px solid #000;
    }
    #TQLNF4XQEXVE6 .grt-vrule-0 {
        border-left: 0.0px solid #000;
    }
    #TQLNF4XQEXVE6 .grt-vrule-1 {
        border-left: 0.0px solid #000;
    }
    #TQLNF4XQEXVE6 .grt-vrule-2 {
        border-left: 0.0px solid #000;
    }
    #TQLNF4XQEXVE6 .grt-left {
        text-align: left;
    }
    #TQLNF4XQEXVE6 .grt-center {
        text-align: center;
    }
    #TQLNF4XQEXVE6 .grt-right {
        text-align: right;
        font-variant-numeric: tabular-nums;
    }
    #TQLNF4XQEXVE6 .grt-head {
        font-family: "Times New Roman", 'Courier New';
        font-size: 1.0em;
    }
    #TQLNF4XQEXVE6 .grt-bold {
        font-weight: bold;
    }

</style>

<table id="TQLNF4XQEXVE6" class="do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="grt-left" data-quarto-table-cell-role="th">\(k\)</th>
<th class="grt-center grt-vrule-index" data-quarto-table-cell-role="th">Unit A \(X^1\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">Unit B \(X^2\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">Unit C \(X^3\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">Total \(X\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(q\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(gS\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(\Delta X\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(\beta^1 S\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(\beta^2 S\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(\beta^3 S\)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="grt-c-0 grt-left">0</td>
<td class="grt-c-1 grt-right grt-vrule-index">0</td>
<td class="grt-c-2 grt-right grt-vrule-0">0</td>
<td class="grt-c-3 grt-right grt-vrule-0">0</td>
<td class="grt-c-4 grt-right grt-vrule-0">0</td>
<td class="grt-c-5 grt-right grt-vrule-0">0</td>
<td class="grt-c-6 grt-right grt-vrule-0">1</td>
<td class="grt-c-7 grt-right grt-vrule-0">22</td>
<td class="grt-c-8 grt-right grt-vrule-0">0.295</td>
<td class="grt-c-9 grt-right grt-vrule-0">0.409</td>
<td class="grt-c-10 grt-right grt-vrule-0">0.296</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left grt-hrule-0">1</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">15</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">7</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">0</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">22</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">0.052</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">0.948</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">6</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">0.260</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0">0.392</td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0">0.296</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left grt-hrule-0">2</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">15</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">13</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">0</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">28</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">0.066</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">0.882</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">8</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">0.225</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0">0.362</td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0">0.296</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left grt-hrule-0">3</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">5</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">20</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">11</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">36</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">0.075</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">0.807</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">4</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">0.214</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0">0.320</td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0">0.273</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left grt-hrule-0">4</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">10</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">24</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">6</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">40</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">0.379</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">0.428</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">15</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">0.119</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0">0.093</td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0">0.216</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left grt-hrule-0">5</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">26</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">19</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">10</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">55</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">0.119</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">0.309</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">10</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">0.063</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0">0.051</td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0">0.194</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left grt-hrule-0">6</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">17</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">8</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">40</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">65</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">0.135</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">0.174</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">35</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">0.028</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0">0.035</td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0">0.111</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left grt-hrule-0">7</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">16</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">20</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">64</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">100</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">0.174</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">0</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">0</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">0</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0">0</td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0">0</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left grt-hrule-0">\(L=\mathsf E_p\)</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">13.4</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">18.3</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">14.9</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">46.6</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0"></td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left grt-hrule-0">\(P=\mathsf E_p\)</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">14.109</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">18.637</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">20.819</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">53.565</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">14.109</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0">18.637</td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0">20.819</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left grt-hrule-0">\(M=P-L\)</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">0.709</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">0.337</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">5.919</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">6.965</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<div class="cell" data-execution_count="20">
<div id="tbl-q-alloc" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="20">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-q-alloc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;8.10: Allocation of capital.
</figcaption>
<div aria-describedby="tbl-q-alloc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="19">
<div class="greater-table">
<style>
    #TD75TE3CTSG6O  {
    border-collapse: collapse;
    font-family: "Roboto", "Open Sans Condensed", "Arial", 'Segoe UI', sans-serif;
    font-size: 1.0em;
    width: auto;
    
    margin: 10px auto;
    border: none;
    overflow: auto;
    margin-left: auto;
    margin-right: auto;
    }
    
    
    
    #TD75TE3CTSG6O caption {
        padding: 4px 10px 2px 10px;
        font-size: 1.1em;
        text-align: center;
        font-weight: normal;
        caption-side: top;
    }
    #TD75TE3CTSG6O thead {
        
        border-top: 1px solid #000;
        border-bottom: 1px solid #000;
        font-size: 1.0em;
        }
    #TD75TE3CTSG6O tbody {
        
        border-bottom: 1px solid #000;
        }
    #TD75TE3CTSG6O th  {
        vertical-align: bottom;
        padding: 4px 10px 4px 10px;
    }
    #TD75TE3CTSG6O td {
        
        padding: 2px 10px 2px 10px;
        vertical-align: top;
    }
    
    #TD75TE3CTSG6O .grt-hrule-0 {
        border-top: 0.0px solid #000;
    }
    #TD75TE3CTSG6O .grt-hrule-1 {
        border-top: 0.0px solid #000;
    }
    #TD75TE3CTSG6O .grt-hrule-2 {
        border-top: 0.0px solid #000;
    }
    
    #TD75TE3CTSG6O .grt-bhrule-0 {
        border-bottom: 0.0px solid #000;
    }
    #TD75TE3CTSG6O .grt-bhrule-1 {
        border-bottom: 0.0px solid #000;
    }
    #TD75TE3CTSG6O .grt-vrule-index {
        border-left: 1px solid #000;
    }
    #TD75TE3CTSG6O .grt-vrule-0 {
        border-left: 0.0px solid #000;
    }
    #TD75TE3CTSG6O .grt-vrule-1 {
        border-left: 0.0px solid #000;
    }
    #TD75TE3CTSG6O .grt-vrule-2 {
        border-left: 0.0px solid #000;
    }
    #TD75TE3CTSG6O .grt-left {
        text-align: left;
    }
    #TD75TE3CTSG6O .grt-center {
        text-align: center;
    }
    #TD75TE3CTSG6O .grt-right {
        text-align: right;
        font-variant-numeric: tabular-nums;
    }
    #TD75TE3CTSG6O .grt-head {
        font-family: "Times New Roman", 'Courier New';
        font-size: 1.0em;
    }
    #TD75TE3CTSG6O .grt-bold {
        font-weight: bold;
    }

</style>

<table id="TD75TE3CTSG6O" class="do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="grt-left" data-quarto-table-cell-role="th">\(k\)</th>
<th class="grt-center grt-vrule-index" data-quarto-table-cell-role="th">Total \(X\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(\Delta X\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(M^1\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(M^2\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(M^3\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(Q^1\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(Q^2\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(Q^3\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(\iota\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(\delta\)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="grt-c-0 grt-left">0</td>
<td class="grt-c-1 grt-right grt-vrule-index">0</td>
<td class="grt-c-2 grt-right grt-vrule-0">22</td>
<td class="grt-c-3 grt-right grt-vrule-0">-0.030</td>
<td class="grt-c-4 grt-right grt-vrule-0">-0.032</td>
<td class="grt-c-5 grt-right grt-vrule-0">0.061</td>
<td class="grt-c-6 grt-right grt-vrule-0">0</td>
<td class="grt-c-7 grt-right grt-vrule-0">0</td>
<td class="grt-c-8 grt-right grt-vrule-0">0</td>
<td class="grt-c-9 grt-right grt-vrule-0">inf</td>
<td class="grt-c-10 grt-right grt-vrule-0">1</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left grt-hrule-0">1</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">22</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">6</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">0.003</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">-0.017</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">0.061</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">0.003</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">-0.018</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">0.067</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0">0.917</td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0">0.478</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left grt-hrule-0">2</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">28</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">8</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">0.021</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">-0.001</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">0.061</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">0.031</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">-0.001</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">0.089</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0">0.693</td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0">0.409</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left grt-hrule-0">3</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">36</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">4</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">0.025</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">0.013</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">0.069</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">0.045</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">0.024</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">0.125</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0">0.555</td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0">0.357</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left grt-hrule-0">4</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">40</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">15</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">0.030</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">0.026</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">0.072</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">0.134</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">0.115</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">0.323</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0">0.224</td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0">0.183</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left grt-hrule-0">5</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">55</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">10</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">0.021</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">0.019</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">0.069</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">0.133</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">0.121</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">0.437</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0">0.158</td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0">0.136</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left grt-hrule-0">6</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">65</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">35</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">0.012</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">0.015</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">0.047</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">0.132</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">0.165</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">0.529</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0">0.089</td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0">0.082</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left grt-hrule-0">7</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">100</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">0</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">0</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">0</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">0</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">0</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">0</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">0</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0"></td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left grt-hrule-0">\(\mathsf E_q\)</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index"></td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">0.709</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">0.337</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">5.919</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">8.411</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">8.691</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">29.333</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0"></td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left grt-hrule-0">\(\iota\)</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index"></td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">0.084</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">0.039</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">0.202</td>
<td class="grt-c-9 grt-right grt-hrule-0 grt-vrule-0">0.150</td>
<td class="grt-c-10 grt-right grt-hrule-0 grt-vrule-0"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>Observe that <span class="math inline">\((\sum_i \iota^i Q^i)/Q\)</span> is 15%, the weighted cost of capital over all units is 15%, as assumed.</p>
<p>Notice that the first layer <span class="math inline">\(k=0\)</span> has undefined cost of capital <span class="math inline">\(\iota\)</span>; since <span class="math inline">\(S_0=1\)</span>, we have <span class="math inline">\(g(S_0)=1\)</span>, <span class="math inline">\(P_0=\Delta X_0\)</span>, and <span class="math inline">\(M_0=Q_0=0\)</span>. Nonetheless, we have nonzero unit margins <span class="math inline">\(M_0^i\)</span> summing to zero.</p>
<p>The smallest portfolio loss equals 22, meaning the first layer is entirely funded by loss payments and requires no capital in aggregate. However, there are cross-subsidies between the units within the layer. Were the three units to purchase insurance from an insurance company with only $22 of assets, it would benefit the most volatile line, because it would capture an outsized proportion of the available assets in the case it had a large loss. The margins reflect these cross-subsidies. However because the layer is fully funded by losses, there is no capital and hence no aggregate margin, which is why the allocated margins sum to zero.</p>
<p>Although the cost of capital <em>within</em> each layer is the same for all units, the margin, the proportion of limit that is capital, and the proportion of that capital attributable to each unit, all vary across layers. Therefore, <em>average cost of capital generally varies by unit</em>. <a href="#tbl-wang-isa-alloc" class="quarto-xref">Table&nbsp;<span>8.11</span></a> shows the difference in results between the natural Wang allocation and the CCoC approaches done previously. (The natural CCoC is equivalent to the industry standard approach.) The story is complex. While both noncatastrophe lines receive more margin and more capital under the Wang allocation, it is not proportional; their rates of return are not only lower than the 15% benchmark, but they are markedly different.</p>
<div class="cell" data-execution_count="21">
<div id="tbl-wang-isa-alloc" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="21">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-wang-isa-alloc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;8.11: Comparison of Wang SRM and CCoC natural capital allocations.
</figcaption>
<div aria-describedby="tbl-wang-isa-alloc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="20">
<div class="greater-table">
<style>
    #TY6KB23ZP3FOI  {
    border-collapse: collapse;
    font-family: "Roboto", "Open Sans Condensed", "Arial", 'Segoe UI', sans-serif;
    font-size: 1.0em;
    width: auto;
    
    margin: 10px auto;
    border: none;
    overflow: auto;
    margin-left: auto;
    margin-right: auto;
    }
    
    
    
    #TY6KB23ZP3FOI caption {
        padding: 4px 10px 2px 10px;
        font-size: 1.1em;
        text-align: center;
        font-weight: normal;
        caption-side: top;
    }
    #TY6KB23ZP3FOI thead {
        
        border-top: 1px solid #000;
        border-bottom: 1px solid #000;
        font-size: 1.0em;
        }
    #TY6KB23ZP3FOI tbody {
        
        border-bottom: 1px solid #000;
        }
    #TY6KB23ZP3FOI th  {
        vertical-align: bottom;
        padding: 4px 10px 4px 10px;
    }
    #TY6KB23ZP3FOI td {
        
        padding: 2px 10px 2px 10px;
        vertical-align: top;
    }
    
    #TY6KB23ZP3FOI .grt-hrule-0 {
        border-top: 0.0px solid #000;
    }
    #TY6KB23ZP3FOI .grt-hrule-1 {
        border-top: 0.0px solid #000;
    }
    #TY6KB23ZP3FOI .grt-hrule-2 {
        border-top: 0.0px solid #000;
    }
    
    #TY6KB23ZP3FOI .grt-bhrule-0 {
        border-bottom: 0.0px solid #000;
    }
    #TY6KB23ZP3FOI .grt-bhrule-1 {
        border-bottom: 0.0px solid #000;
    }
    #TY6KB23ZP3FOI .grt-vrule-index {
        border-left: 1px solid #000;
    }
    #TY6KB23ZP3FOI .grt-vrule-0 {
        border-left: 0.0px solid #000;
    }
    #TY6KB23ZP3FOI .grt-vrule-1 {
        border-left: 0.0px solid #000;
    }
    #TY6KB23ZP3FOI .grt-vrule-2 {
        border-left: 0.0px solid #000;
    }
    #TY6KB23ZP3FOI .grt-left {
        text-align: left;
    }
    #TY6KB23ZP3FOI .grt-center {
        text-align: center;
    }
    #TY6KB23ZP3FOI .grt-right {
        text-align: right;
        font-variant-numeric: tabular-nums;
    }
    #TY6KB23ZP3FOI .grt-head {
        font-family: "Times New Roman", 'Courier New';
        font-size: 1.0em;
    }
    #TY6KB23ZP3FOI .grt-bold {
        font-weight: bold;
    }

</style>

<table id="TY6KB23ZP3FOI" class="do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="grt-left" data-quarto-table-cell-role="th">Distortion</th>
<th class="grt-left" data-quarto-table-cell-role="th">Metric</th>
<th class="grt-center grt-vrule-index" data-quarto-table-cell-role="th">Unit A</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">Unit B</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">Unit C</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">Portfolio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="grt-c-0 grt-left">Wang, 0.343</td>
<td class="grt-c-1 grt-left">Capital \(Q\)</td>
<td class="grt-c-2 grt-right grt-vrule-index">8.411</td>
<td class="grt-c-3 grt-right grt-vrule-0">8.691</td>
<td class="grt-c-4 grt-right grt-vrule-0">29.333</td>
<td class="grt-c-5 grt-right grt-vrule-0">46.435</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left grt-hrule-0"></td>
<td class="grt-c-1 grt-left grt-hrule-0">Margin \(M\)</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-index">0.709</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">0.337</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">5.919</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">6.965</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left"></td>
<td class="grt-c-1 grt-left grt-hrule-1">Return \(\iota\)</td>
<td class="grt-c-2 grt-right grt-hrule-1 grt-vrule-index">8.4%</td>
<td class="grt-c-3 grt-right grt-hrule-1 grt-vrule-0">3.9%</td>
<td class="grt-c-4 grt-right grt-hrule-1 grt-vrule-0">20.2%</td>
<td class="grt-c-5 grt-right grt-hrule-1 grt-vrule-0">15.0%</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left grt-hrule-0">CCoC, 0.150</td>
<td class="grt-c-1 grt-left grt-hrule-0">Capital \(Q\)</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-index">4.874</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">5.288</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">36.273</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">46.435</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left grt-hrule-0"></td>
<td class="grt-c-1 grt-left grt-hrule-0">Margin \(M\)</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-index">0.339</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">0.222</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">6.404</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">6.965</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left"></td>
<td class="grt-c-1 grt-left grt-hrule-1">Return \(\iota\)</td>
<td class="grt-c-2 grt-right grt-hrule-1 grt-vrule-index">7.0%</td>
<td class="grt-c-3 grt-right grt-hrule-1 grt-vrule-0">4.2%</td>
<td class="grt-c-4 grt-right grt-hrule-1 grt-vrule-0">17.7%</td>
<td class="grt-c-5 grt-right grt-hrule-1 grt-vrule-0">15.0%</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>For a typical distortion other than CCoC, in line with <a href="010_Introduction.html#tbl-margin-return" class="quarto-xref">Table&nbsp;<span>1.1</span></a>, we find:</p>
<ul>
<li>Lower layers of assets, below the expected losses, have a high cost of capital but, offsetting this, they are mostly funded by premium and require little supporting investor capital, resulting in high leverage.</li>
<li>Higher layers of assets have a lower cost of capital but higher capital content: they are funded by capital to a greater degree.</li>
<li>Low volatility units by definition tend to have losses close to their expected value, regardless of the value of total losses, and so consume relatively more of the expensive, lower layer capital and a smaller proportion of cheaper, higher asset layers. Offsetting this, there is more capital in higher layers than lower ones.</li>
<li>High volatility units tend to have a larger proportion of total losses when the portfolio total loss is large, and so they consume a greater proportion of cheaper, higher layer capital.</li>
</ul>
<p>We see all of these phenomena in the example.</p>
<p>With price, quantity, and proportion all variable the overall effect of the NA of capital is hard to predict. Since price, amount, and use are all correlated, it is never adequate to assume that the unit average cost of capital is the portfolio average cost of capital. This is the fundamental flaw in the industry standard approach, which uses the same cost of capital for all capital layers (see <a href="040_PricingAndAllocation.html#sec-ISA" class="quarto-xref"><span>Section 4.7</span></a>). The SRM-based method outlined here produces varying cost of capital by unit in a defensible manner—given a choice of distortion function. How to make that choice was discussed in <a href="060_SelectingSRM.html" class="quarto-xref"><span>Chapter 6</span></a>.</p>
</section>
<section id="comparions-with-bodoffs-layer-capital-allocation" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="comparions-with-bodoffs-layer-capital-allocation"><span class="header-section-number">8.4</span> Comparions with Bodoff’s layer capital allocation</h2>
<p>Readers may have guessed that the NA is closely related to Bodoff’s layer capital allocation <span class="citation" data-cites="Bodoff2007">(<a href="references.html#ref-Bodoff2007" role="doc-biblioref">Bodoff 2007</a>)</span>. This section will explain how they are correct and show the connections, similarities, and differences between the two approaches. Bodoff’s approach uses <span class="math inline">\(\alpha^i\)</span>, which describes how loss in each layer is shared between the units, and applies it to <em>all</em> assets in the layer. Since <span class="math inline">\(\sum_i \alpha^1 = 1\)</span> we get a decomposition <span class="math display">\[
a = \int_0^a 1\,dx = \sum_i \int_0^a \alpha^i(x)\,dx.
\]</span> Thus, <span class="math inline">\(a^i=\int_0^a \alpha^i(x)\,dx\)</span> is a reasonable allocation of assets. However, to determine a premium <span class="math inline">\(a^i\)</span> needs to be split into amounts <span class="math inline">\(P^i + Q^i\)</span> funded by policyholder premium and investor capital. For example, we could fall back to CCoC, resulting in a layer premium <span class="math display">\[
(\alpha^i(x) S(x) + \delta \alpha^i(x) (1 - S(x)))  + \nu \delta \alpha^i(x) (1 - S(x))
\]</span> where the first parenthetic term is expected loss (<a href="#eq-alpha-k-i" class="quarto-xref">Equation&nbsp;<span>8.3</span></a>) plus a margin <span class="math inline">\(\delta\)</span> times the unfunded liability (<a href="040_PricingAndAllocation.html#tbl-pentagon" class="quarto-xref">Table&nbsp;<span>4.1</span></a>, P3), and the second term is investor capital (<a href="040_PricingAndAllocation.html#tbl-pentagon" class="quarto-xref">Table&nbsp;<span>4.1</span></a>, Q). This reproduces distortion CCoC pricing. Picking other distortions, which allow for the unfunded liability to be split differently than losses, produces a range of other answers. Bodoff’s paper is very insightful, but it falls short by not fully describing a premium allocation: further assumptions are still needed to convert allocated assets into allocated premiums. <a href="#tbl-bodoff" class="quarto-xref">Table&nbsp;<span>8.12</span></a> shows Bodoff’s asset allocation in the last four right-hand columns.</p>
<div class="cell" data-execution_count="22">
<div id="tbl-bodoff" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="22">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-bodoff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;8.12: Bodoff’s asset allocations, <span class="math inline">\(\alpha^i\Delta X\)</span>.
</figcaption>
<div aria-describedby="tbl-bodoff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="21">
<div class="greater-table">
<style>
    #TZTJ5UQJSORU5  {
    border-collapse: collapse;
    font-family: "Roboto", "Open Sans Condensed", "Arial", 'Segoe UI', sans-serif;
    font-size: 1.0em;
    width: auto;
    
    margin: 10px auto;
    border: none;
    overflow: auto;
    margin-left: auto;
    margin-right: auto;
    }
    
    
    
    #TZTJ5UQJSORU5 caption {
        padding: 4px 10px 2px 10px;
        font-size: 1.1em;
        text-align: center;
        font-weight: normal;
        caption-side: top;
    }
    #TZTJ5UQJSORU5 thead {
        
        border-top: 1px solid #000;
        border-bottom: 1px solid #000;
        font-size: 1.0em;
        }
    #TZTJ5UQJSORU5 tbody {
        
        border-bottom: 1px solid #000;
        }
    #TZTJ5UQJSORU5 th  {
        vertical-align: bottom;
        padding: 4px 10px 4px 10px;
    }
    #TZTJ5UQJSORU5 td {
        
        padding: 2px 10px 2px 10px;
        vertical-align: top;
    }
    
    #TZTJ5UQJSORU5 .grt-hrule-0 {
        border-top: 0.0px solid #000;
    }
    #TZTJ5UQJSORU5 .grt-hrule-1 {
        border-top: 0.0px solid #000;
    }
    #TZTJ5UQJSORU5 .grt-hrule-2 {
        border-top: 0.0px solid #000;
    }
    
    #TZTJ5UQJSORU5 .grt-bhrule-0 {
        border-bottom: 0.0px solid #000;
    }
    #TZTJ5UQJSORU5 .grt-bhrule-1 {
        border-bottom: 0.0px solid #000;
    }
    #TZTJ5UQJSORU5 .grt-vrule-index {
        border-left: 1px solid #000;
    }
    #TZTJ5UQJSORU5 .grt-vrule-0 {
        border-left: 0.0px solid #000;
    }
    #TZTJ5UQJSORU5 .grt-vrule-1 {
        border-left: 0.0px solid #000;
    }
    #TZTJ5UQJSORU5 .grt-vrule-2 {
        border-left: 0.0px solid #000;
    }
    #TZTJ5UQJSORU5 .grt-left {
        text-align: left;
    }
    #TZTJ5UQJSORU5 .grt-center {
        text-align: center;
    }
    #TZTJ5UQJSORU5 .grt-right {
        text-align: right;
        font-variant-numeric: tabular-nums;
    }
    #TZTJ5UQJSORU5 .grt-head {
        font-family: "Times New Roman", 'Courier New';
        font-size: 1.0em;
    }
    #TZTJ5UQJSORU5 .grt-bold {
        font-weight: bold;
    }

</style>

<table id="TZTJ5UQJSORU5" class="do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="grt-left" data-quarto-table-cell-role="th">\(k\)</th>
<th class="grt-center grt-vrule-index" data-quarto-table-cell-role="th">Total \(X\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(p\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(S\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(\Delta X\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(\alpha^1\Delta X\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(\alpha^2\Delta X\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(\alpha^3\Delta X\)</th>
<th class="grt-center grt-vrule-0" data-quarto-table-cell-role="th">\(\sum\alpha^i\Delta X\)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="grt-c-0 grt-left">0</td>
<td class="grt-c-1 grt-right grt-vrule-index">0</td>
<td class="grt-c-2 grt-right grt-vrule-0">0</td>
<td class="grt-c-3 grt-right grt-vrule-0">1</td>
<td class="grt-c-4 grt-right grt-vrule-0">22</td>
<td class="grt-c-5 grt-right grt-vrule-0">7.152</td>
<td class="grt-c-6 grt-right grt-vrule-0">9.694</td>
<td class="grt-c-7 grt-right grt-vrule-0">5.154</td>
<td class="grt-c-8 grt-right grt-vrule-0">22</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left grt-hrule-0">1</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">22</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">0.1</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">0.9</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">6</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">1.713</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">2.726</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">1.562</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">6</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left grt-hrule-0">2</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">28</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">0.1</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">0.8</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">8</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">2.033</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">3.624</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">2.343</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">8</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left grt-hrule-0">3</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">36</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">0.1</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">0.7</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">4</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">1.082</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">1.753</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">1.164</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">4</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left grt-hrule-0">4</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">40</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">0.4</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">0.3</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">15</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">4.471</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">3.343</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">7.186</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">15.000</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left grt-hrule-0">5</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">55</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">0.1</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">0.2</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">10</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">2.108</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">1.615</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">6.277</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">10.000</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left grt-hrule-0">6</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">65</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">0.1</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">0.1</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">35</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">5.600</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">7.000</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">22.400</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">35.000</td>
</tr>
<tr class="even">
<td class="grt-c-0 grt-left grt-hrule-0">7</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">100</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0">0.1</td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0">0</td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0">0</td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">0</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">0</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">0</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">0</td>
</tr>
<tr class="odd">
<td class="grt-c-0 grt-left grt-hrule-0">Total</td>
<td class="grt-c-1 grt-right grt-hrule-0 grt-vrule-index">46.6</td>
<td class="grt-c-2 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-3 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-4 grt-right grt-hrule-0 grt-vrule-0"></td>
<td class="grt-c-5 grt-right grt-hrule-0 grt-vrule-0">24.159</td>
<td class="grt-c-6 grt-right grt-hrule-0 grt-vrule-0">29.756</td>
<td class="grt-c-7 grt-right grt-hrule-0 grt-vrule-0">46.086</td>
<td class="grt-c-8 grt-right grt-hrule-0 grt-vrule-0">100.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-Bodoff2007" class="csl-entry" role="listitem">
Bodoff, Neil M. 2007. <span>“<span class="nocase">Capital Allocation by Percentile Layer</span>.”</span> <em>Variance</em> 3 (1): 13–30.
</div>
<div id="ref-bolstad2016introduction" class="csl-entry" role="listitem">
Bolstad, William M, and James M Curran. 2016. <em>Introduction to Bayesian Statistics</em>. John Wiley &amp; Sons.
</div>
<div id="ref-geisser2017predictive" class="csl-entry" role="listitem">
Geisser, Seymour. 2017. <em>Predictive Inference</em>. Chapman; Hall/CRC.
</div>
<div id="ref-Golub2013bk" class="csl-entry" role="listitem">
Golub, Gene H, and Charles F Van Loan. 2013. <em>Matrix Computations</em>. Johns Hopkins University Press.
</div>
<div id="ref-Hansen2008" class="csl-entry" role="listitem">
Hansen, Lars Peter, and Thomas J Sargent. 2008. <em><span>Robustness</span></em>. <a href="https://doi.org/10.1007/978-1-4471-5562-1_7">https://doi.org/10.1007/978-1-4471-5562-1_7</a>.
</div>
<div id="ref-Jewson2025" class="csl-entry" role="listitem">
Jewson, Stephen, Trevor Sweeting, and Lynne Jewson. 2025. <span>“<span class="nocase">Reducing reliability bias in assessments of extreme weather risk using calibrating priors</span>.”</span> <em>Advances in Statistical Climatology, Meteorology and Oceanography</em> 11 (1): 1–22. <a href="https://doi.org/10.5194/ascmo-11-1-2025">https://doi.org/10.5194/ascmo-11-1-2025</a>.
</div>
<div id="ref-Kreps1997" class="csl-entry" role="listitem">
Kreps, Rodney E. 1997. <em>Parameter Uncertainty in (Log)normal Distributions</em>. <a href="https://www.casact.org/sites/default/files/database/proceed_proceed97_97553.pdf">https://www.casact.org/sites/default/files/database/proceed_proceed97_97553.pdf</a>.
</div>
<div id="ref-Major1999a" class="csl-entry" role="listitem">
Major, John A. 1999. <span>“<span class="nocase">Taking Uncertainty Into Account: Bias Issues Arising from Parameter Uncertainty in Risk Models</span>.”</span> <em>CAS Forum</em> Summer (153-196).
</div>
<div id="ref-Major2015" class="csl-entry" role="listitem">
Major, John A., Ruodu Wang, and Micah G. Woolstenhulme. 2015. <span>“<span class="nocase">The Most Dangerous Model: A Natural Benchmark for Assessing Model Risk</span>.”</span> <em>Society of Actuaries Monograph: Enterprise Risk Management Symposium</em>, 1–45.
</div>
<div id="ref-Mildenhall2023a" class="csl-entry" role="listitem">
Mildenhall, Stephen J. 2023. <span>“<span class="nocase">aggregate: Frequency-Severity Distributions Made Easy</span>.”</span> <em>Actuarial Review</em> 50(3): 31–34. <a href="https://ar.casact.org/aggregate-frequency-severity-distributions-made-easy/">https://ar.casact.org/aggregate-frequency-severity-distributions-made-easy/</a>.
</div>
<div id="ref-MildenhallCR2022" class="csl-entry" role="listitem">
Mildenhall, Stephen J. n.d. <em><span class="nocase">When is Premium Riskier Than Loss?</span></em>
</div>
<div id="ref-Mildenhall2005a" class="csl-entry" role="listitem">
Mildenhall, Stephen J. 2005. <span>“<span class="nocase">Correlation and Aggregate Loss Distributions With An Emphasis On The Iman-Conover Method</span>.”</span> <em>Casualty Actuarial Society Forum</em> Winter. <a href="https://www.casact.org/sites/default/files/database/forum_06wforum_06w107.pdf">https://www.casact.org/sites/default/files/database/forum_06wforum_06w107.pdf</a>.
</div>
<div id="ref-Press1992a" class="csl-entry" role="listitem">
Press, William H., Saul A. Teukolsky, William T. Vetterling, and Brian P. Flannery. 1992. <em><span class="nocase">Numerical Recipes in C</span></em>. Cambridge University Press.
</div>
<div id="ref-smith2024uncertainty" class="csl-entry" role="listitem">
Smith, Ralph C. 2024. <em>Uncertainty Quantification: Theory, Implementation, and Applications</em>. SIAM.
</div>
<div id="ref-WangS1998" class="csl-entry" role="listitem">
Wang, Shaun S. 1998. <span>“<span class="nocase">Aggregation of correlated risk portfolios: models and algorithms</span>.”</span> <em>Proceedings of the Casualty Actuarial Society</em>, 848–939.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/cmm\.mynl\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./065_Evaluation.html" class="pagination-link" aria-label="Evaluating models">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Evaluating models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./080_Calculations.html" class="pagination-link" aria-label="Calculations with `Aggregate`">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Calculations with <code>Aggregate</code></span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb6" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb6-1"><a href="#cb6-1"></a><span class="co">---</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="an">format:</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co">  pdf: default</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co">  html: default</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="an">jupyter:</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">  jupytext:</span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co">    text_representation:</span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">      extension: .qmd</span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">      format_name: quarto</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">      format_version: '1.0'</span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">      jupytext_version: 1.16.4</span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="co">  kernelspec:</span></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="co">    display_name: Python 3 (ipykernel)</span></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="co">    language: python</span></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="co">    name: python3</span></span>
<span id="cb6-16"><a href="#cb6-16"></a><span class="co">---</span></span>
<span id="cb6-17"><a href="#cb6-17"></a></span>
<span id="cb6-20"><a href="#cb6-20"></a><span class="in">```{python}</span></span>
<span id="cb6-21"><a href="#cb6-21"></a><span class="co">#| echo: false</span></span>
<span id="cb6-22"><a href="#cb6-22"></a><span class="co">#| label: spacer</span></span>
<span id="cb6-23"><a href="#cb6-23"></a><span class="cf">pass</span></span>
<span id="cb6-24"><a href="#cb6-24"></a><span class="in">```</span></span>
<span id="cb6-25"><a href="#cb6-25"></a></span>
<span id="cb6-26"><a href="#cb6-26"></a><span class="fu"># Advanced topics {#sec-Advanced-Topics}</span></span>
<span id="cb6-27"><a href="#cb6-27"></a></span>
<span id="cb6-28"><a href="#cb6-28"></a><span class="fu">## Dealing with uncertainty {#sec-Uncertainty}</span></span>
<span id="cb6-29"><a href="#cb6-29"></a></span>
<span id="cb6-30"><a href="#cb6-30"></a>*In this world, nothing is certain except death and taxes.*\</span>
<span id="cb6-31"><a href="#cb6-31"></a>*- Benjamin Franklin, letter to  Jean-Baptiste Leroy*</span>
<span id="cb6-32"><a href="#cb6-32"></a></span>
<span id="cb6-33"><a href="#cb6-33"></a>The purpose of simulation is to estimate certain **quantities of interest** or **QoI**. A QoI is typically a quantile or other function (e.g., mean, risk measure) of the sample outcomes that the simulation created. Since it is being estimated from a sample, it cannot be measured with perfect accuracy because of sampling error. The more simulated samples are created, the more accurate the estimate can be. However, there is another reason that the estimate will not be accurate.</span>
<span id="cb6-34"><a href="#cb6-34"></a></span>
<span id="cb6-35"><a href="#cb6-35"></a>**Parameter uncertainty** here is to be distinguished from **process risk**. For example, when you simulate the outcome from a random variable with a lognormal distribution with particular parameters, you are modeling process risk. When you aren't sure what the parameter values should be, you are suffering from parameter uncertainty. The uncertainty around input parameters will propagate to uncertainty about the QoI. For example, it is well known that ignoring parameter uncertainty often systematically biases estimated quantiles downward. See @Jewson2025 for an approach to adjust for this bias.</span>
<span id="cb6-36"><a href="#cb6-36"></a></span>
<span id="cb6-37"><a href="#cb6-37"></a>Parameter uncertainty arises from *nonsampling error*. There are many potential sources of this in a capital model. Data used to build the model could have erroneous entries, or it might not be of an appropriate vintage or refer to a population that is sufficiently relevant to the modeling task. In building the model, perhaps not all relevant factors have been taken into account. This is not an exhaustive list!</span>
<span id="cb6-38"><a href="#cb6-38"></a></span>
<span id="cb6-39"><a href="#cb6-39"></a>In addition, some parameters vary over time. A data snapshot taken to estimate parameters may be inappropriate to modeling the same phenomenon at a later date.</span>
<span id="cb6-40"><a href="#cb6-40"></a></span>
<span id="cb6-41"><a href="#cb6-41"></a>Parameter uncertainty will likely permeate your modeling efforts, especially if you are trying to make a model that can replicate historical experience. There are several ways to deal with uncertainty:</span>
<span id="cb6-42"><a href="#cb6-42"></a></span>
<span id="cb6-43"><a href="#cb6-43"></a><span class="ss">1.  </span>**Ignore it.** Use a best estimate of parameter values and let it go at that. While this may be acceptable for early versions of the model, it is not recommended for the long term. At the very least you must disclose that there is some uncertainty as to the QoI values and what the business risks of that are. "The answer is $A$, but there is some uncertainty."</span>
<span id="cb6-44"><a href="#cb6-44"></a><span class="ss">2.  </span>**Report it.** Statistical analysis of data will usually give some indication of the range (e.g., variance) of parameter values consistent with a chosen model for the data. If you want to push your luck, that insight can be turned into a distributional model for the parameters. Rerun your model with carefully chosen exemplars or a sample from the putative distribution of those random parameters. Report the range or the resulting distribution of the QoI. "The answer is $A \pm \epsilon$."</span>
<span id="cb6-45"><a href="#cb6-45"></a><span class="ss">3.  </span>**Absorb it.** Classical (frequentist) statistics has prediction intervals to accommodate uncertainty in the parameters; Bayesian theory provides a formal framework for treating parameter uncertainty as another species of process risk. Essentially, this means treating the random parameter as mixing the distribution of QoI, creating what Bayesians call a predictive distribution; see @bolstad2016introduction or @geisser2017predictive. This is explained in an actuarial context in @Kreps1997; however, @Major1999a finds reasons to doubt it is always the right approach. Prediction intervals are bigger than classically estimated intervals. The QoI is likely to be sensitive to the upper tail, which moves up. "The answer is $A+\delta$."</span>
<span id="cb6-46"><a href="#cb6-46"></a><span class="ss">4.  </span>**Isolate it.** Find a credible worst-case to offer as an example of what can go wrong. This is the approach covered in @Hansen2008 and @Major2015. Again, this is likely to increase a risk-sensitive QoI. "The answer is $A$, but it could be as bad as $A+\gamma$."</span>
<span id="cb6-47"><a href="#cb6-47"></a></span>
<span id="cb6-48"><a href="#cb6-48"></a>For a general treatment, see @smith2024uncertainty.</span>
<span id="cb6-49"><a href="#cb6-49"></a></span>
<span id="cb6-50"><a href="#cb6-50"></a><span class="fu">## The Iman-Conover method {#sec-iman-conover}</span></span>
<span id="cb6-51"><a href="#cb6-51"></a></span>
<span id="cb6-52"><a href="#cb6-52"></a>*Correlation is not causation, but you can cause some correlation.*</span>
<span id="cb6-53"><a href="#cb6-53"></a></span>
<span id="cb6-54"><a href="#cb6-54"></a>The Iman-Conover method is an easy way to induce correlation between marginal distributions. Here is the idea. Given samples of $n$ values from $r$ known marginal distributions $X_1,\dots,X_r$ and a desired $r\times r$ (linear) correlation matrix $\Sigma$ between them, reorder the $i$th sample to have the same rank order as the $i$th column of a reference distribution of size $n\times r$ with linear correlation $\Sigma$. The reordered output will then have the same rank correlation as the reference, and since linear correlation and rank correlation are typically close, it will have close to the desired correlation structure. What makes the Iman-Conover method work so effectively is the existence of easy algorithms to determine samples from reference distributions with prescribed correlation structures.</span>
<span id="cb6-55"><a href="#cb6-55"></a></span>
<span id="cb6-56"><a href="#cb6-56"></a>The Iman-Conover method is very powerful, quick, and easy to use. However, it is not magic, and it is constrained by mathematical reality. For given pairs of distributions there is often an upper bound on the *linear* correlation between them, so if you ask for very high correlation you may be disappointed. You should go back and ask yourself why you think the linear correlation is so high.</span>
<span id="cb6-57"><a href="#cb6-57"></a></span>
<span id="cb6-58"><a href="#cb6-58"></a>Iman-Conover is usually used to induce a desired linear correlation. There other measures, such as rank correlation and Kendall's tau, that could be used <span class="co">[</span><span class="ot">@Mildenhall2005a</span><span class="co">]</span> and the user should reflect on which is most appropriate to their application. If your target is rank correlation, Iman-Conover will give you an exact match.</span>
<span id="cb6-59"><a href="#cb6-59"></a></span>
<span id="cb6-60"><a href="#cb6-60"></a>The <span class="co">[</span><span class="ot">`aggregate` documentation</span><span class="co">](https://aggregate.readthedocs.io/en/latest/5_technical_guides/5_x_iman_conover.html#algorithm)</span> provides a detailed description of the algorithm, including discussion of using different reference distributions (called scores) in place of the normal, and a comparison with the normal copula method.</span>
<span id="cb6-61"><a href="#cb6-61"></a></span>
<span id="cb6-62"><a href="#cb6-62"></a><span class="fu">### Loss or loss ratio?</span></span>
<span id="cb6-63"><a href="#cb6-63"></a></span>
<span id="cb6-64"><a href="#cb6-64"></a>Are you modeling correlation of *loss ratios* or correlation of *losses*? It is a surprising empirical fact that the former is often greater than the latter, leading to the conclusion that correlation in *underwriting results* is driven by correlation in *premium* more than loss, see @MildenhallCR2022. These findings highlight a stark property-casualty split. Property tends to be loss-volatility driven, with loss correlation caused (and explained) by geographic proximity. Casualty tends to be premium-volatility driven, with loss ratio correlation caused by (account) underwriting and the underwriting cycle.</span>
<span id="cb6-65"><a href="#cb6-65"></a></span>
<span id="cb6-66"><a href="#cb6-66"></a><span class="fu">### Example 1: A simple example {#sec-example-1}</span></span>
<span id="cb6-67"><a href="#cb6-67"></a></span>
<span id="cb6-68"><a href="#cb6-68"></a>This section presents a simple example applying Iman-Conover to realistic distributions, using the <span class="in">`aggregate`</span> library. It shows how easy it is to use Iman-Conover in modern programming languages. Another example, with more the details, appears in the <span class="co">[</span><span class="ot">`aggregate` documentation</span><span class="co">](https://aggregate.readthedocs.io/en/latest/5_technical_guides/5_x_iman_conover.html#simple-example-of-iman-conover)</span>. See @sec-setup-code for instructions to set up your Python environment to replicate the code samples. The full source code to replicate the examples is available on the <span class="co">[</span><span class="ot">Monograph website</span><span class="co">](https://cmm.mynl.com)</span>.</span>
<span id="cb6-69"><a href="#cb6-69"></a></span>
<span id="cb6-70"><a href="#cb6-70"></a>The example works with $r=3$ different marginals: Auto, general liability (GL), and Property. Losses are simulated using frequency-severity aggregate distributions with a lognormal severity and per occurrence limits. Frequency is a gamma-mixed Poisson (negative binomial) with varying CVs. See @Mildenhall2023a for a description of the <span class="in">`aggregate`</span> DecL language, used to specify these portfolios.</span>
<span id="cb6-71"><a href="#cb6-71"></a></span>
<span id="cb6-72"><a href="#cb6-72"></a><span class="in">```</span></span>
<span id="cb6-73"><a href="#cb6-73"></a><span class="in">port ICExample</span></span>
<span id="cb6-74"><a href="#cb6-74"></a><span class="in">    agg Auto      5000 loss  2000 xs 0 sev lognorm  30 cv 2 mixed gamma 0.2</span></span>
<span id="cb6-75"><a href="#cb6-75"></a><span class="in">    agg GL        2000 loss  5000 xs 0 sev lognorm  50 cv 5 mixed gamma 0.3</span></span>
<span id="cb6-76"><a href="#cb6-76"></a><span class="in">    agg Property  7000 loss 10000 xs 0 sev lognorm 100 cv 5 mixed gamma 0.1</span></span>
<span id="cb6-77"><a href="#cb6-77"></a><span class="in">```</span></span>
<span id="cb6-78"><a href="#cb6-78"></a></span>
<span id="cb6-79"><a href="#cb6-79"></a>This example uses only 1,000 simulations, but the software can easily handle 100,000 or more. The slowest part of the Iman-Conover algorithm is creating the scores. These are cached, so subsequent runs are very fast, even if the desired correlation matrix changes.</span>
<span id="cb6-80"><a href="#cb6-80"></a></span>
<span id="cb6-83"><a href="#cb6-83"></a><span class="in">```{python}</span></span>
<span id="cb6-84"><a href="#cb6-84"></a><span class="co">#| echo: false</span></span>
<span id="cb6-85"><a href="#cb6-85"></a><span class="co">#| label: lstx-ic-setup</span></span>
<span id="cb6-86"><a href="#cb6-86"></a></span>
<span id="cb6-87"><a href="#cb6-87"></a><span class="co"># code-cap: Setup code for the Iman-Conover example.</span></span>
<span id="cb6-88"><a href="#cb6-88"></a><span class="op">%</span>run prefob.py</span>
<span id="cb6-89"><a href="#cb6-89"></a><span class="im">from</span> pandas.plotting <span class="im">import</span> scatter_matrix</span>
<span id="cb6-90"><a href="#cb6-90"></a></span>
<span id="cb6-91"><a href="#cb6-91"></a><span class="co"># number of simulations, adjust as needed</span></span>
<span id="cb6-92"><a href="#cb6-92"></a>n <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb6-93"><a href="#cb6-93"></a>port <span class="op">=</span> build(<span class="st">'''</span></span>
<span id="cb6-94"><a href="#cb6-94"></a><span class="st">port ICExample</span></span>
<span id="cb6-95"><a href="#cb6-95"></a><span class="st">    agg Auto      5000 loss  2000 xs 0 sev lognorm  30 cv 2 mixed gamma 0.2</span></span>
<span id="cb6-96"><a href="#cb6-96"></a><span class="st">    agg GL        2000 loss  5000 xs 0 sev lognorm  50 cv 5 mixed gamma 0.3</span></span>
<span id="cb6-97"><a href="#cb6-97"></a><span class="st">    agg Property  7000 loss 10000 xs 0 sev lognorm 100 cv 5 mixed gamma 0.1</span></span>
<span id="cb6-98"><a href="#cb6-98"></a><span class="st">'''</span>)</span>
<span id="cb6-99"><a href="#cb6-99"></a></span>
<span id="cb6-100"><a href="#cb6-100"></a>df <span class="op">=</span> port.sample(n, desired_correlation<span class="op">=</span><span class="va">None</span>, keep_total<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-101"><a href="#cb6-101"></a><span class="in">```</span></span>
<span id="cb6-102"><a href="#cb6-102"></a></span>
<span id="cb6-103"><a href="#cb6-103"></a>@tbl-samples-agg shows summary statistics and the first few samples of the underlying multivariate distribution, and @fig-marginals shows histograms of each marginal and scatterplots. By construction, the units are approximately independent.</span>
<span id="cb6-104"><a href="#cb6-104"></a></span>
<span id="cb6-107"><a href="#cb6-107"></a><span class="in">```{python}</span></span>
<span id="cb6-108"><a href="#cb6-108"></a><span class="co">#| echo: false</span></span>
<span id="cb6-109"><a href="#cb6-109"></a><span class="co">#| label: tbl-samples-agg</span></span>
<span id="cb6-110"><a href="#cb6-110"></a><span class="co">#| tbl-cap: Set up and summary statistics of sample for Iman-Conover example using 1,000 samples.</span></span>
<span id="cb6-111"><a href="#cb6-111"></a><span class="co">#| layout-ncol: 1</span></span>
<span id="cb6-112"><a href="#cb6-112"></a><span class="co">#| tbl-subcap: [Summary statistics., First 10 samples.]</span></span>
<span id="cb6-113"><a href="#cb6-113"></a></span>
<span id="cb6-114"><a href="#cb6-114"></a>dfd <span class="op">=</span> df.describe()</span>
<span id="cb6-115"><a href="#cb6-115"></a>dfd.loc[<span class="st">'cv'</span>, :] <span class="op">=</span> dfd.loc[<span class="st">'std'</span>] <span class="op">/</span> dfd.loc[<span class="st">'mean'</span>]</span>
<span id="cb6-116"><a href="#cb6-116"></a><span class="co">#display(dfd.style.format(precision=0, thousands=','))</span></span>
<span id="cb6-117"><a href="#cb6-117"></a><span class="co">#display(df.head(10).style.format(precision=0, thousands=','))</span></span>
<span id="cb6-118"><a href="#cb6-118"></a>display(fGT(dfd))</span>
<span id="cb6-119"><a href="#cb6-119"></a>fGT(df.head(<span class="dv">10</span>))</span>
<span id="cb6-120"><a href="#cb6-120"></a><span class="in">```</span></span>
<span id="cb6-121"><a href="#cb6-121"></a></span>
<span id="cb6-124"><a href="#cb6-124"></a><span class="in">```{python}</span></span>
<span id="cb6-125"><a href="#cb6-125"></a><span class="co">#| echo: false</span></span>
<span id="cb6-126"><a href="#cb6-126"></a><span class="co">#| label: fig-marginals</span></span>
<span id="cb6-127"><a href="#cb6-127"></a><span class="co">#| fig-cap: Uncorrelated marginals input to IC method. Diagonal shows univariate histograms.</span></span>
<span id="cb6-128"><a href="#cb6-128"></a><span class="co">#| fig-format: png</span></span>
<span id="cb6-129"><a href="#cb6-129"></a></span>
<span id="cb6-130"><a href="#cb6-130"></a>scatter_matrix(df, grid<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb6-131"><a href="#cb6-131"></a>    figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">6</span>), diagonal<span class="op">=</span><span class="st">'hist'</span>,</span>
<span id="cb6-132"><a href="#cb6-132"></a>    hist_kwds<span class="op">=</span>{<span class="st">'density'</span>: <span class="va">True</span>, <span class="st">'bins'</span>: <span class="dv">25</span>, <span class="st">'lw'</span>: <span class="fl">.25</span>, <span class="st">'ec'</span>: <span class="st">'w'</span>},</span>
<span id="cb6-133"><a href="#cb6-133"></a>    s<span class="op">=</span><span class="dv">3</span>, marker<span class="op">=</span><span class="st">'.'</span>)<span class="op">;</span></span>
<span id="cb6-134"><a href="#cb6-134"></a><span class="in">```</span></span>
<span id="cb6-135"><a href="#cb6-135"></a></span>
<span id="cb6-136"><a href="#cb6-136"></a>In addition to marginal distributions, Iman-Conover requires a target desired correlation matrix as input. This is produced by a separate analysis, and here we assume it is given by @tbl-desired-corr. Remember, a correlation matrix must be symmetric (easy to check) and positive definite (harder). Matrices computed from statistical analysis may fail to be positive definite if they are not computed from a multivariate sample. Iman-Conover fails if given a nonpositive definite matrix.</span>
<span id="cb6-137"><a href="#cb6-137"></a></span>
<span id="cb6-140"><a href="#cb6-140"></a><span class="in">```{python}</span></span>
<span id="cb6-141"><a href="#cb6-141"></a><span class="co">#| echo: false</span></span>
<span id="cb6-142"><a href="#cb6-142"></a><span class="co">#| label: tbl-desired-corr</span></span>
<span id="cb6-143"><a href="#cb6-143"></a><span class="co">#| tbl-cap: Target correlation matrix.</span></span>
<span id="cb6-144"><a href="#cb6-144"></a></span>
<span id="cb6-145"><a href="#cb6-145"></a>desired <span class="op">=</span> np.matrix([[<span class="dv">1</span>, <span class="op">-</span><span class="fl">.3</span>, <span class="dv">0</span>],</span>
<span id="cb6-146"><a href="#cb6-146"></a>                     [<span class="op">-</span><span class="fl">.3</span>, <span class="dv">1</span>, <span class="fl">.8</span>],</span>
<span id="cb6-147"><a href="#cb6-147"></a>                     [<span class="dv">0</span>, <span class="fl">.8</span>, <span class="dv">1</span>]])</span>
<span id="cb6-148"><a href="#cb6-148"></a>line_names <span class="op">=</span> df.columns</span>
<span id="cb6-149"><a href="#cb6-149"></a>desired_df <span class="op">=</span> pd.DataFrame(desired,</span>
<span id="cb6-150"><a href="#cb6-150"></a>                          index<span class="op">=</span>line_names,</span>
<span id="cb6-151"><a href="#cb6-151"></a>                          columns<span class="op">=</span>line_names)</span>
<span id="cb6-152"><a href="#cb6-152"></a><span class="co"># desired_df.style.format(precision=3)</span></span>
<span id="cb6-153"><a href="#cb6-153"></a>fGT(desired_df)</span>
<span id="cb6-154"><a href="#cb6-154"></a><span class="in">```</span></span>
<span id="cb6-155"><a href="#cb6-155"></a></span>
<span id="cb6-156"><a href="#cb6-156"></a>The Iman-Conover method is implemented in <span class="in">`aggregate`</span> by the function <span class="in">`iman_conover`</span>, so the transformation is simply</span>
<span id="cb6-157"><a href="#cb6-157"></a></span>
<span id="cb6-158"><a href="#cb6-158"></a><span class="in">``` python</span></span>
<span id="cb6-159"><a href="#cb6-159"></a>df2 <span class="op">=</span> iman_conover(df, desired)</span>
<span id="cb6-160"><a href="#cb6-160"></a><span class="in">```</span></span>
<span id="cb6-161"><a href="#cb6-161"></a></span>
<span id="cb6-162"><a href="#cb6-162"></a>where <span class="in">`desired`</span> is the desired correlation matrix. @tbl-ic shows the achieved linear and rank correlation, and the absolute and relative errors. Finally, @fig-marginals-2 provides a scatter plot of the shuffled inputs, making the correlation evident. It is possible to obtain a correlated sample from a <span class="in">`Portfolio`</span> object by passing in a correlation matrix: the code below extracts a sample and automatically applies Iman-Conover.</span>
<span id="cb6-163"><a href="#cb6-163"></a></span>
<span id="cb6-164"><a href="#cb6-164"></a><span class="in">``` python</span></span>
<span id="cb6-165"><a href="#cb6-165"></a>df <span class="op">=</span> port.sample(n, desired_correlation<span class="op">=</span>desired, keep_total<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-166"><a href="#cb6-166"></a><span class="in">```</span></span>
<span id="cb6-167"><a href="#cb6-167"></a></span>
<span id="cb6-170"><a href="#cb6-170"></a><span class="in">```{python}</span></span>
<span id="cb6-171"><a href="#cb6-171"></a><span class="co">#| echo: false</span></span>
<span id="cb6-172"><a href="#cb6-172"></a><span class="co">#| label: tbl-ic</span></span>
<span id="cb6-173"><a href="#cb6-173"></a><span class="co">#| tbl-cap: Achieved correlation matrix and output errors with Iman-Conover method.</span></span>
<span id="cb6-174"><a href="#cb6-174"></a><span class="co">#| layout-ncol: 1</span></span>
<span id="cb6-175"><a href="#cb6-175"></a><span class="co">#| tbl-subcap: [Linear correlation, Rank correlation, Absolute error, Relative error]</span></span>
<span id="cb6-176"><a href="#cb6-176"></a>df2 <span class="op">=</span> iman_conover(df, desired)</span>
<span id="cb6-177"><a href="#cb6-177"></a>achieved <span class="op">=</span> df2.corr()</span>
<span id="cb6-178"><a href="#cb6-178"></a>display(fGT(achieved))</span>
<span id="cb6-179"><a href="#cb6-179"></a>display(fGT(df2.corr(method<span class="op">=</span><span class="st">'spearman'</span>)))</span>
<span id="cb6-180"><a href="#cb6-180"></a></span>
<span id="cb6-181"><a href="#cb6-181"></a>err <span class="op">=</span> achieved <span class="op">-</span> desired_df</span>
<span id="cb6-182"><a href="#cb6-182"></a>rel_err <span class="op">=</span> err <span class="op">/</span> desired_df</span>
<span id="cb6-183"><a href="#cb6-183"></a>display(fGT(err.<span class="bu">abs</span>()))</span>
<span id="cb6-184"><a href="#cb6-184"></a>fGT(rel_err, max_table_inch_width<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb6-185"><a href="#cb6-185"></a><span class="in">```</span></span>
<span id="cb6-186"><a href="#cb6-186"></a></span>
<span id="cb6-189"><a href="#cb6-189"></a><span class="in">```{python}</span></span>
<span id="cb6-190"><a href="#cb6-190"></a><span class="co">#| echo: false</span></span>
<span id="cb6-191"><a href="#cb6-191"></a><span class="co">#| label: fig-marginals-2</span></span>
<span id="cb6-192"><a href="#cb6-192"></a><span class="co">#| fig-cap: Correlated marginals output by the Iman-Conover method. Diagonal shows unchanged univariate histograms, but the scatterplots clearly show the introduction of correlation.</span></span>
<span id="cb6-193"><a href="#cb6-193"></a><span class="co">#| fig-format: png</span></span>
<span id="cb6-194"><a href="#cb6-194"></a></span>
<span id="cb6-195"><a href="#cb6-195"></a>scatter_matrix(df2, grid<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb6-196"><a href="#cb6-196"></a>    figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">6</span>), diagonal<span class="op">=</span><span class="st">'hist'</span>,</span>
<span id="cb6-197"><a href="#cb6-197"></a>    hist_kwds<span class="op">=</span>{<span class="st">'density'</span>: <span class="va">True</span>, <span class="st">'bins'</span>: <span class="dv">25</span>, <span class="st">'lw'</span>: <span class="fl">.25</span>, <span class="st">'ec'</span>: <span class="st">'w'</span>},</span>
<span id="cb6-198"><a href="#cb6-198"></a>    s<span class="op">=</span><span class="dv">3</span>, marker<span class="op">=</span><span class="st">'.'</span>)<span class="op">;</span></span>
<span id="cb6-199"><a href="#cb6-199"></a><span class="in">```</span></span>
<span id="cb6-200"><a href="#cb6-200"></a></span>
<span id="cb6-201"><a href="#cb6-201"></a>\clearpage</span>
<span id="cb6-202"><a href="#cb6-202"></a></span>
<span id="cb6-203"><a href="#cb6-203"></a><span class="fu">### Different reference distributions</span></span>
<span id="cb6-204"><a href="#cb6-204"></a></span>
<span id="cb6-205"><a href="#cb6-205"></a>The Iman-Conover algorithm relies on a sample from a multivariate reference distribution called scores. A straightforward method to compute a reference is to use the Choleski decomposition method applied to certain independent scores (samples with mean zero and standard deviation one). The standard algorithm uses standard normal scores. However, nothing prevents the use of other distributions for the scores, provided they are suitably normalized to have mean zero and standard deviation one. Several other families of multivariate distributions could be used, such as elliptically contoured distributions (which include the normal and $t$ as a special cases) and the multivariate Laplace distribution. These are all easy to simulate.</span>
<span id="cb6-206"><a href="#cb6-206"></a></span>
<span id="cb6-207"><a href="#cb6-207"></a>The <span class="in">`aggregate`</span> implementation provides $t$-distribution scores. It includes an argument <span class="in">`dof`</span>. By default <span class="in">`dof=0`</span> resulting in a normal reference. A <span class="in">`dof&gt;0`</span> is interpreted as degrees of freedom, and the reference becomes a $t$-distribution. @fig-t-ref reruns @sec-example-1 using a $t$ reference with 2 degrees of freedom, a very extreme choice. It results in more tail correlation, evident in the pinched scatterplots. Be warned, however, that this modeling flexibility definitely falls into the "just because you can, doesn't mean you should" category!</span>
<span id="cb6-208"><a href="#cb6-208"></a></span>
<span id="cb6-211"><a href="#cb6-211"></a><span class="in">```{python}</span></span>
<span id="cb6-212"><a href="#cb6-212"></a><span class="co">#| echo: false</span></span>
<span id="cb6-213"><a href="#cb6-213"></a><span class="co">#| label: fig-t-ref</span></span>
<span id="cb6-214"><a href="#cb6-214"></a><span class="co">#| fig-cap: Correlated marginals using a $t$-distribution with 2 degrees of freedom.</span></span>
<span id="cb6-215"><a href="#cb6-215"></a><span class="co">#| fig-format: png</span></span>
<span id="cb6-216"><a href="#cb6-216"></a></span>
<span id="cb6-217"><a href="#cb6-217"></a>df3 <span class="op">=</span> iman_conover(df, desired, dof<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb6-218"><a href="#cb6-218"></a></span>
<span id="cb6-219"><a href="#cb6-219"></a>scatter_matrix(df3, grid<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb6-220"><a href="#cb6-220"></a>    figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">6</span>), diagonal<span class="op">=</span><span class="st">'hist'</span>,</span>
<span id="cb6-221"><a href="#cb6-221"></a>    hist_kwds<span class="op">=</span>{<span class="st">'density'</span>: <span class="va">True</span>, <span class="st">'bins'</span>: <span class="dv">25</span>, <span class="st">'lw'</span>: <span class="fl">.25</span>, <span class="st">'ec'</span>: <span class="st">'w'</span>},</span>
<span id="cb6-222"><a href="#cb6-222"></a>    s<span class="op">=</span><span class="dv">3</span>, marker<span class="op">=</span><span class="st">'.'</span>)<span class="op">;</span></span>
<span id="cb6-223"><a href="#cb6-223"></a><span class="in">```</span></span>
<span id="cb6-224"><a href="#cb6-224"></a></span>
<span id="cb6-225"><a href="#cb6-225"></a><span class="fu">### Copulas as reference distributions</span></span>
<span id="cb6-226"><a href="#cb6-226"></a></span>
<span id="cb6-227"><a href="#cb6-227"></a>The reader may be wondering about using a copula as a reference score. Alas, most copulas are only bivariate. Multivariate copulas, aside from those related to elliptical or Laplace distributions already mentioned, are Archimedian, which means they have a single parameter and cannot be calibrated to a desired correlation matrix.</span>
<span id="cb6-228"><a href="#cb6-228"></a></span>
<span id="cb6-229"><a href="#cb6-229"></a>See the <span class="co">[</span><span class="ot">`aggregate` documentation</span><span class="co">](https://aggregate.readthedocs.io/en/latest/5_technical_guides/5_x_working_with_samples.html#alternative-scores)</span> and @Mildenhall2005a for more details.</span>
<span id="cb6-230"><a href="#cb6-230"></a></span>
<span id="cb6-231"><a href="#cb6-231"></a><span class="fu">### Iman-Conover compared with the normal copula method {#sec-IC-NC}</span></span>
<span id="cb6-232"><a href="#cb6-232"></a></span>
<span id="cb6-233"><a href="#cb6-233"></a>The normal copula method is described in @WangS1998. Given a set of risks $(X_1,\dots,X_k)$ with marginal cumulative distribution functions $F_i$ and Kendall's tau $\tau_{ij}=\tau(X_i,X_j)$ or rank correlation coefficients $r(X_i,X_j)$, it works as follows. Assume that $(Z_1,\dots,Z_k)$ have a multivariate normal joint probability density function given by</span>
<span id="cb6-234"><a href="#cb6-234"></a>$$</span>
<span id="cb6-235"><a href="#cb6-235"></a>f(z_1,\dots,z_k)=\frac{1}{\sqrt{(2\pi)^k|\Sigma|}}\exp(-\mathsf{z}'\Sigma^{-1}\mathsf{z}/2),</span>
<span id="cb6-236"><a href="#cb6-236"></a>$$</span>
<span id="cb6-237"><a href="#cb6-237"></a>$\mathsf{z}=(z_1,\dots,z_k)$, with correlation coefficients $\Sigma_{ij}=\rho_{ij}=\rho(Z_i,Z_j)$. Let $H(z_1,\dots,z_k)$ be their joint cumulative distribution function. Then</span>
<span id="cb6-238"><a href="#cb6-238"></a>$$</span>
<span id="cb6-239"><a href="#cb6-239"></a>C(u_1,\dots,u_k)=H(\Phi^{-1}(u_1),\dots,\Phi^{-1}(u_k))</span>
<span id="cb6-240"><a href="#cb6-240"></a>$$</span>
<span id="cb6-241"><a href="#cb6-241"></a>defines a multivariate uniform cumulative distribution function called the **normal copula**. Using $H$, the set of variables</span>
<span id="cb6-242"><a href="#cb6-242"></a>$$</span>
<span id="cb6-243"><a href="#cb6-243"></a>X_1=F_1^{-1}(\Phi(Z_1)),\dots,X_k=F_1^{-1}(\Phi(Z_k))</span>
<span id="cb6-244"><a href="#cb6-244"></a>$$ {#eq-ncm}</span>
<span id="cb6-245"><a href="#cb6-245"></a>have a joint cumulative function</span>
<span id="cb6-246"><a href="#cb6-246"></a>$$</span>
<span id="cb6-247"><a href="#cb6-247"></a>F_{X_1,\dots,X_k}(x_1,\dots,x_k)=H(\Phi^{-1}(F_x(u_1)),\dots,</span>
<span id="cb6-248"><a href="#cb6-248"></a>\Phi^{-1}(F_k(u_k))</span>
<span id="cb6-249"><a href="#cb6-249"></a>$$</span>
<span id="cb6-250"><a href="#cb6-250"></a>with marginal cumulative distribution functions $F_1,\dots,F_k$. The multivariate variables $(X_1,\dots,X_k)$ have Kendall's tau</span>
<span id="cb6-251"><a href="#cb6-251"></a>$$</span>
<span id="cb6-252"><a href="#cb6-252"></a>\tau(X_i,X_j)=\tau(Z_i,Z_j)=\frac{2}{\pi}\arcsin(\rho_{ij})</span>
<span id="cb6-253"><a href="#cb6-253"></a>$$</span>
<span id="cb6-254"><a href="#cb6-254"></a>and Spearman's rank correlation coefficients</span>
<span id="cb6-255"><a href="#cb6-255"></a>$$</span>
<span id="cb6-256"><a href="#cb6-256"></a>\text{rkCorr}(X_i,X_j)=\text{rkCorr}(Z_i,Z_j)=\frac{6}{\pi}\arcsin(\rho_{ij}/2)</span>
<span id="cb6-257"><a href="#cb6-257"></a>$$</span>
<span id="cb6-258"><a href="#cb6-258"></a>so $\rho$ can be adjusted to achieve the desired correlation.</span>
<span id="cb6-259"><a href="#cb6-259"></a></span>
<span id="cb6-260"><a href="#cb6-260"></a>In the normal copula method, we simulate from $H$ and then invert using @eq-ncm. In the Iman-Conover method with normal scores we produce a sample from $H$ such that $\Phi(z_i)$ are equally spaced between zero and one and then, rather than invert the distribution functions, we make the $j$th order statistic from the input sample correspond to $\Phi(z)=j/(n+1)$ where the input has $n$ observations. Because the $j$th order statistic of a sample of $n$ observations from a distribution $F$ approximates $F^{-1}(j/(n+1))$, we see the normal copula and Iman-Conover methods are doing essentially the same thing.</span>
<span id="cb6-261"><a href="#cb6-261"></a></span>
<span id="cb6-262"><a href="#cb6-262"></a>While the normal copula method and the Iman-Conover method are confusingly similar, there are some important differences to bear in mind. Comparing and contrasting the two methods should help clarify how the two algorithms are different.</span>
<span id="cb6-263"><a href="#cb6-263"></a></span>
<span id="cb6-264"><a href="#cb6-264"></a><span class="ss">1.  </span>@WangS1998 shows the normal copula method corresponds to the Iman-Conover method when the latter is computed using normal scores and the Choleski trick.</span>
<span id="cb6-265"><a href="#cb6-265"></a><span class="ss">2.  </span>The Iman-Conover method works on a given sample of marginal distributions. The normal copula method generates the sample by inverting the distribution function of each marginal as part of the simulation process.</span>
<span id="cb6-266"><a href="#cb6-266"></a><span class="ss">3.  </span>Through the use of scores, the Iman-Conover method relies on a sample of normal variables. The normal copula method could use a similar method, or it could sample randomly from the base normals. Conversely, a sample could be used in the Iman-Conover method.</span>
<span id="cb6-267"><a href="#cb6-267"></a><span class="ss">4.  </span>Only the Iman-Conover method has an adjustment to ensure that the reference multivariate distribution has exactly the required correlation structure.</span>
<span id="cb6-268"><a href="#cb6-268"></a><span class="ss">5.  </span>Iman-Conover method samples have rank correlation exactly equal to a sample from a reference distribution with the correct linear correlation. Normal copula samples have approximately correct linear and rank correlations.</span>
<span id="cb6-269"><a href="#cb6-269"></a><span class="ss">6.  </span>An Iman-Conover method sample must be taken in its entirety to be used correctly. The number of output points is fixed by the number of input points, and the sample is computed in its entirety in one step. Some Iman-Conover tools produce output, which is in a particular order. Thus, if you sample the $n$th observation from multiple simulations, or take the first $n$ samples, you will not get a random sample from the desired distribution. However, if you select random rows from multiple simulations (or, equivalently, if you randomly permute the rows' output prior to selecting the $n$th) then you will obtain the desired random sample. It is important to be aware of these issues before using canned software routines.</span>
<span id="cb6-270"><a href="#cb6-270"></a><span class="ss">7.  </span>The normal copula method produces simulations one at a time, and at each iteration the resulting sample is a sample from the required multivariate distribution. That is, output from the algorithm can be partitioned and used in pieces.</span>
<span id="cb6-271"><a href="#cb6-271"></a></span>
<span id="cb6-272"><a href="#cb6-272"></a>In summary, remember that these differences can have material, practical consequences, and it is important not to misuse Iman-Conover method samples.</span>
<span id="cb6-273"><a href="#cb6-273"></a></span>
<span id="cb6-274"><a href="#cb6-274"></a>\clearpage</span>
<span id="cb6-275"><a href="#cb6-275"></a></span>
<span id="cb6-276"><a href="#cb6-276"></a><span class="fu">### Block Iman-Conover (BIC)</span></span>
<span id="cb6-277"><a href="#cb6-277"></a></span>
<span id="cb6-278"><a href="#cb6-278"></a>The Iman-Conover method can lead you into a state of sin: the sin of thinking you can reliably estimate a $100 \times 100$ correlation matrix (or larger). You can't; don't try---it's all noise. Look at the distribution of eigenvalues to see; start by computing the SVD and compare your distribution with that of a random matrix. However, you might be able to say something about the correlation of chunks of your book. Generally (going back to premium is riskier than loss), lines that are underwritten together have correlated loss ratios, and properties that are nearby have correlated losses. The Block Iman-Conover (BIC) method is a way to use this information without fabricating large correlation matrices.</span>
<span id="cb6-279"><a href="#cb6-279"></a></span>
<span id="cb6-280"><a href="#cb6-280"></a><span class="fu">#### Description of BIC {#sec-bic}</span></span>
<span id="cb6-281"><a href="#cb6-281"></a></span>
<span id="cb6-282"><a href="#cb6-282"></a>BIC is best explained through an example. You underwrite auto liability, GL, and property in four regions: North, East, South, and West. Based on reliable studies, you have a sense of the loss (ratio) correlation between each line overall (a $3 \times 3$ matrix, with three parameters), and, separately, between the total regional results (a $4 \times 4$ matrix, with six parameters). The BIC produces a multivariate sample across all 12 line and region units that incorporates what you know, but using just these nine parameters rather than requiring 66 parameters (for a $12 \times 12$ matrix). Here's how it works. Pick a number of simulations $n$, then:</span>
<span id="cb6-283"><a href="#cb6-283"></a></span>
<span id="cb6-284"><a href="#cb6-284"></a><span class="ss">1.  </span>Produce four $n \times 3$ matrices with results by line for each region, $R_1$, $R_2$, $R_3$, $R_4$.</span>
<span id="cb6-285"><a href="#cb6-285"></a><span class="ss">2.  </span>Apply Iman-Conover to each $R_i$ separately using your $3\times 3$ between-line correlation matrix, to produce $\tilde R_i$.</span>
<span id="cb6-286"><a href="#cb6-286"></a><span class="ss">3.  </span>Sum across simulations in each $\tilde R_i$ to get total regional losses and assemble these into a $n\times 4$ matrix $T$.</span>
<span id="cb6-287"><a href="#cb6-287"></a><span class="ss">4.  </span>Apply Iman-Conover to $T$ using your $4\times 4$ between-region correlation matrix, and capture the ranking.</span>
<span id="cb6-288"><a href="#cb6-288"></a><span class="ss">5.  </span>Reorder each $\tilde R_i$ *by-row* according to the ranking in Step 4 to obtain $\tilde{\tilde R_i}$.</span>
<span id="cb6-289"><a href="#cb6-289"></a><span class="ss">6.  </span>Assemble $\tilde{\tilde R_i}$ together into a $n\times 12$ multivariate sample $X$.</span>
<span id="cb6-290"><a href="#cb6-290"></a></span>
<span id="cb6-291"><a href="#cb6-291"></a>The result of this algorithm has the correct by-line correlation within each region---because in step 5 rows are moved, which preserves their within-group correlation---and the correct correlation of total by region, from step 4.</span>
<span id="cb6-292"><a href="#cb6-292"></a></span>
<span id="cb6-293"><a href="#cb6-293"></a>The <span class="in">`aggregate`</span> package implements BIC as <span class="in">`block_iman_conover`</span>. It takes arguments:</span>
<span id="cb6-294"><a href="#cb6-294"></a></span>
<span id="cb6-295"><a href="#cb6-295"></a><span class="ss">-   </span><span class="in">`unit_losses`</span>: a list of samples, in our example the four blocks $R_i$ of losses by line within a region.</span>
<span id="cb6-296"><a href="#cb6-296"></a><span class="ss">-   </span><span class="in">`intra_unit_corrs`</span>: a list of correlation matrices within (intra) each region.</span>
<span id="cb6-297"><a href="#cb6-297"></a><span class="ss">-   </span><span class="in">`inter_unit_corr`</span>: the between (inter) unit correlation matrix.</span>
<span id="cb6-298"><a href="#cb6-298"></a></span>
<span id="cb6-299"><a href="#cb6-299"></a>The regions can have different numbers of lines, and the intra-correlation matrices can vary across regions. In the example below, we just use four regions with three lines, and we assume the intra-region by-line correlations are all the same.</span>
<span id="cb6-300"><a href="#cb6-300"></a></span>
<span id="cb6-301"><a href="#cb6-301"></a><span class="fu">### Example 2: Multistate, multiline correlation</span></span>
<span id="cb6-302"><a href="#cb6-302"></a></span>
<span id="cb6-303"><a href="#cb6-303"></a>Example 2 implements the case described in @sec-bic: four regions each with three lines, and reliably estimated correlation matrices between lines and between regions. The next block shows the specification of the regional loss distributions in DecL.</span>
<span id="cb6-304"><a href="#cb6-304"></a></span>
<span id="cb6-305"><a href="#cb6-305"></a><span class="in">``` python</span></span>
<span id="cb6-306"><a href="#cb6-306"></a>port North</span>
<span id="cb6-307"><a href="#cb6-307"></a>    agg Auto_North  <span class="dv">4000</span> loss  <span class="dv">2000</span> xs <span class="dv">0</span> sev lognorm  <span class="dv">30</span> cv <span class="dv">2</span> mixed gamma <span class="fl">.2</span></span>
<span id="cb6-308"><a href="#cb6-308"></a>    agg GL_North    <span class="dv">2000</span> loss  <span class="dv">5000</span> xs <span class="dv">0</span> sev lognorm  <span class="dv">50</span> cv <span class="dv">4</span> mixed gamma <span class="fl">.3</span></span>
<span id="cb6-309"><a href="#cb6-309"></a>    agg Prop_North  <span class="dv">2000</span> loss <span class="dv">10000</span> xs <span class="dv">0</span> sev lognorm <span class="dv">100</span> cv <span class="dv">5</span> mixed gamma <span class="fl">.1</span></span>
<span id="cb6-310"><a href="#cb6-310"></a></span>
<span id="cb6-311"><a href="#cb6-311"></a>port East</span>
<span id="cb6-312"><a href="#cb6-312"></a>    agg Auto_East     <span class="dv">3000</span> loss  <span class="dv">2000</span> xs <span class="dv">0</span> sev lognorm  <span class="dv">30</span> cv <span class="dv">2</span> mixed gamma <span class="fl">.2</span></span>
<span id="cb6-313"><a href="#cb6-313"></a>    agg GL_East       <span class="dv">1000</span> loss  <span class="dv">5000</span> xs <span class="dv">0</span> sev lognorm  <span class="dv">50</span> cv <span class="dv">4</span> mixed gamma <span class="fl">.3</span></span>
<span id="cb6-314"><a href="#cb6-314"></a>    agg Property_East <span class="dv">3000</span> loss <span class="dv">10000</span> xs <span class="dv">0</span> sev lognorm <span class="dv">100</span> cv <span class="dv">5</span> mixed gamma <span class="fl">.1</span></span>
<span id="cb6-315"><a href="#cb6-315"></a></span>
<span id="cb6-316"><a href="#cb6-316"></a>port West</span>
<span id="cb6-317"><a href="#cb6-317"></a>    agg Auto_West     <span class="dv">5000</span> loss  <span class="dv">2000</span> xs <span class="dv">0</span> sev lognorm  <span class="dv">30</span> cv <span class="dv">2</span> mixed gamma <span class="fl">.2</span></span>
<span id="cb6-318"><a href="#cb6-318"></a>    agg GL_West       <span class="dv">2000</span> loss  <span class="dv">5000</span> xs <span class="dv">0</span> sev lognorm  <span class="dv">50</span> cv <span class="dv">4</span> mixed gamma <span class="fl">.3</span></span>
<span id="cb6-319"><a href="#cb6-319"></a>    agg Property_West <span class="dv">2000</span> loss <span class="dv">10000</span> xs <span class="dv">0</span> sev lognorm <span class="dv">100</span> cv <span class="dv">5</span> mixed gamma <span class="fl">.1</span></span>
<span id="cb6-320"><a href="#cb6-320"></a></span>
<span id="cb6-321"><a href="#cb6-321"></a>port South</span>
<span id="cb6-322"><a href="#cb6-322"></a>    agg Auto_South   <span class="dv">5000</span> loss  <span class="dv">2000</span> xs <span class="dv">0</span> sev lognorm  <span class="dv">30</span> cv <span class="dv">2</span> mixed gamma <span class="fl">.2</span></span>
<span id="cb6-323"><a href="#cb6-323"></a>    agg GL_South     <span class="dv">2000</span> loss  <span class="dv">5000</span> xs <span class="dv">0</span> sev lognorm  <span class="dv">50</span> cv <span class="dv">4</span> mixed gamma <span class="fl">.3</span></span>
<span id="cb6-324"><a href="#cb6-324"></a>    agg Prop_South   <span class="dv">7000</span> loss <span class="dv">10000</span> xs <span class="dv">0</span> sev lognorm <span class="dv">100</span> cv <span class="dv">5</span> mixed gamma <span class="fl">.1</span></span>
<span id="cb6-325"><a href="#cb6-325"></a><span class="in">```</span></span>
<span id="cb6-326"><a href="#cb6-326"></a></span>
<span id="cb6-327"><a href="#cb6-327"></a>The losses by line are simulated using frequency-severity aggregate distributions with a lognormal severity and per occurrence limits. Frequency is a gamma-mixed Poisson (negative binomial) with varying CVs. See @Mildenhall2023a for a description of the <span class="in">`aggregate`</span> DecL language, used to specify these portfolios. The South region portfolio was previously used to illustrate the standard Iman-Conover method in @sec-example-1.</span>
<span id="cb6-328"><a href="#cb6-328"></a></span>
<span id="cb6-331"><a href="#cb6-331"></a><span class="in">```{python}</span></span>
<span id="cb6-332"><a href="#cb6-332"></a><span class="co">#| echo: false</span></span>
<span id="cb6-333"><a href="#cb6-333"></a><span class="co">#| label: lstx-bic-setup</span></span>
<span id="cb6-334"><a href="#cb6-334"></a><span class="co">#| code-cap: Setup `Portfolio` objects for BIC example.</span></span>
<span id="cb6-335"><a href="#cb6-335"></a></span>
<span id="cb6-336"><a href="#cb6-336"></a><span class="im">from</span> aggregate <span class="im">import</span> build, random_corr_matrix, block_iman_conover, set_seed</span>
<span id="cb6-337"><a href="#cb6-337"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb6-338"><a href="#cb6-338"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-339"><a href="#cb6-339"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb6-340"><a href="#cb6-340"></a><span class="im">from</span> pandas.plotting <span class="im">import</span> scatter_matrix</span>
<span id="cb6-341"><a href="#cb6-341"></a><span class="im">from</span> IPython.display <span class="im">import</span> display</span>
<span id="cb6-342"><a href="#cb6-342"></a></span>
<span id="cb6-343"><a href="#cb6-343"></a>region_N <span class="op">=</span> build(<span class="st">'''</span></span>
<span id="cb6-344"><a href="#cb6-344"></a><span class="st">port North</span></span>
<span id="cb6-345"><a href="#cb6-345"></a><span class="st">    agg Auto_North     4000 loss  2000 xs 0 sev lognorm  30 cv 2 mixed gamma .2</span></span>
<span id="cb6-346"><a href="#cb6-346"></a><span class="st">    agg GL_North       2000 loss  5000 xs 0 sev lognorm  50 cv 4 mixed gamma .3</span></span>
<span id="cb6-347"><a href="#cb6-347"></a><span class="st">    agg Property_North 2000 loss 10000 xs 0 sev lognorm 100 cv 5 mixed gamma .1</span></span>
<span id="cb6-348"><a href="#cb6-348"></a><span class="st">'''</span>)</span>
<span id="cb6-349"><a href="#cb6-349"></a></span>
<span id="cb6-350"><a href="#cb6-350"></a>region_E <span class="op">=</span> build(<span class="st">'''</span></span>
<span id="cb6-351"><a href="#cb6-351"></a><span class="st">port East</span></span>
<span id="cb6-352"><a href="#cb6-352"></a><span class="st">    agg Auto_East     3000 loss  2000 xs 0 sev lognorm  30 cv 2 mixed gamma .2</span></span>
<span id="cb6-353"><a href="#cb6-353"></a><span class="st">    agg GL_East       1000 loss  5000 xs 0 sev lognorm  50 cv 4 mixed gamma .3</span></span>
<span id="cb6-354"><a href="#cb6-354"></a><span class="st">    agg Property_East 3000 loss 10000 xs 0 sev lognorm 100 cv 5 mixed gamma .1</span></span>
<span id="cb6-355"><a href="#cb6-355"></a><span class="st">'''</span>)</span>
<span id="cb6-356"><a href="#cb6-356"></a></span>
<span id="cb6-357"><a href="#cb6-357"></a>region_W <span class="op">=</span> build(<span class="st">'''</span></span>
<span id="cb6-358"><a href="#cb6-358"></a><span class="st">port West</span></span>
<span id="cb6-359"><a href="#cb6-359"></a><span class="st">    agg Auto_West     5000 loss  2000 xs 0 sev lognorm  30 cv 2 mixed gamma .2</span></span>
<span id="cb6-360"><a href="#cb6-360"></a><span class="st">    agg GL_West       2000 loss  5000 xs 0 sev lognorm  50 cv 4 mixed gamma .3</span></span>
<span id="cb6-361"><a href="#cb6-361"></a><span class="st">    agg Property_West 2000 loss 10000 xs 0 sev lognorm 100 cv 5 mixed gamma .1</span></span>
<span id="cb6-362"><a href="#cb6-362"></a><span class="st">'''</span>)</span>
<span id="cb6-363"><a href="#cb6-363"></a></span>
<span id="cb6-364"><a href="#cb6-364"></a>region_S <span class="op">=</span> build(<span class="st">'''</span></span>
<span id="cb6-365"><a href="#cb6-365"></a><span class="st">port South</span></span>
<span id="cb6-366"><a href="#cb6-366"></a><span class="st">    agg Auto_South     5000 loss  2000 xs 0 sev lognorm  30 cv 2 mixed gamma .2</span></span>
<span id="cb6-367"><a href="#cb6-367"></a><span class="st">    agg GL_South       2000 loss  5000 xs 0 sev lognorm  50 cv 4 mixed gamma .3</span></span>
<span id="cb6-368"><a href="#cb6-368"></a><span class="st">    agg Property_South 7000 loss 10000 xs 0 sev lognorm 100 cv 5 mixed gamma .1</span></span>
<span id="cb6-369"><a href="#cb6-369"></a><span class="st">'''</span>)</span>
<span id="cb6-370"><a href="#cb6-370"></a></span>
<span id="cb6-371"><a href="#cb6-371"></a>portfolio <span class="op">=</span> [region_N, region_E, region_S, region_W]</span>
<span id="cb6-372"><a href="#cb6-372"></a><span class="in">```</span></span>
<span id="cb6-373"><a href="#cb6-373"></a></span>
<span id="cb6-374"><a href="#cb6-374"></a>@tbl-bic-stats <span class="co">&lt;!--# In Table 8.4, the entry for North is formatted differently from the other entries. Please update from 8000.0 to 8,000 to match the rest of the table data. --&gt;</span>shows the expected losses, modeling error, CV, and 99th percentile of total loss by region. Model error means the difference between the output of the Fast Fourier Transform algorithm and the requested input mean losses. As you can see, the two are almost identical. The CVs vary reflecting volume and mix of business between regions.</span>
<span id="cb6-375"><a href="#cb6-375"></a></span>
<span id="cb6-378"><a href="#cb6-378"></a><span class="in">```{python}</span></span>
<span id="cb6-379"><a href="#cb6-379"></a><span class="co">#| echo: false</span></span>
<span id="cb6-380"><a href="#cb6-380"></a><span class="co">#| label: tbl-bic-stats</span></span>
<span id="cb6-381"><a href="#cb6-381"></a><span class="co">#| tbl-cap: Expected losses, CV, and 99th percentile loss by region.</span></span>
<span id="cb6-382"><a href="#cb6-382"></a></span>
<span id="cb6-383"><a href="#cb6-383"></a>bit <span class="op">=</span> pd.DataFrame(</span>
<span id="cb6-384"><a href="#cb6-384"></a>    {<span class="st">'Region'</span>: [i.name <span class="cf">for</span> i <span class="kw">in</span> portfolio],</span>
<span id="cb6-385"><a href="#cb6-385"></a>     <span class="st">'Expected loss'</span>: [i.agg_m <span class="cf">for</span> i <span class="kw">in</span> portfolio],</span>
<span id="cb6-386"><a href="#cb6-386"></a>     <span class="st">'Model Error'</span>: [i.est_m <span class="op">/</span> i.agg_m <span class="op">-</span> <span class="dv">1</span> <span class="cf">for</span> i <span class="kw">in</span> portfolio],</span>
<span id="cb6-387"><a href="#cb6-387"></a>     <span class="st">'CV'</span>: [i.agg_cv <span class="cf">for</span> i <span class="kw">in</span> portfolio],</span>
<span id="cb6-388"><a href="#cb6-388"></a>     <span class="st">'99th percentile'</span>: [i.q(<span class="fl">0.99</span>) <span class="cf">for</span> i <span class="kw">in</span> portfolio]})</span>
<span id="cb6-389"><a href="#cb6-389"></a>bit <span class="op">=</span> bit.set_index(<span class="st">'Region'</span>)</span>
<span id="cb6-390"><a href="#cb6-390"></a>fGT(bit)</span>
<span id="cb6-391"><a href="#cb6-391"></a><span class="in">```</span></span>
<span id="cb6-392"><a href="#cb6-392"></a></span>
<span id="cb6-393"><a href="#cb6-393"></a>Next, we sample $n=1000$ losses from each region with the intraregion correlation. In this case, all the intraregion by-line correlations are the same, but the method allows them to vary.</span>
<span id="cb6-394"><a href="#cb6-394"></a></span>
<span id="cb6-397"><a href="#cb6-397"></a><span class="in">```{python}</span></span>
<span id="cb6-398"><a href="#cb6-398"></a><span class="co">#| echo: false</span></span>
<span id="cb6-399"><a href="#cb6-399"></a><span class="co">#| label: lstx-bic-loss-corr</span></span>
<span id="cb6-400"><a href="#cb6-400"></a><span class="co">#| code-cap: Sample marginals and specify within (intra) and between (inter) regional correlation matrices.</span></span>
<span id="cb6-401"><a href="#cb6-401"></a></span>
<span id="cb6-402"><a href="#cb6-402"></a>n <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb6-403"><a href="#cb6-403"></a>set_seed(<span class="dv">42</span>)</span>
<span id="cb6-404"><a href="#cb6-404"></a>region_losses <span class="op">=</span> [region.sample(n, desired_correlation<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb6-405"><a href="#cb6-405"></a>                    keep_total<span class="op">=</span><span class="va">False</span>).to_numpy() <span class="cf">for</span> region <span class="kw">in</span> portfolio]</span>
<span id="cb6-406"><a href="#cb6-406"></a></span>
<span id="cb6-407"><a href="#cb6-407"></a>cm <span class="op">=</span> np.array([[<span class="dv">1</span>, <span class="fl">.6</span>, <span class="fl">.2</span>],</span>
<span id="cb6-408"><a href="#cb6-408"></a>               [<span class="fl">.6</span>, <span class="dv">1</span>, <span class="fl">.4</span>],</span>
<span id="cb6-409"><a href="#cb6-409"></a>               [<span class="fl">.2</span>, <span class="fl">.4</span>, <span class="dv">1</span>]])</span>
<span id="cb6-410"><a href="#cb6-410"></a>intra_region_correl <span class="op">=</span> [cm] <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb6-411"><a href="#cb6-411"></a></span>
<span id="cb6-412"><a href="#cb6-412"></a><span class="co"># N E S W</span></span>
<span id="cb6-413"><a href="#cb6-413"></a>inter_region_correl <span class="op">=</span> np.array(</span>
<span id="cb6-414"><a href="#cb6-414"></a>       [[<span class="fl">1.</span>        , <span class="fl">0.7</span>       , <span class="fl">0.2</span>       , <span class="fl">0.</span>        ],</span>
<span id="cb6-415"><a href="#cb6-415"></a>        [<span class="fl">0.7</span>       , <span class="fl">1.</span>        , <span class="fl">0.4</span>       , <span class="fl">0.2</span>       ],</span>
<span id="cb6-416"><a href="#cb6-416"></a>        [<span class="fl">0.2</span>       , <span class="fl">0.4</span>       , <span class="fl">1.</span>        , <span class="fl">0.8</span>       ],</span>
<span id="cb6-417"><a href="#cb6-417"></a>        [<span class="fl">0.</span>        , <span class="fl">0.2</span>       , <span class="fl">0.8</span>       , <span class="fl">1.</span>        ]])</span>
<span id="cb6-418"><a href="#cb6-418"></a><span class="in">```</span></span>
<span id="cb6-419"><a href="#cb6-419"></a></span>
<span id="cb6-422"><a href="#cb6-422"></a><span class="in">```{python}</span></span>
<span id="cb6-423"><a href="#cb6-423"></a><span class="co">#| echo: false</span></span>
<span id="cb6-424"><a href="#cb6-424"></a><span class="co">#| label: lstx-bic-run</span></span>
<span id="cb6-425"><a href="#cb6-425"></a><span class="co">#| code-cap: Call `block_iman_conver` routine and assemble output dataframes.</span></span>
<span id="cb6-426"><a href="#cb6-426"></a></span>
<span id="cb6-427"><a href="#cb6-427"></a>ans <span class="op">=</span> block_iman_conover(region_losses, intra_region_correl, inter_region_correl, <span class="va">True</span>)</span>
<span id="cb6-428"><a href="#cb6-428"></a>total_df <span class="op">=</span> pd.DataFrame(ans.totals.T, columns<span class="op">=</span>[i.name <span class="cf">for</span> i <span class="kw">in</span> portfolio])</span>
<span id="cb6-429"><a href="#cb6-429"></a>unit_df <span class="op">=</span> pd.DataFrame(ans.combined, columns<span class="op">=</span>[j <span class="cf">for</span> i <span class="kw">in</span> portfolio <span class="cf">for</span> j <span class="kw">in</span> i.unit_names])</span>
<span id="cb6-430"><a href="#cb6-430"></a><span class="in">```</span></span>
<span id="cb6-431"><a href="#cb6-431"></a></span>
<span id="cb6-432"><a href="#cb6-432"></a>The BIC is then run using:</span>
<span id="cb6-433"><a href="#cb6-433"></a></span>
<span id="cb6-434"><a href="#cb6-434"></a><span class="in">``` python</span></span>
<span id="cb6-435"><a href="#cb6-435"></a>ans <span class="op">=</span> block_iman_conover(region_losses, intra_region_correl, inter_region_correl, <span class="va">True</span>)</span>
<span id="cb6-436"><a href="#cb6-436"></a><span class="in">```</span></span>
<span id="cb6-437"><a href="#cb6-437"></a></span>
<span id="cb6-438"><a href="#cb6-438"></a>The three panels of @tbl-bic-inter-corr (respectively, @tbl-bic-intra-corr) show the target and achieved inter-region (respectively, intraregion) correlation and the error (difference). The achieved results are very close to those desired.</span>
<span id="cb6-439"><a href="#cb6-439"></a></span>
<span id="cb6-442"><a href="#cb6-442"></a><span class="in">```{python}</span></span>
<span id="cb6-443"><a href="#cb6-443"></a><span class="co">#| echo: false</span></span>
<span id="cb6-444"><a href="#cb6-444"></a><span class="co">#| label: tbl-bic-inter-corr</span></span>
<span id="cb6-445"><a href="#cb6-445"></a><span class="co">#| tbl-cap: Target and achieved inter-region correlations.</span></span>
<span id="cb6-446"><a href="#cb6-446"></a><span class="co">#| layout-ncol: 1</span></span>
<span id="cb6-447"><a href="#cb6-447"></a><span class="co">#| tbl-subcap: [Target inter-region correlation, Achieved inter-region correlation, Difference]</span></span>
<span id="cb6-448"><a href="#cb6-448"></a></span>
<span id="cb6-449"><a href="#cb6-449"></a>total_corr <span class="op">=</span> total_df.corr()</span>
<span id="cb6-450"><a href="#cb6-450"></a>target_corr <span class="op">=</span> pd.DataFrame(inter_region_correl,</span>
<span id="cb6-451"><a href="#cb6-451"></a>                            index<span class="op">=</span>total_corr.index,</span>
<span id="cb6-452"><a href="#cb6-452"></a>                            columns<span class="op">=</span>total_corr.index)</span>
<span id="cb6-453"><a href="#cb6-453"></a><span class="co">#target_intra_corr = pd.DataFrame(cm,</span></span>
<span id="cb6-454"><a href="#cb6-454"></a><span class="co">#                            index=['Auto', 'GL', 'Property'],</span></span>
<span id="cb6-455"><a href="#cb6-455"></a><span class="co">#                            columns=['Auto', 'GL', 'Property'])</span></span>
<span id="cb6-456"><a href="#cb6-456"></a><span class="co">#display(fGT(target_intra_corr))</span></span>
<span id="cb6-457"><a href="#cb6-457"></a>display(fGT(target_corr))</span>
<span id="cb6-458"><a href="#cb6-458"></a>display(fGT(total_corr))</span>
<span id="cb6-459"><a href="#cb6-459"></a>display(fGT((target_corr <span class="op">-</span> total_corr)))</span>
<span id="cb6-460"><a href="#cb6-460"></a><span class="in">```</span></span>
<span id="cb6-461"><a href="#cb6-461"></a></span>
<span id="cb6-464"><a href="#cb6-464"></a><span class="in">```{python}</span></span>
<span id="cb6-465"><a href="#cb6-465"></a><span class="co">#| echo: false</span></span>
<span id="cb6-466"><a href="#cb6-466"></a><span class="co">#| label: tbl-bic-intra-corr</span></span>
<span id="cb6-467"><a href="#cb6-467"></a><span class="co">#| tbl-cap: Achieved (a-d) and target (e) intra-region correlation.</span></span>
<span id="cb6-468"><a href="#cb6-468"></a><span class="co">#| layout-ncol: 1</span></span>
<span id="cb6-469"><a href="#cb6-469"></a><span class="co">#| tbl-subcap: [North, East, South, West, Target]</span></span>
<span id="cb6-470"><a href="#cb6-470"></a></span>
<span id="cb6-471"><a href="#cb6-471"></a><span class="kw">def</span> renamer(x):</span>
<span id="cb6-472"><a href="#cb6-472"></a>    <span class="co">"""Shorten unit/region name"""</span></span>
<span id="cb6-473"><a href="#cb6-473"></a>    x <span class="op">=</span> x.replace(<span class="st">'Auto'</span>, <span class="st">'AL'</span>).replace(<span class="st">'Property'</span>, <span class="st">'Pr'</span>).<span class="op">\</span></span>
<span id="cb6-474"><a href="#cb6-474"></a>    replace(<span class="st">'_North'</span>, <span class="st">' N'</span>).replace(<span class="st">'_East'</span>, <span class="st">' E'</span>).<span class="op">\</span></span>
<span id="cb6-475"><a href="#cb6-475"></a>    replace(<span class="st">'_South'</span>, <span class="st">' S'</span>).replace(<span class="st">'_West'</span>, <span class="st">' W'</span>)</span>
<span id="cb6-476"><a href="#cb6-476"></a>    x <span class="op">=</span> <span class="st">'-'</span>.join(x.split(<span class="st">' '</span>)[::<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb6-477"><a href="#cb6-477"></a>    <span class="cf">return</span> x</span>
<span id="cb6-478"><a href="#cb6-478"></a></span>
<span id="cb6-479"><a href="#cb6-479"></a><span class="cf">for</span> r <span class="kw">in</span> [<span class="st">'North'</span>, <span class="st">'East'</span>, <span class="st">'South'</span>, <span class="st">'West'</span>]:</span>
<span id="cb6-480"><a href="#cb6-480"></a>    _ <span class="op">=</span> unit_df.<span class="bu">filter</span>(regex<span class="op">=</span><span class="ss">f'.*_</span><span class="sc">{</span>r<span class="sc">}</span><span class="ss">'</span>).corr().rename(columns<span class="op">=</span>renamer, index<span class="op">=</span>renamer)</span>
<span id="cb6-481"><a href="#cb6-481"></a>    display(fGT(_))</span>
<span id="cb6-482"><a href="#cb6-482"></a></span>
<span id="cb6-483"><a href="#cb6-483"></a>target_corr <span class="op">=</span> pd.DataFrame(intra_region_correl[<span class="dv">0</span>], index<span class="op">=</span>_.index, columns<span class="op">=</span>_.index)</span>
<span id="cb6-484"><a href="#cb6-484"></a>display(fGT(target_corr))</span>
<span id="cb6-485"><a href="#cb6-485"></a><span class="in">```</span></span>
<span id="cb6-486"><a href="#cb6-486"></a></span>
<span id="cb6-487"><a href="#cb6-487"></a>@tbl-bic-all-corr shows the overall correlation matrix at the line-region level (12 x 12 matrix), and @fig-bic-intra-corr shows an image plot of the same matrix. The underlying block structure is clear from the image. <span class="co">&lt;!--# Please note error message in PDF about table format. --&gt;</span></span>
<span id="cb6-488"><a href="#cb6-488"></a></span>
<span id="cb6-491"><a href="#cb6-491"></a><span class="in">```{python}</span></span>
<span id="cb6-492"><a href="#cb6-492"></a><span class="co">#| echo: false</span></span>
<span id="cb6-493"><a href="#cb6-493"></a><span class="co">#| label: tbl-bic-all-corr</span></span>
<span id="cb6-494"><a href="#cb6-494"></a><span class="co">#| tbl-cap: Achieved correlation across lines and regions.</span></span>
<span id="cb6-495"><a href="#cb6-495"></a></span>
<span id="cb6-496"><a href="#cb6-496"></a>nGT(unit_df.corr().rename(columns<span class="op">=</span>renamer, index<span class="op">=</span>renamer),</span>
<span id="cb6-497"><a href="#cb6-497"></a>    tikz_scale<span class="op">=</span><span class="fl">0.65</span>, max_table_inch_width<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb6-498"><a href="#cb6-498"></a><span class="in">```</span></span>
<span id="cb6-499"><a href="#cb6-499"></a></span>
<span id="cb6-502"><a href="#cb6-502"></a><span class="in">```{python}</span></span>
<span id="cb6-503"><a href="#cb6-503"></a><span class="co">#| echo: false</span></span>
<span id="cb6-504"><a href="#cb6-504"></a><span class="co">#| label: fig-bic-intra-corr</span></span>
<span id="cb6-505"><a href="#cb6-505"></a><span class="co">#| fig-cap: Image plot of achieved intra-region correlation. The block structure is clearly evident.</span></span>
<span id="cb6-506"><a href="#cb6-506"></a></span>
<span id="cb6-507"><a href="#cb6-507"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="fl">4.0</span>, <span class="fl">4.0</span>), constrained_layout<span class="op">=</span><span class="va">True</span>, squeeze<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-508"><a href="#cb6-508"></a></span>
<span id="cb6-509"><a href="#cb6-509"></a>cm <span class="op">=</span> unit_df.corr()</span>
<span id="cb6-510"><a href="#cb6-510"></a>cm <span class="op">=</span> cm.replace(<span class="dv">1</span>, np.nan)</span>
<span id="cb6-511"><a href="#cb6-511"></a>i <span class="op">=</span> ax.imshow(cm, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb6-512"><a href="#cb6-512"></a>plt.colorbar(i, shrink<span class="op">=</span><span class="fl">.5</span>)</span>
<span id="cb6-513"><a href="#cb6-513"></a></span>
<span id="cb6-514"><a href="#cb6-514"></a><span class="co"># Get the column names from your dataframe</span></span>
<span id="cb6-515"><a href="#cb6-515"></a>labels <span class="op">=</span> [<span class="st">' - '</span>.join(i.split(<span class="st">'_'</span>)[::<span class="op">-</span><span class="dv">1</span>]) <span class="cf">for</span> i <span class="kw">in</span> unit_df.columns]</span>
<span id="cb6-516"><a href="#cb6-516"></a></span>
<span id="cb6-517"><a href="#cb6-517"></a><span class="co"># Set the ticks and labels</span></span>
<span id="cb6-518"><a href="#cb6-518"></a>ax.set_xticks(<span class="bu">range</span>(<span class="bu">len</span>(labels)))</span>
<span id="cb6-519"><a href="#cb6-519"></a>ax.set_yticks(<span class="bu">range</span>(<span class="bu">len</span>(labels)))</span>
<span id="cb6-520"><a href="#cb6-520"></a>ax.set_xticklabels(labels)</span>
<span id="cb6-521"><a href="#cb6-521"></a>ax.set_yticklabels(labels)</span>
<span id="cb6-522"><a href="#cb6-522"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">'right'</span>)<span class="op">;</span></span>
<span id="cb6-523"><a href="#cb6-523"></a><span class="in">```</span></span>
<span id="cb6-524"><a href="#cb6-524"></a></span>
<span id="cb6-525"><a href="#cb6-525"></a>\clearpage</span>
<span id="cb6-526"><a href="#cb6-526"></a></span>
<span id="cb6-527"><a href="#cb6-527"></a><span class="fu">### Theoretical derivation of the Iman-Conover method</span></span>
<span id="cb6-528"><a href="#cb6-528"></a></span>
<span id="cb6-529"><a href="#cb6-529"></a>Suppose that $\mathsf{M}$ is an $n$ element sample from an $r$ dimensional multivariate distribution, so $\mathsf{M}$ is an $n\times r$ matrix. Assume that the columns of $\mathsf{M}$ are uncorrelated, have mean zero, and have a standard deviation of one. Let $\mathsf{M}'$ denote the transpose of $\mathsf{M}$. These assumptions imply that the correlation matrix of the sample $\mathsf{M}$ can be computed as $n^{-1}\mathsf{M}'\mathsf{M}$, and because the columns are independent, $n^{-1}\mathsf{M}'\mathsf{M}=\mathsf{id}$. (There is no need to scale the covariance matrix by the row and column standard deviations because they are all one. In general $n^{-1}\mathsf{M}'\mathsf{M}$ is the covariance matrix of $\mathsf{M}$.)</span>
<span id="cb6-530"><a href="#cb6-530"></a></span>
<span id="cb6-531"><a href="#cb6-531"></a>Let $\mathsf{S}$ be a correlation matrix, i.e., $\mathsf{S}$ is a positive semidefinite symmetric matrix with ones on the diagonal and all elements $\le 1$ in absolute value. In order to rule out linearly dependent variables, assume $\mathsf{S}$ is positive definite. These assumptions ensure $\mathsf{S}$ has a Choleski decomposition</span>
<span id="cb6-532"><a href="#cb6-532"></a>$$</span>
<span id="cb6-533"><a href="#cb6-533"></a>\mathsf{S}=\mathsf{C}'\mathsf{C}</span>
<span id="cb6-534"><a href="#cb6-534"></a>$$</span>
<span id="cb6-535"><a href="#cb6-535"></a>for some upper triangular matrix $\mathsf{C}$, see @Golub2013bk or @Press1992a. Set $\mathsf{T}=\mathsf{M}\mathsf{C}$. The columns of $\mathsf{T}$ still have mean zero, because they are linear combinations of the columns of $\mathsf{M}$, which have zero mean by assumption. It is less obvious, but still true, that the columns of $\mathsf{T}$ still have standard deviation one. To see why, remember that the covariance matrix of $\mathsf{T}$ is</span>
<span id="cb6-536"><a href="#cb6-536"></a>$$</span>
<span id="cb6-537"><a href="#cb6-537"></a>n^{-1}\mathsf{T}'\mathsf{T}=n^{-1}\mathsf{C}'\mathsf{M}'\mathsf{M}\mathsf{C}=\mathsf{C}'\mathsf{C}=\mathsf{S},</span>
<span id="cb6-538"><a href="#cb6-538"></a>$$ {#eq-coolA}</span>
<span id="cb6-539"><a href="#cb6-539"></a>since $n^{-1}\mathsf{M}'\mathsf{M}=\mathsf{id}$ is the identity by assumption. Now $\mathsf{S}$ also is actually the correlation matrix because the diagonal is scaled to standard deviation one, so the covariance and correlation matrices coincide. The process of converting $\mathsf{M}$, which is easy to simulate, into $\mathsf{T}$, which has the desired correlation structure $\mathsf{S}$, is the theoretical basis of the Iman-Conover method.</span>
<span id="cb6-540"><a href="#cb6-540"></a></span>
<span id="cb6-541"><a href="#cb6-541"></a>It is important to note that estimates of correlation matrices, depending on how they are constructed, need not have the mathematical properties of a correlation matrix. Therefore, when trying to use an estimate of a correlation matrix in an algorithm, such as the Iman-Conover, which actually requires a proper correlation matrix as input, it may be necessary to check the input matrix does have the correct mathematical properties.</span>
<span id="cb6-542"><a href="#cb6-542"></a></span>
<span id="cb6-543"><a href="#cb6-543"></a>Next, we discuss how to make $n\times r$ matrices $\mathsf{M}$, with independent, mean zero columns. The basic idea is to take $n$ numbers $a_1,\dots,a_n$ with $\sum_i a_i=0$ and $n^{-1}\sum_i a_i^2=1$, use them to form one $n\times 1$ column of $\mathsf{M}$, and then to copy it $r$ times. Finally, randomly permute the entries in each column to make them independent as columns of random variables. Iman and Conover call these $a_i$ scores. They discuss several possible definitions for scores, including scaled versions of $a_i=i$ (ranks) and $a_i$ uniformly distributed. They note that the shape of the output multivariate distribution depends on the scores. All of the examples in their paper use normal scores.</span>
<span id="cb6-544"><a href="#cb6-544"></a></span>
<span id="cb6-545"><a href="#cb6-545"></a>Given that the scores will be based on normal random variables, we can either simulate $n$ random standard normal variables and then shift and rescale to ensure mean zero and standard deviation one, or we can use a systematic sample from the standard normal, $a_i=\Phi^{-1}(i/(n+1))$. By construction, the systematic sample has mean zero, which is an advantage. Also, by symmetry, using the systematic sample halves the number of calls to $\Phi^{-1}$. For these two reasons we prefer it in the algorithm below. <span class="co">&lt;!-- https://quillbot.com/blog/frequently-asked-questions/whats-the-difference-between-stratified-and-systematic-sampling/ --&gt;</span></span>
<span id="cb6-546"><a href="#cb6-546"></a></span>
<span id="cb6-547"><a href="#cb6-547"></a>The correlation matrix of $\mathsf{M}$, constructed by randomly permuting the scores in each column, will only be approximately equal to $\mathsf{id}$ because of random simulation error. In order to correct for the slight error which could be introduced, Iman and Conover use another adjustment in their algorithm. Let $\mathsf{EE}=n^{-1}\mathsf{M}'\mathsf{M}$ be the actual correlation matrix of $\mathsf{M}$, and let $\mathsf{EE}=\mathsf{F}'\mathsf{F}$ be the Choleski decomposition of $\mathsf{EE}$, and define $\mathsf{T}=\mathsf{M}\mathsf{F}^{-1}\mathsf{C}$. The columns of $\mathsf{T}$ have mean zero, and the covariance matrix of $\mathsf{T}$ is</span>
<span id="cb6-548"><a href="#cb6-548"></a>$$</span>
<span id="cb6-549"><a href="#cb6-549"></a>\begin{aligned}</span>
<span id="cb6-550"><a href="#cb6-550"></a>n^{-1}\mathsf{T}'\mathsf{T} &amp;= n^{-1}\mathsf{C}'\mathsf{F}'^{-1}\mathsf{M}'\mathsf{M}\mathsf{F}^{-1}\mathsf{C} \notag  <span class="sc">\\</span></span>
<span id="cb6-551"><a href="#cb6-551"></a>&amp;= \mathsf{C}'\mathsf{F}'^{-1}\mathsf{EE}\mathsf{F}^{-1}\mathsf{C} \notag   <span class="sc">\\</span></span>
<span id="cb6-552"><a href="#cb6-552"></a>&amp;= \mathsf{C}'\mathsf{F}'^{-1}\mathsf{F}'\mathsf{F}\mathsf{F}^{-1}\mathsf{C} \notag  <span class="sc">\\</span></span>
<span id="cb6-553"><a href="#cb6-553"></a>&amp;= \mathsf{C}' \mathsf{C} \notag  <span class="sc">\\</span></span>
<span id="cb6-554"><a href="#cb6-554"></a>&amp;= \mathsf{S}</span>
<span id="cb6-555"><a href="#cb6-555"></a>\end{aligned}</span>
<span id="cb6-556"><a href="#cb6-556"></a>$$</span>
<span id="cb6-557"><a href="#cb6-557"></a>and hence $\mathsf{T}$ has correlation matrix exactly equal to $\mathsf{S}$, as desired. If $\mathsf{EE}$ is singular, then the column shuffle needs to be repeated.</span>
<span id="cb6-558"><a href="#cb6-558"></a></span>
<span id="cb6-559"><a href="#cb6-559"></a>Now that the reference distribution $\mathsf{T}$ with exact correlation structure $\mathsf{S}$ is in hand, all that remains to complete the Iman-Conover method is to reorder each column of the input distribution $\mathsf{X}$ to have the same rank order as the corresponding column of $\mathsf{T}$.</span>
<span id="cb6-560"><a href="#cb6-560"></a></span>
<span id="cb6-561"><a href="#cb6-561"></a><span class="fu">## Allocating capital, if you must {#sec-Allocating-Capital}</span></span>
<span id="cb6-562"><a href="#cb6-562"></a></span>
<span id="cb6-563"><a href="#cb6-563"></a>*Within each layer, we can allocate its expected losses and premiums to the various portfolio units. Having done so, capital allocation to units follows.*</span>
<span id="cb6-564"><a href="#cb6-564"></a></span>
<span id="cb6-565"><a href="#cb6-565"></a>**Admonition.** We can't emphasize strongly enough that you **should not allocate capital**. Different layers of capital do not have the same cost (think: equity, junk debt, government bonds), therefore you do not know the appropriate target return on your allocated capital. Without that, you can't say if a projected return is good or bad. Allocate margin, not capital!</span>
<span id="cb6-566"><a href="#cb6-566"></a></span>
<span id="cb6-567"><a href="#cb6-567"></a>Warnings about smoking don't work either. We know your CFO, senior management, and investors discuss allocating underwriting capacity in the language of allocating capital, and we previously admonished you to speak the language of your customers. This section describes two methods you can use to translate allocated margins into allocated capital.</span>
<span id="cb6-568"><a href="#cb6-568"></a></span>
<span id="cb6-569"><a href="#cb6-569"></a>The first method is obvious: simply assume all capital earns the weighted average cost of capital and allocate capital by dividing allocated margin by the weighted average cost of capital. This will result in an additive allocation of capital. This has the advantage of being simple to implement, but the disadvantage is that it obscures---nay, denies!---the fact that different segments of capital earn different returns.</span>
<span id="cb6-570"><a href="#cb6-570"></a></span>
<span id="cb6-571"><a href="#cb6-571"></a>The second method has a more theoretically sound basis. It applies the principles discussed in @sec-Pricing-Allocation to obtain an allocation of capital $Q$ and unit-specific rates of return $\iota^i$ consistent with the SRM approach.</span>
<span id="cb6-572"><a href="#cb6-572"></a></span>
<span id="cb6-573"><a href="#cb6-573"></a>Layer $k$ is $\Delta X_k$ dollars wide but is triggered by any portfolio loss $X &gt; X_k$. We propose that the expectation of that loss be allocated to units by equal priority, that is, in proportion to the expected losses of the units *in those triggering events*. We may define the layer-$k$ **expected loss share** to unit $i$ as</span>
<span id="cb6-574"><a href="#cb6-574"></a>$$</span>
<span id="cb6-575"><a href="#cb6-575"></a>\alpha_k^i := \mathsf E_p\left<span class="co">[</span><span class="ot">\frac{X^i}{X}\mid X &gt; X_k\right</span><span class="co">]</span>.</span>
<span id="cb6-576"><a href="#cb6-576"></a>$$</span>
<span id="cb6-577"><a href="#cb6-577"></a>In particular, this means</span>
<span id="cb6-578"><a href="#cb6-578"></a>$$</span>
<span id="cb6-579"><a href="#cb6-579"></a>\alpha_k^i S_k = \mathsf E_p\left<span class="co">[</span><span class="ot">\frac{X^i}{X}1_{\mid X &gt; X_k}\right</span><span class="co">]</span> = \sum_{j&gt;k}\frac{X_j^i}{X_j}p_j.</span>
<span id="cb6-580"><a href="#cb6-580"></a>$$ {#eq-alpha-k-i}</span>
<span id="cb6-581"><a href="#cb6-581"></a>The $\alpha^i$ sum to one across the units because (conditional) expectations are linear. The expected loss to layer $k$, $S_k\Delta X_k$, can thus be partitioned into $\alpha_k^i S_k\Delta X_k$ across the various units. The total portfolio loss, $\mathsf E<span class="co">[</span><span class="ot">X</span><span class="co">]</span>$, is allocated to unit $i$ as</span>
<span id="cb6-582"><a href="#cb6-582"></a>$$</span>
<span id="cb6-583"><a href="#cb6-583"></a>\mathsf E<span class="co">[</span><span class="ot">X^i</span><span class="co">]</span> = \sum_j \alpha_j^i S_j\Delta X_j.</span>
<span id="cb6-584"><a href="#cb6-584"></a>$$ {#eq-alpha-k-ii}</span>
<span id="cb6-585"><a href="#cb6-585"></a></span>
<span id="cb6-586"><a href="#cb6-586"></a>**Exercise.** Prove @eq-alpha-k-ii, given @eq-alpha-k-i.</span>
<span id="cb6-587"><a href="#cb6-587"></a></span>
<span id="cb6-588"><a href="#cb6-588"></a>**Solution.**</span>
<span id="cb6-589"><a href="#cb6-589"></a>$$</span>
<span id="cb6-590"><a href="#cb6-590"></a>\begin{aligned}</span>
<span id="cb6-591"><a href="#cb6-591"></a>\sum_j \alpha_j^i S_j\Delta X_j &amp;= \sum_{k=0}^{n-1} \left(\sum_{j=k+1}^{n}\frac{X_j^i}{X_j} p_j  \right)(X_{k+1}-X_k) <span class="sc">\\</span></span>
<span id="cb6-592"><a href="#cb6-592"></a>&amp;=\sum_{j=1}^n \frac{X_j^i}{X_j} p_j\sum_{k=0}^{j-1} (X_{k+1}-X_{k}) <span class="sc">\\</span></span>
<span id="cb6-593"><a href="#cb6-593"></a>&amp;=\sum_{j=1}^n \frac{X_j^i}{X_j} p_j X_j <span class="sc">\\</span></span>
<span id="cb6-594"><a href="#cb6-594"></a>&amp;=\sum_{j=1}^n X_j^i p_j <span class="sc">\\</span></span>
<span id="cb6-595"><a href="#cb6-595"></a>&amp;= \mathsf E<span class="co">[</span><span class="ot">X^i</span><span class="co">]</span></span>
<span id="cb6-596"><a href="#cb6-596"></a>\end{aligned}</span>
<span id="cb6-597"><a href="#cb6-597"></a>$$</span>
<span id="cb6-598"><a href="#cb6-598"></a>noting $X_0=X_0^i=0$. \qed</span>
<span id="cb6-599"><a href="#cb6-599"></a></span>
<span id="cb6-600"><a href="#cb6-600"></a>What about premium? We propose that the premium associated with layer $k$ be allocated to units in proportion to the *distorted* expected losses of the units in those triggering events. This leads to the definition of the **distorted expected loss share**</span>
<span id="cb6-601"><a href="#cb6-601"></a>$$</span>
<span id="cb6-602"><a href="#cb6-602"></a>\beta_k^i := \mathsf E_q\left<span class="co">[</span><span class="ot">\frac{X^i}{X}\mid X &gt; X_k\right</span><span class="co">]</span></span>
<span id="cb6-603"><a href="#cb6-603"></a>$$</span>
<span id="cb6-604"><a href="#cb6-604"></a>In particular, this means</span>
<span id="cb6-605"><a href="#cb6-605"></a>$$</span>
<span id="cb6-606"><a href="#cb6-606"></a>\beta_k^i g(S_k) = \sum_{j&gt;k}\frac{X_j^i}{X_j}q_j = \sum_{j&gt;k}\frac{X_j^i Z_j}{X_j}p_j.</span>
<span id="cb6-607"><a href="#cb6-607"></a>$$</span>
<span id="cb6-608"><a href="#cb6-608"></a>where, recall, $Z_j=q_j/p_j$ is the event weight.</span>
<span id="cb6-609"><a href="#cb6-609"></a></span>
<span id="cb6-610"><a href="#cb6-610"></a>The premium to layer $k$, given by $P_k = g(S_k)\Delta X_k$, is partitioned to the units as $\beta_k^i g(S_k)\Delta X_k$. The total premium is therefore allocated to the units as</span>
<span id="cb6-611"><a href="#cb6-611"></a>$$</span>
<span id="cb6-612"><a href="#cb6-612"></a>\mathsf E<span class="co">[</span><span class="ot">X^i Z(X)</span><span class="co">]</span> = \sum_j \beta_j^i g(S_j)\Delta X_j</span>
<span id="cb6-613"><a href="#cb6-613"></a>$$</span>
<span id="cb6-614"><a href="#cb6-614"></a>being the total premium to unit $i$.</span>
<span id="cb6-615"><a href="#cb6-615"></a></span>
<span id="cb6-616"><a href="#cb6-616"></a>**Exercise.** Prove the previous equality.</span>
<span id="cb6-617"><a href="#cb6-617"></a></span>
<span id="cb6-618"><a href="#cb6-618"></a>**Solution.** The same steps as the preceding exercise. \qed</span>
<span id="cb6-619"><a href="#cb6-619"></a></span>
<span id="cb6-620"><a href="#cb6-620"></a>Since margin is the difference between premium and expected loss (@eq-PLM), we immediately have the allocation of unit $i$'s margin</span>
<span id="cb6-621"><a href="#cb6-621"></a>$$</span>
<span id="cb6-622"><a href="#cb6-622"></a>M^i = \sum_j (\beta_j^i g(S_j) - \alpha_j^i S_j)\Delta X_j.</span>
<span id="cb6-623"><a href="#cb6-623"></a>$$ {#eq-M-i2}</span>
<span id="cb6-624"><a href="#cb6-624"></a></span>
<span id="cb6-625"><a href="#cb6-625"></a>**Exercise.** Use @eq-M-i with @eq-P-i and @eq-L-i to derive a simple equation for $M^i$ and then prove it is the equivalent of @eq-M-i2. \qed</span>
<span id="cb6-626"><a href="#cb6-626"></a></span>
<span id="cb6-627"><a href="#cb6-627"></a>Recall that the layer $k$ cost of capital is</span>
<span id="cb6-628"><a href="#cb6-628"></a>$$</span>
<span id="cb6-629"><a href="#cb6-629"></a>\iota_k := \frac{M_k}{Q_k} = \frac{P_k - S_k\Delta X_k}{\Delta X_k-P_k} = \frac{g(S_k) - S_k}{1- g(S_k)}.</span>
<span id="cb6-630"><a href="#cb6-630"></a>$$</span>
<span id="cb6-631"><a href="#cb6-631"></a>Here, we lean on the assumption of law invariance (see @sec-Pricing-layers). We claim that for a law invariant pricing approach, the layer cost of capital must be the *same for all units*. Law invariance implies the risk measure is only concerned with the attachment probability of the layer and not with the cause of loss within the layer. If $\iota$ *within a layer* varied by unit, then the allocation could not be law invariant. This crucial observation underlies the following logic.</span>
<span id="cb6-632"><a href="#cb6-632"></a></span>
<span id="cb6-633"><a href="#cb6-633"></a>Because cost of capital equals margin over capital, and seeing as both margin and cost of capital are known by layer and by unit, with the latter constant across units, we can compute unit capital by layer $Q_k^i$ via</span>
<span id="cb6-634"><a href="#cb6-634"></a></span>
<span id="cb6-635"><a href="#cb6-635"></a>\begin{equation}</span>
<span id="cb6-636"><a href="#cb6-636"></a>\iota_k: = \frac{M_k}{Q_k} = \frac{M_k^i}{Q_k^i}\implies Q_k^i = \frac{M_k^i}{\iota_k}.</span>
<span id="cb6-637"><a href="#cb6-637"></a>\end{equation} Substituting the details gives the following definition for the **NA of capital** in layer $k$ to unit $i$:</span>
<span id="cb6-638"><a href="#cb6-638"></a>$$</span>
<span id="cb6-639"><a href="#cb6-639"></a>Q_k^i = \frac{\beta_k^i g(S_k) -  \alpha_k^i S_k}{g(S_k)- S_k} (1-g(S_k))\Delta X_k.</span>
<span id="cb6-640"><a href="#cb6-640"></a>$$ {#eq-Q-ki}</span>
<span id="cb6-641"><a href="#cb6-641"></a></span>
<span id="cb6-642"><a href="#cb6-642"></a>In words, taking @eq-Q-ki and dividing numerator and denominator by capital in the layer shows</span>
<span id="cb6-643"><a href="#cb6-643"></a>$$</span>
<span id="cb6-644"><a href="#cb6-644"></a>Q_k^i = \frac{\text{Margin for unit in layer}}{\text{Total margin in layer}}\times \text{Capital in layer} = \frac{\text{Margin for unit in layer}}{\text{Layer cost of capital}}.</span>
<span id="cb6-645"><a href="#cb6-645"></a>$$</span>
<span id="cb6-646"><a href="#cb6-646"></a>The NA is the same as method 1 (divide by weighted average cost of capital) but **applied separately for each layer** of capital!</span>
<span id="cb6-647"><a href="#cb6-647"></a></span>
<span id="cb6-648"><a href="#cb6-648"></a>**Exercise.** Derive @eq-Q-ki. \qed</span>
<span id="cb6-649"><a href="#cb6-649"></a></span>
<span id="cb6-650"><a href="#cb6-650"></a>Since $1-g(S_k)$ is the proportion of of layer $k$'s limit devoted to capital, this says the proportion of capital allocated to unit $i$ is given by the nicely symmetric expression</span>
<span id="cb6-651"><a href="#cb6-651"></a>$$</span>
<span id="cb6-652"><a href="#cb6-652"></a>\frac{\beta_k^i g(S_k) -  \alpha_k^i S_k}{g(S_k)- S_k}</span>
<span id="cb6-653"><a href="#cb6-653"></a>$$ {#eq-q-formula}</span>
<span id="cb6-654"><a href="#cb6-654"></a>To determine total capital by unit, we sum across layers</span>
<span id="cb6-655"><a href="#cb6-655"></a>$$</span>
<span id="cb6-656"><a href="#cb6-656"></a>Q^i := \sum_j Q_j^i.</span>
<span id="cb6-657"><a href="#cb6-657"></a>$$</span>
<span id="cb6-658"><a href="#cb6-658"></a>Finally, we can determine the average cost of capital for unit $i$ \begin{equation}</span>
<span id="cb6-659"><a href="#cb6-659"></a>\iota^i = \frac{M^i}{Q^i}.</span>
<span id="cb6-660"><a href="#cb6-660"></a>\end{equation}</span>
<span id="cb6-661"><a href="#cb6-661"></a></span>
<span id="cb6-662"><a href="#cb6-662"></a>This is illustrated for our example in @tbl-alpha, @tbl-beta, and @tbl-q-alloc. In the last table, the columns are calculated as $M^i=\beta^i g(S)-\alpha^i S$, $\iota=(g-S)/(1-g)$, $Q^i=M^i/\iota$, and the low row $M$ (respectively, $Q$) show sum products with $\Delta X$. <span class="co">&lt;!--# Note message in PDF about table size not allowing "pleasant formatting." --&gt;</span></span>
<span id="cb6-663"><a href="#cb6-663"></a></span>
<span id="cb6-666"><a href="#cb6-666"></a><span class="in">```{python}</span></span>
<span id="cb6-667"><a href="#cb6-667"></a><span class="co">#| echo: false</span></span>
<span id="cb6-668"><a href="#cb6-668"></a><span class="co">#| label: tbl-alpha</span></span>
<span id="cb6-669"><a href="#cb6-669"></a><span class="co">#| tbl-cap: "Calculation of loss shares by layer. The row $L$ shows sum products with $\\Delta X$."</span></span>
<span id="cb6-670"><a href="#cb6-670"></a><span class="op">%</span>run <span class="op">-</span>i basic_example_script.py</span>
<span id="cb6-671"><a href="#cb6-671"></a><span class="op">%</span>run <span class="op">-</span>i <span class="dv">0</span><span class="er">70_script</span>.py</span>
<span id="cb6-672"><a href="#cb6-672"></a>ex070[<span class="st">'tbl-alpha'</span>]</span>
<span id="cb6-673"><a href="#cb6-673"></a><span class="in">```</span></span>
<span id="cb6-674"><a href="#cb6-674"></a></span>
<span id="cb6-677"><a href="#cb6-677"></a><span class="in">```{python}</span></span>
<span id="cb6-678"><a href="#cb6-678"></a><span class="co">#| echo: false</span></span>
<span id="cb6-679"><a href="#cb6-679"></a><span class="co">#| label: tbl-beta</span></span>
<span id="cb6-680"><a href="#cb6-680"></a><span class="co">#| tbl-cap: "Calculation of premium shares by layer. The row $P$ shows sum products with $\\Delta X$."</span></span>
<span id="cb6-681"><a href="#cb6-681"></a>ex070[<span class="st">'tbl-beta'</span>]</span>
<span id="cb6-682"><a href="#cb6-682"></a><span class="in">```</span></span>
<span id="cb6-683"><a href="#cb6-683"></a></span>
<span id="cb6-686"><a href="#cb6-686"></a><span class="in">```{python}</span></span>
<span id="cb6-687"><a href="#cb6-687"></a><span class="co">#| echo: false</span></span>
<span id="cb6-688"><a href="#cb6-688"></a><span class="co">#| label: tbl-q-alloc</span></span>
<span id="cb6-689"><a href="#cb6-689"></a><span class="co">#| tbl-cap: "Allocation of capital."</span></span>
<span id="cb6-690"><a href="#cb6-690"></a>ex070[<span class="st">'tbl-q-alloc'</span>]</span>
<span id="cb6-691"><a href="#cb6-691"></a><span class="in">```</span></span>
<span id="cb6-692"><a href="#cb6-692"></a></span>
<span id="cb6-693"><a href="#cb6-693"></a>Observe that $(\sum_i \iota^i Q^i)/Q$ is 15%, the weighted cost of capital over all units is 15%, as assumed.</span>
<span id="cb6-694"><a href="#cb6-694"></a></span>
<span id="cb6-695"><a href="#cb6-695"></a>Notice that the first layer $k=0$ has undefined cost of capital $\iota$; since $S_0=1$, we have $g(S_0)=1$, $P_0=\Delta X_0$, and $M_0=Q_0=0$. Nonetheless, we have nonzero unit margins $M_0^i$ summing to zero.</span>
<span id="cb6-696"><a href="#cb6-696"></a></span>
<span id="cb6-697"><a href="#cb6-697"></a>The smallest portfolio loss equals 22, meaning the first layer is entirely funded by loss payments and requires no capital in aggregate. However, there are cross-subsidies between the units within the layer. Were the three units to purchase insurance from an insurance company with only \$22 of assets, it would benefit the most volatile line, because it would capture an outsized proportion of the available assets in the case it had a large loss. The margins reflect these cross-subsidies. However because the layer is fully funded by losses, there is no capital and hence no aggregate margin, which is why the allocated margins sum to zero.</span>
<span id="cb6-698"><a href="#cb6-698"></a></span>
<span id="cb6-699"><a href="#cb6-699"></a>Although the cost of capital *within* each layer is the same for all units, the margin, the proportion of limit that is capital, and the proportion of that capital attributable to each unit, all vary across layers. Therefore, *average cost of capital generally varies by unit*. @tbl-wang-isa-alloc shows the difference in results between the natural Wang allocation and the CCoC approaches done previously. (The natural CCoC is equivalent to the industry standard approach.) The story is complex. While both noncatastrophe lines receive more margin and more capital under the Wang allocation, it is not proportional; their rates of return are not only lower than the 15% benchmark, but they are markedly different.</span>
<span id="cb6-700"><a href="#cb6-700"></a></span>
<span id="cb6-703"><a href="#cb6-703"></a><span class="in">```{python}</span></span>
<span id="cb6-704"><a href="#cb6-704"></a><span class="co">#| echo: false</span></span>
<span id="cb6-705"><a href="#cb6-705"></a><span class="co">#| label: tbl-wang-isa-alloc</span></span>
<span id="cb6-706"><a href="#cb6-706"></a><span class="co">#| tbl-cap: "Comparison of Wang SRM and CCoC natural capital allocations."</span></span>
<span id="cb6-707"><a href="#cb6-707"></a>ex070[<span class="st">'tbl-wang-isa-alloc'</span>]</span>
<span id="cb6-708"><a href="#cb6-708"></a><span class="in">```</span></span>
<span id="cb6-709"><a href="#cb6-709"></a></span>
<span id="cb6-710"><a href="#cb6-710"></a>For a typical distortion other than CCoC, in line with @tbl-margin-return, we find:</span>
<span id="cb6-711"><a href="#cb6-711"></a></span>
<span id="cb6-712"><a href="#cb6-712"></a><span class="ss">-   </span>Lower layers of assets, below the expected losses, have a high cost of capital but, offsetting this, they are mostly funded by premium and require little supporting investor capital, resulting in high leverage.</span>
<span id="cb6-713"><a href="#cb6-713"></a><span class="ss">-   </span>Higher layers of assets have a lower cost of capital but higher capital content: they are funded by capital to a greater degree.</span>
<span id="cb6-714"><a href="#cb6-714"></a><span class="ss">-   </span>Low volatility units by definition tend to have losses close to their expected value, regardless of the value of total losses, and so consume relatively more of the expensive, lower layer capital and a smaller proportion of cheaper, higher asset layers. Offsetting this, there is more capital in higher layers than lower ones.</span>
<span id="cb6-715"><a href="#cb6-715"></a><span class="ss">-   </span>High volatility units tend to have a larger proportion of total losses when the portfolio total loss is large, and so they consume a greater proportion of cheaper, higher layer capital.</span>
<span id="cb6-716"><a href="#cb6-716"></a></span>
<span id="cb6-717"><a href="#cb6-717"></a>We see all of these phenomena in the example.</span>
<span id="cb6-718"><a href="#cb6-718"></a></span>
<span id="cb6-719"><a href="#cb6-719"></a>With price, quantity, and proportion all variable the overall effect of the NA of capital is hard to predict. Since price, amount, and use are all correlated, it is never adequate to assume that the unit average cost of capital is the portfolio average cost of capital. This is the fundamental flaw in the industry standard approach, which uses the same cost of capital for all capital layers (see @sec-ISA). The SRM-based method outlined here produces varying cost of capital by unit in a defensible manner---given a choice of distortion function. How to make that choice was discussed in @sec-Selecting-Calibrating.</span>
<span id="cb6-720"><a href="#cb6-720"></a></span>
<span id="cb6-721"><a href="#cb6-721"></a><span class="fu">## Comparions with Bodoff's layer capital allocation</span></span>
<span id="cb6-722"><a href="#cb6-722"></a></span>
<span id="cb6-723"><a href="#cb6-723"></a>Readers may have guessed that the NA is closely related to Bodoff's layer capital allocation <span class="co">[</span><span class="ot">@Bodoff2007</span><span class="co">]</span>. This section will explain how they are correct and show the connections, similarities, and differences between the two approaches. Bodoff's approach uses $\alpha^i$, which describes how loss in each layer is shared between the units, and applies it to *all* assets in the layer. Since $\sum_i \alpha^1 = 1$ we get a decomposition</span>
<span id="cb6-724"><a href="#cb6-724"></a>$$</span>
<span id="cb6-725"><a href="#cb6-725"></a>a = \int_0^a 1\,dx = \sum_i \int_0^a \alpha^i(x)\,dx.</span>
<span id="cb6-726"><a href="#cb6-726"></a>$$</span>
<span id="cb6-727"><a href="#cb6-727"></a>Thus, $a^i=\int_0^a \alpha^i(x)\,dx$ is a reasonable allocation of assets. However, to determine a premium $a^i$ needs to be split into amounts $P^i + Q^i$ funded by policyholder premium and investor capital. For example, we could fall back to CCoC, resulting in a layer premium</span>
<span id="cb6-728"><a href="#cb6-728"></a>$$</span>
<span id="cb6-729"><a href="#cb6-729"></a>(\alpha^i(x) S(x) + \delta \alpha^i(x) (1 - S(x)))  + \nu \delta \alpha^i(x) (1 - S(x))</span>
<span id="cb6-730"><a href="#cb6-730"></a>$$</span>
<span id="cb6-731"><a href="#cb6-731"></a>where the first parenthetic term is expected loss (@eq-alpha-k-i) plus a margin $\delta$ times the unfunded liability (@tbl-pentagon, P3), and the second term is investor capital (@tbl-pentagon, Q). This reproduces distortion CCoC pricing. Picking other distortions, which allow for the unfunded liability to be split differently than losses, produces a range of other answers. Bodoff's paper is very insightful, but it falls short by not fully describing a premium allocation: further assumptions are still needed to convert allocated assets into allocated premiums. @tbl-bodoff shows Bodoff's asset allocation in the last four right-hand columns.</span>
<span id="cb6-732"><a href="#cb6-732"></a></span>
<span id="cb6-735"><a href="#cb6-735"></a><span class="in">```{python}</span></span>
<span id="cb6-736"><a href="#cb6-736"></a><span class="co">#| echo: false</span></span>
<span id="cb6-737"><a href="#cb6-737"></a><span class="co">#| label: tbl-bodoff</span></span>
<span id="cb6-738"><a href="#cb6-738"></a><span class="co">#| tbl-cap: "Bodoff's asset allocations, $\\alpha^i\\Delta X$."</span></span>
<span id="cb6-739"><a href="#cb6-739"></a>ex070[<span class="st">'tbl-bodoff'</span>]</span>
<span id="cb6-740"><a href="#cb6-740"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>DRAFT - do not redistribute</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>